"use strict";(self.webpackChunkjennifer5_frontend=self.webpackChunkjennifer5_frontend||[]).push([[10943],{48283:(x,O,l)=>{l.d(O,{Sf:()=>j,X1:()=>X,X3:()=>P,XT:()=>U,yy:()=>$});var e=l(21005);function P(S){return{errorType:S.key,applied:!0,level:"NORMAL",iconRecoveryTime:6e4,checkTimeRange:1e4,thresholdErrorCount:1,customMessage:"",autoScriptCommand:"",scriptRunEnabled:!1,individualSetCount:0}}function U(){return{key:"-1",value:{instanceIdList:[],setting:{partitionList:[],percentageOfUsage:0}}}}async function X(S,M){const{data:L}=await e.A.get(`/api-v2/manage/rule/event/error/${S}/${M}/individual-setting`);return L}async function $(S){const{data:M}=await e.A.get("/agent/names",{params:{format:"json",sid:S}});return M.map(L=>[L.instId,L.oid])}async function j(S){return(await $(S)).map(L=>L[0])}},73424:(x,O,l)=>{l.r(O),l.d(O,{default:()=>yn});var e=l(47577);const P={class:"app-ctrl event-ctrl"},U={class:"left"},X={key:0,class:"right"},$={class:"component"},j={key:1,class:"right"},S={key:2,class:"right"};function M(t,n,a,s,o,m){const d=(0,e.g2)("domain-tree-layer"),r=(0,e.g2)("dropdown"),i=(0,e.g2)("btn"),p=(0,e.g2)("base-header"),u=(0,e.g2)("loading-indicator"),E=(0,e.g2)("cards"),y=(0,e.g2)("confirm-window"),g=(0,e.g2)("domain-window"),c=(0,e.g2)("card-form");return(0,e.uX)(),(0,e.CE)("div",P,[(0,e.bo)((0,e.Lk)("div",U,[(0,e.bF)(d,{"is-layer":!1,"show-title":!1})],512),[[e.aG,t.showDomainTreeLayer&&t.screenMode==="list"]]),n[17]||(n[17]=(0,e.eW)()),t.screenMode==="list"?((0,e.uX)(),(0,e.CE)("div",X,[(0,e.bF)(p,{title:t.i18nMessages.metricsTitle,"use-domain-tree-btn":!0,"active-domain-tree":t.showDomainTreeLayer,onToggleDomaintree:n[1]||(n[1]=()=>t.showDomainTreeLayer=!t.showDomainTreeLayer)},{tools:(0,e.k6)(()=>[(0,e.Lk)("div",$,[(0,e.bF)(r,{items:t.targetTypeItems,"selected-value":t.filterType,onOnchange:t.onChangeFilterType,"is-simple-style":"",normal:""},null,8,["items","selected-value","onOnchange"])]),n[5]||(n[5]=(0,e.eW)()),n[6]||(n[6]=(0,e.Lk)("div",{class:"splitter"},null,-1)),n[7]||(n[7]=(0,e.eW)()),(0,e.bF)(i,{normal:"","icon-first":"",class:"border-none",disabled:t.selectedDomain.resourceType!=="domain",items:[{text:t.i18nMessages.add,iconType:t.iconTypes.add}],onClick:t.onClickAddSetting},null,8,["disabled","items","onClick"]),n[8]||(n[8]=(0,e.eW)()),(0,e.bF)(i,{class:"border-none",normal:"","icon-first":"",disabled:t.checkedItems.length===0,items:[{iconType:t.iconTypes.trashcan}],"tooltip-options":{message:t.i18nMessages.delete},onClick:n[0]||(n[0]=()=>t.confirmMessage=t.i18nMessages.M0270)},null,8,["disabled","items","tooltip-options"])]),_:1},8,["title","active-domain-tree"]),n[9]||(n[9]=(0,e.eW)()),t.useLoading?((0,e.uX)(),(0,e.Wv)(u,{key:0})):(0,e.Q3)("v-if",!0),n[10]||(n[10]=(0,e.eW)()),(0,e.bF)(E),n[11]||(n[11]=(0,e.eW)()),t.confirmMessage!==""?((0,e.uX)(),(0,e.Wv)(y,{key:1,message:t.confirmMessage,onCancel:n[2]||(n[2]=()=>t.confirmMessage=""),onApply:t.onClickDeleteSettings},null,8,["message","onApply"])):(0,e.Q3)("v-if",!0)])):t.screenMode==="modify"?((0,e.uX)(),(0,e.CE)("div",j,[(0,e.bF)(p,{"use-back-btn":!0,"use-delete-btn":!0,onDeleteSetting:t.onClickDeleteSetting,onClickBackbtn:t.onClickBackBtn},{tools:(0,e.k6)(()=>[(0,e.bF)(i,{normal:"",items:[{text:t.i18nMessages.copyDomainSettings}],pressed:t.activeDomainWindow,loading:t.copyLoading,onClick:n[3]||(n[3]=()=>t.activeDomainWindow=!t.activeDomainWindow)},null,8,["items","pressed","loading"]),n[12]||(n[12]=(0,e.eW)(`

                    \xA0
                    `)),n[13]||(n[13]=(0,e.Lk)("div",{class:"splitter"},null,-1)),n[14]||(n[14]=(0,e.eW)()),t.activeDomainWindow?((0,e.uX)(),(0,e.Wv)(g,{key:0,domains:t.domains,onCancel:n[4]||(n[4]=()=>t.activeDomainWindow=!1),onApply:t.onCopyDomainSettings},null,8,["domains","onApply"])):(0,e.Q3)("v-if",!0)]),_:1},8,["onDeleteSetting","onClickBackbtn"]),n[15]||(n[15]=(0,e.eW)()),(0,e.bF)(c,{"is-new":!1,onCancel:t.onClickBackBtn},null,8,["onCancel"])])):((0,e.uX)(),(0,e.CE)("div",S,[(0,e.bF)(p,{title:t.i18nMessages.addEventSetting},null,8,["title"]),n[16]||(n[16]=(0,e.eW)()),(0,e.bF)(c,{"is-new":!0,onCancel:t.onClickBackBtn},null,8,["onCancel"])]))])}var L=l(35375),ee=l(62078),H=l(65267),te=l(22984),ne=l(83987);const se={key:0,class:"cards"},oe={key:1,class:"no-cards"};function ie(t,n,a,s,o,m){const d=(0,e.g2)("card");return t.cardItems.length>0?((0,e.uX)(),(0,e.CE)("div",se,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(t.cardItems,(r,i)=>((0,e.uX)(),(0,e.Wv)(d,{key:i,item:r,checked:t.isChecked(r),onSelect:t.onClickCardItem,onActive:p=>t.onClickActiveCardItem(r,i),onCheck:p=>t.onCheckCardItem(r,p)},null,8,["item","checked","onSelect","onActive","onCheck"]))),128))])):((0,e.uX)(),(0,e.CE)("div",oe,(0,e.v_)(t.i18n.M0703),1))}const ae={class:"card"},de={class:"row"},le={class:"left"},re={class:"subject"},pe=["innerHTML"],ue={class:"value",style:{"margin-top":"8px"}},me={class:"right"},ce={class:"subject"},_e={class:"value",style:{"margin-top":"8px"}},ve={class:"component"},ge={class:"row"},Ie={class:"column"},Te={class:"subject"},Ce={class:"value"},Ee={class:"column"},ye={class:"subject"},fe=["innerHTML"],ke={class:"column"},be={class:"subject"},Le={class:"value"},Se={class:"column"},Ae={class:"subject"},De={class:"value"},we={class:"column"},We={class:"subject"},Me={class:"value"},he={key:0,class:"row"},Re={class:"subject"},Fe={class:"value"},Ne={class:"text"},Oe={key:1,class:"row"},$e={class:"subject"},Be={class:"value"},Pe={class:"text"},Ue={key:2,class:"row"},Xe={class:"subject"},je={class:"value"},He={class:"checkbox"};function Ge(t,n,a,s,o,m){const d=(0,e.g2)("toggle-switch"),r=(0,e.g2)("event-level"),i=(0,e.g2)("memo"),p=(0,e.g2)("checkbox");return(0,e.uX)(),(0,e.CE)("div",ae,[(0,e.Lk)("div",{class:"rows",onClick:n[0]||(n[0]=(0,e.D$)((...u)=>t.onClickCard&&t.onClickCard(...u),["prevent"]))},[(0,e.Lk)("div",de,[(0,e.Lk)("div",le,[(0,e.Lk)("div",re,[(0,e.Lk)("span",{innerHTML:t.item.fullName},null,8,pe),n[2]||(n[2]=(0,e.eW)()),(0,e.Lk)("div",ue,[(0,e.Lk)("strong",null,(0,e.v_)(t.getMetricsName(t.item.setting.metricId)),1)])])]),n[6]||(n[6]=(0,e.eW)()),(0,e.Lk)("div",me,[(0,e.Lk)("div",ce,[(0,e.Lk)("span",null,(0,e.v_)(t.i18n.targetType),1),n[3]||(n[3]=(0,e.eW)()),(0,e.Lk)("div",_e,[(0,e.Lk)("span",null,(0,e.v_)(t.getTargetTypeName(t.item.setting.groupType)),1)])]),n[5]||(n[5]=(0,e.eW)()),(0,e.Lk)("div",ve,[(0,e.Lk)("span",null,(0,e.v_)(t.i18n.instanceGlobalRule),1),n[4]||(n[4]=(0,e.eW)()),(0,e.bF)(d,{active:t.item.setting.applied,onChange:t.onChangeApplied},null,8,["active","onChange"])])])]),n[11]||(n[11]=(0,e.eW)()),(0,e.Lk)("div",ge,[(0,e.Lk)("div",Ie,[(0,e.Lk)("div",Te,[(0,e.eW)((0,e.v_)(t.i18n.eventLevel)+" ",1),(0,e.Lk)("div",Ce,[(0,e.bF)(r,{large:"",level:t.EventLevelDef[t.item.setting.level]},null,8,["level"])])])]),n[7]||(n[7]=(0,e.eW)()),(0,e.Lk)("div",Ee,[(0,e.Lk)("div",ye,[(0,e.eW)((0,e.v_)(t.i18n.rule)+" ",1),(0,e.Lk)("div",{class:"value",innerHTML:t.item.setting.expression},null,8,fe)])]),n[8]||(n[8]=(0,e.eW)()),(0,e.Lk)("div",ke,[(0,e.Lk)("div",be,[(0,e.eW)((0,e.v_)(t.i18n.eventCheckTime)+" ",1),(0,e.Lk)("div",Le,(0,e.v_)(t.item.setting.checkTimeRange/1e3)+(0,e.v_)(t.i18n.second),1)])]),n[9]||(n[9]=(0,e.eW)()),(0,e.Lk)("div",Se,[(0,e.Lk)("div",Ae,[(0,e.eW)((0,e.v_)(t.i18n.eventCriterionTimes)+" ",1),(0,e.Lk)("div",De,(0,e.v_)(t.item.setting.thresholdErrorCount),1)])]),n[10]||(n[10]=(0,e.eW)()),(0,e.Lk)("div",we,[(0,e.Lk)("div",We,[(0,e.eW)((0,e.v_)(t.i18n.eventRollback)+" ",1),(0,e.Lk)("div",Me,(0,e.v_)(t.item.setting.iconRecoveryTime/1e3)+(0,e.v_)(t.i18n.second),1)])])]),n[12]||(n[12]=(0,e.eW)()),t.item.setting.customMessage!==""?((0,e.uX)(),(0,e.CE)("div",he,[(0,e.Lk)("div",Re,[(0,e.eW)((0,e.v_)(t.i18n.M0394)+" ",1),(0,e.Lk)("div",Fe,[(0,e.Lk)("div",Ne,(0,e.v_)(t.item.setting.customMessage),1)])])])):(0,e.Q3)("v-if",!0),n[13]||(n[13]=(0,e.eW)()),t.item.setting.scriptRunEnabled&&t.item.setting.autoScriptCommand!==""?((0,e.uX)(),(0,e.CE)("div",Oe,[(0,e.Lk)("div",$e,[(0,e.eW)((0,e.v_)(t.i18n.scriptAutoRun)+" ",1),(0,e.Lk)("div",Be,[(0,e.Lk)("div",Pe,(0,e.v_)(t.item.setting.autoScriptCommand),1)])])])):(0,e.Q3)("v-if",!0),n[14]||(n[14]=(0,e.eW)()),t.item.instanceSettings.length>0?((0,e.uX)(),(0,e.CE)("div",Ue,[(0,e.Lk)("div",Xe,[(0,e.eW)((0,e.v_)(t.i18n.eventSetInvidual)+" ",1),(0,e.Lk)("div",je,[((0,e.uX)(!0),(0,e.CE)(e.FK,null,(0,e.pI)(t.item.instanceSettings,(u,E)=>((0,e.uX)(),(0,e.Wv)(i,{key:E,"memo-type":"normal","memo-text":{main:u.instanceName,sub:"",disabled:!1,active:u.applied}},null,8,["memo-text"]))),128))])])])):(0,e.Q3)("v-if",!0)]),n[15]||(n[15]=(0,e.eW)()),(0,e.Lk)("div",He,[(0,e.bF)(p,{active:t.checked,onChange:n[1]||(n[1]=u=>t.$emit("check",u))},null,8,["active"])])])}var V=l(86617),b=l(52004),G=l(88994),K=l(80805),Ke=l(78496),Qe=l(88595);const Ve=(0,e.pM)({components:{ToggleSwitch:K.A,Memo:Ke.A,EventLevel:Qe.A,Checkbox:G.A},props:{item:{type:Object,required:!0},checked:{type:Boolean,required:!0}},emits:["select","active","check"],setup(t,{emit:n}){const a=(0,e.WQ)("i18n",{}),s=(0,e.lW)(t,"item"),o=d=>{d.target.className==="button"||d.target.className.includes("aries-switch")||n("select",s.value)},m=d=>{s.value.setting.applied=d,n("active",s.value)};return{i18n:a,item:s,EventLevelDef:V.s0,getMetricsName:b.fs,getTargetTypeName:b.j3,onChangeApplied:m,onClickCard:o}}});var w=l(35339);const Ye=(0,w.A)(Ve,[["render",Ge],["__scopeId","data-v-b2a52ffc"]]);var Y=l(28416),D=l(1401),W=l(21005),Q=l(6373),z=l(97116);const _={UPDATE_ITEM_IN_LIST:"updateSettingItemInList",SELECT_ITEM:"selectSettingItem",RESET_ITEMS:"resetSettingItems",ADD_ITEMS:"addSettingItems",DELETE_ITEM:"deleteSettingItem",CHANGE_FILTER_TYPE:"changeFilterType",SET_USE_LOADING:"setUseLoading",CHANGE_SCREEN_MODE:"changeScreenMode",UPDATE_CHECKED_ITEMS:"updateCheckedItems",UPDATE_INSTANCE_OID_TO_ID_MAP:"updateInstanceOidToIdMap"},I={LOAD_METRICS_TYPES:"loadMetricsTypes",LOAD_ITEMS:"loadSettingItems",SAVE_ITEM:"saveSettingItem",COPY_ITEMS:"copySettingItems",SAVE_ITEM_FOR_TARGET:"saveSettingItemForTarget",DELETE_ITEM:"deleteSettingItem",DELETE_ITEMS:"deleteSettingItems",DELETE_ITEM_FOR_TARGET:"deleteSettingItemForTarget"},ze={namespaced:!0,state:()=>({module:"metricsInRule",screenMode:"list",items:[],filterType:"ALL",useLoading:!1,selectedItem:{domainId:-1,fullName:"",groupType:"INSTANCE",setting:(0,b.A1)(),instanceSettings:[]},checkedItems:[],instanceOidToIdMap:new Map}),mutations:{[_.CHANGE_SCREEN_MODE](t,n){t.screenMode=n,t.checkedItems=[],n!=="modify"&&(t.selectedItem={domainId:-1,fullName:"",setting:(0,b.A1)(),instanceSettings:[]})},[_.ADD_ITEMS](t,n){t.items=[...t.items,...n]},[_.DELETE_ITEM](t,n){const a=(0,b.zr)(t.items,n);t.items=t.items.filter((s,o)=>o!==a)},[_.RESET_ITEMS](t){t.items=[]},[_.CHANGE_FILTER_TYPE](t,n){t.filterType=n},[_.SET_USE_LOADING](t,n){t.useLoading=n},[_.SELECT_ITEM](t,n){t.screenMode="modify",t.selectedItem=n},[_.UPDATE_CHECKED_ITEMS](t,n){t.checkedItems=n},[_.UPDATE_ITEM_IN_LIST](t,n){t.items[n.index]=n.item},[_.UPDATE_INSTANCE_OID_TO_ID_MAP](t,n){const a=new Map;n.forEach(s=>{a.set(s[1],s[0])}),t.instanceOidToIdMap=a}},actions:{async[I.LOAD_METRICS_TYPES](t,n){return await W.A.get("/metrics/realtime",{params:{format:"json",type:V.W5[n.toUpperCase()]}})},async[I.SAVE_ITEM_FOR_TARGET]({state:t},n){return await W.A.put(`/api-v2/manage/rule/event/metric/${t.selectedItem.domainId}/${t.selectedItem.setting.groupType.toLowerCase()}/${t.selectedItem.setting.metricId}/${t.selectedItem.setting.level.toLowerCase()}/${n.instanceId}`,n.formData)},async[I.SAVE_ITEM](t,n){return await W.A.put(`/api-v2/manage/rule/event/metric/${n.domainId}/${n.setting.groupType.toLowerCase()}/${n.setting.metricId}/${n.setting.level.toLowerCase()}`,{checkTimeRange:n.setting.checkTimeRange,thresholdErrorCount:n.setting.thresholdErrorCount,iconRecoveryTime:n.setting.iconRecoveryTime,customMessage:n.setting.customMessage,applied:n.setting.applied,scriptRunEnabled:n.setting.scriptRunEnabled,autoScriptCommand:n.setting.autoScriptCommand,expression:(0,Q.x4)(n.setting.expression)})},async[I.COPY_ITEMS]({state:t,dispatch:n},a){for(let s=0;s<a.length;s++){const o={...t.selectedItem.setting,instanceSettings:[]};await n(I.SAVE_ITEM,{domainId:a[s],fullName:t.selectedItem.fullName,setting:o})}},async[I.LOAD_ITEMS]({state:t,commit:n},a){n(_.SET_USE_LOADING,!0);const s=t.filterType==="ALL"?["INSTANCE","BUSINESS","DOMAIN"]:[t.filterType];for(let o=0;o<s.length;o++){const m=s[o].toLowerCase(),r=(await W.A.get(`/api-v2/manage/rule/event/metric/${a.domainId}/${m}`)).data.map(i=>({domainId:a.domainId,fullName:a.fullName,groupType:s[o],setting:i,instanceSettings:[]}));for(let i=0;i<r.length;i++)r[i].instanceSettings=await(0,b.nX)(r[i].domainId,s[o],r[i].setting.metricId,r[i].setting.level);n(_.ADD_ITEMS,r)}n(_.SET_USE_LOADING,!1)},async[I.DELETE_ITEM]({dispatch:t},n){const{data:a}=await W.A.delete(`/api-v2/manage/rule/event/metric/${n.domainId}/${n.setting.groupType.toLowerCase()}/${n.setting.metricId}/${n.setting.level.toLowerCase()}`);if(a){const s=n.instanceSettings;for(let o=0;o<s.length;o++)await t(I.DELETE_ITEM_FOR_TARGET,s[o].instanceOid)}},async[I.DELETE_ITEMS]({state:t,commit:n,dispatch:a}){for(let s=0;s<t.checkedItems.length;s++)await a(I.DELETE_ITEM,t.checkedItems[s]),n(_.DELETE_ITEM,t.checkedItems[s]);n(_.UPDATE_CHECKED_ITEMS,[])},async[I.DELETE_ITEM_FOR_TARGET]({state:t},n){return await W.A.delete(`/api-v2/manage/rule/event/metric/${t.selectedItem.domainId}/${t.selectedItem.setting.groupType.toLowerCase()}/${t.selectedItem.setting.metricId}/${t.selectedItem.setting.level.toLowerCase()}/${n}`)}}};z.A.hasModule("metricsInRule")||z.A.registerModule("metricsInRule",ze);const kn=null;var Je=l(48283);const Ze=(0,e.pM)({components:{Card:Ye},setup(){const t=(0,e.WQ)("i18n",{}),n=(0,D.P)("domain"),a=(0,e.EW)(()=>n.getters("sidList")),{fullName:s,setFullName:o}=(0,Y.bs)(n.state.domainList),{state:m,commit:d,dispatch:r}=(0,D.P)("metricsInRule"),i=(0,e.EW)(()=>m.items),p=async g=>{const c=await(0,Je.yy)(g.domainId);d(_.UPDATE_INSTANCE_OID_TO_ID_MAP,c),d(_.SELECT_ITEM,g)},u=async(g,c)=>{await r(I.SAVE_ITEM,g),d(_.UPDATE_ITEM_IN_LIST,{index:c,item:g})},E=(g,c)=>{if(c)d(_.UPDATE_CHECKED_ITEMS,[...m.checkedItems,g]);else{const T=(0,b.zr)(m.checkedItems,g);d(_.UPDATE_CHECKED_ITEMS,m.checkedItems.filter((f,v)=>v!==T))}},y=g=>(0,b.zr)(m.checkedItems,g)!==-1;return(0,e.nT)(()=>{d(_.RESET_ITEMS),a.value.forEach(g=>{o(g),r(I.LOAD_ITEMS,{domainId:g,fullName:(0,e.tB)(s).value})})}),{i18n:t,cardItems:i,onClickCardItem:p,onClickActiveCardItem:u,onCheckCardItem:E,isChecked:y}}}),qe=(0,w.A)(Ze,[["render",ie]]),xe={class:"card-form"},et={class:"row"},tt={class:"left"},nt={class:"right"},st={class:"row"},ot={class:"left"},it={class:"right full-name"},at=["innerHTML"],dt=["innerHTML"],lt={class:"row"},rt={class:"left"},pt={class:"right"},ut={class:"row"},mt={class:"left"},ct={class:"right"},_t={class:"col-group"},vt={class:"col"},gt={class:"sub-title"},It={class:"col-group"},Tt={class:"col"},Ct={class:"sub-title"},Et={class:"col"},yt={class:"sub-title"},ft={class:"col-group"},kt={class:"col"},bt={class:"sub-title"},Lt={class:"col"},St={class:"sub-title"},At={class:"col"},Dt={class:"sub-title"},wt={class:"col-group"},Wt={class:"col"},Mt={class:"sub-title"},ht=["readonly"],Rt={class:"col-group"},Ft={class:"col"},Nt={class:"sub-title"},Ot={class:"etc"},$t={class:"message"},Bt={key:0,class:"row"},Pt={class:"left"},Ut={class:"right"},Xt={class:"footer"};function jt(t,n,a,s,o,m){const d=(0,e.g2)("target-type-dropdown"),r=(0,e.g2)("toggle-switch"),i=(0,e.g2)("dropdown"),p=(0,e.g2)("svg-icon"),u=(0,e.g2)("tooltip"),E=(0,e.g2)("input-field"),y=(0,e.g2)("format-number-input"),g=(0,e.g2)("checkbox"),c=(0,e.g2)("instance-setting-wrapper"),T=(0,e.g2)("btn"),f=(0,e.g2)("alert-window");return(0,e.uX)(),(0,e.CE)("div",xe,[(0,e.Lk)("div",et,[(0,e.Lk)("div",tt,(0,e.v_)(t.i18n.targetType),1),n[7]||(n[7]=(0,e.eW)()),(0,e.Lk)("div",nt,[(0,e.bF)(d,{"is-new":t.isNew,"form-data":t.formData,"metrics-type-items":t.metricsTypeItems,"onUpdate:metricsTypeItems":n[0]||(n[0]=v=>t.metricsTypeItems=v)},null,8,["is-new","form-data","metrics-type-items"])])]),n[31]||(n[31]=(0,e.eW)()),(0,e.Lk)("div",st,[(0,e.Lk)("div",ot,(0,e.v_)(t.i18n.domain),1),n[8]||(n[8]=(0,e.eW)()),(0,e.Lk)("div",it,[t.isNew?((0,e.uX)(),(0,e.CE)("div",{key:0,innerHTML:t.fullName},null,8,at)):((0,e.uX)(),(0,e.CE)("div",{key:1,innerHTML:t.formData.fullName},null,8,dt))])]),n[32]||(n[32]=(0,e.eW)()),(0,e.Lk)("div",lt,[(0,e.Lk)("div",rt,(0,e.v_)(t.i18n.instanceGlobalRule),1),n[9]||(n[9]=(0,e.eW)()),(0,e.Lk)("div",pt,[(0,e.bF)(r,{normal:"",active:t.formData.setting.applied,"onUpdate:active":n[1]||(n[1]=v=>t.formData.setting.applied=v)},null,8,["active"])])]),n[33]||(n[33]=(0,e.eW)()),(0,e.Lk)("div",ut,[(0,e.Lk)("div",mt,(0,e.v_)(t.i18n.setting),1),n[28]||(n[28]=(0,e.eW)()),(0,e.Lk)("div",ct,[(0,e.Lk)("div",_t,[(0,e.Lk)("div",vt,[(0,e.Lk)("div",gt,(0,e.v_)(t.i18n.eventLevel),1),n[10]||(n[10]=(0,e.eW)()),(0,e.bF)(i,{normal:"",items:t.eventLevelItems,width:250,"selected-value":t.formData.setting.level,disabled:!t.isNew||!t.formData.setting.applied,onOnchange:t.onChangeEventLevel},null,8,["items","selected-value","disabled","onOnchange"])])]),n[24]||(n[24]=(0,e.eW)()),(0,e.Lk)("div",It,[(0,e.Lk)("div",Tt,[(0,e.Lk)("div",Ct,(0,e.v_)(t.i18n.metrics),1),n[11]||(n[11]=(0,e.eW)()),(0,e.bF)(i,{normal:"",items:t.metricsTypeItems,"selected-value":t.formData.setting.metricId,width:250,disabled:!t.isNew||!t.formData.setting.applied,onOnchange:t.onChangeMetricsId},null,8,["items","selected-value","disabled","onOnchange"])]),n[13]||(n[13]=(0,e.eW)()),(0,e.Lk)("div",Et,[(0,e.Lk)("div",yt,(0,e.v_)(t.i18n.rule),1),n[12]||(n[12]=(0,e.eW)()),(0,e.bF)(E,{width:250,value:t.formData.setting.expression,"onUpdate:value":n[2]||(n[2]=v=>t.formData.setting.expression=v),disabled:!t.formData.setting.applied},{"icon-right":(0,e.k6)(()=>[(0,e.bF)(u,{message:t.i18n.M0041,position:"top-center"},{default:(0,e.k6)(()=>[(0,e.bF)(p,{icon:t.helpIconOptions.type,width:t.helpIconOptions.size,height:t.helpIconOptions.size},null,8,["icon","width","height"])]),_:1},8,["message"])]),_:1},8,["value","disabled"])])]),n[25]||(n[25]=(0,e.eW)()),(0,e.Lk)("div",ft,[(0,e.Lk)("div",kt,[(0,e.Lk)("div",bt,(0,e.v_)(t.i18n.eventCheckTime),1),n[14]||(n[14]=(0,e.eW)()),(0,e.bF)(y,{width:100,value:t.checkTimeRange,min:10,disabled:!t.formData.setting.applied,onInput:t.onInputCheckTimeRange},null,8,["value","disabled","onInput"]),(0,e.eW)(" "+(0,e.v_)(t.i18n.second),1)]),n[17]||(n[17]=(0,e.eW)()),(0,e.Lk)("div",Lt,[(0,e.Lk)("div",St,(0,e.v_)(t.i18n.eventCriterionTimes),1),n[15]||(n[15]=(0,e.eW)()),(0,e.bF)(y,{width:100,min:1,step:1,value:t.formData.setting.thresholdErrorCount,"onUpdate:value":n[3]||(n[3]=v=>t.formData.setting.thresholdErrorCount=v),disabled:!t.formData.setting.applied},null,8,["value","disabled"])]),n[18]||(n[18]=(0,e.eW)()),(0,e.Lk)("div",At,[(0,e.Lk)("div",Dt,(0,e.v_)(t.i18n.eventRollback),1),n[16]||(n[16]=(0,e.eW)()),(0,e.bF)(y,{width:100,value:t.iconRecoveryTime,min:10,disabled:!t.formData.setting.applied,onInput:t.onInputIconRecoveryTime},null,8,["value","disabled","onInput"]),(0,e.eW)(" "+(0,e.v_)(t.i18n.second),1)])]),n[26]||(n[26]=(0,e.eW)()),(0,e.Lk)("div",wt,[(0,e.Lk)("div",Wt,[(0,e.Lk)("div",Mt,(0,e.v_)(t.i18n.M0394),1),n[19]||(n[19]=(0,e.eW)()),(0,e.bo)((0,e.Lk)("textarea",{"onUpdate:modelValue":n[4]||(n[4]=v=>t.formData.setting.customMessage=v),readonly:!t.formData.setting.applied},null,8,ht),[[e.Jo,t.formData.setting.customMessage]])])]),n[27]||(n[27]=(0,e.eW)()),t.formData.setting.groupType==="INSTANCE"?((0,e.uX)(),(0,e.CE)(e.FK,{key:0},[n[22]||(n[22]=(0,e.Lk)("div",{class:"splitter"},null,-1)),n[23]||(n[23]=(0,e.eW)()),(0,e.Lk)("div",Rt,[(0,e.Lk)("div",Ft,[(0,e.Lk)("div",Nt,[(0,e.bF)(g,{active:t.formData.setting.scriptRunEnabled,"onUpdate:active":n[5]||(n[5]=v=>t.formData.setting.scriptRunEnabled=v),label:t.i18n.scriptAutoRun,disabled:!t.formData.setting.applied},null,8,["active","label","disabled"])]),n[21]||(n[21]=(0,e.eW)()),(0,e.Lk)("div",Ot,[(0,e.bF)(E,{width:490,value:t.formData.setting.autoScriptCommand,"onUpdate:value":n[6]||(n[6]=v=>t.formData.setting.autoScriptCommand=v),disabled:!t.formData.setting.applied},null,8,["value","disabled"]),n[20]||(n[20]=(0,e.eW)()),(0,e.Lk)("div",$t,(0,e.v_)(t.i18n.M0039),1)])])])],64)):(0,e.Q3)("v-if",!0)])]),n[34]||(n[34]=(0,e.eW)()),t.formData.setting.groupType==="INSTANCE"?((0,e.uX)(),(0,e.CE)("div",Bt,[(0,e.Lk)("div",Pt,(0,e.v_)(t.i18n.eventSetInvidual),1),n[29]||(n[29]=(0,e.eW)()),(0,e.Lk)("div",Ut,[(0,e.bF)(c,{"form-data":t.formData},null,8,["form-data"])])])):(0,e.Q3)("v-if",!0),n[35]||(n[35]=(0,e.eW)()),(0,e.Lk)("div",Xt,[(0,e.bF)(T,{class:"border-none",normal:"",items:[{text:t.i18n.cancel}],onClick:t.onClickCancelBtn},null,8,["items","onClick"]),n[30]||(n[30]=(0,e.eW)()),(0,e.bF)(T,{class:"primary",normal:"",items:[{text:t.isNew?t.i18n.add:t.i18n.saveChanges}],onClick:t.onClickSaveBtn},null,8,["items","onClick"])]),n[36]||(n[36]=(0,e.eW)()),t.alertMessage?((0,e.uX)(),(0,e.Wv)(f,{key:1,message:t.alertMessage,onCancel:t.onHideAlertMessage},null,8,["message","onCancel"])):(0,e.Q3)("v-if",!0)])}var J=l(11649),Ht=l(97953),h=l(79526),Gt=l(8355),Kt=l(90194);function Qt(t,n,a,s,o,m){const d=(0,e.g2)("dropdown");return(0,e.uX)(),(0,e.Wv)(d,{normal:"",items:t.targetTypeItems,"selected-value":t.formData.setting.groupType,width:248,disabled:!t.isNew,onOnchange:t.onChangeTargetType},null,8,["items","selected-value","disabled","onOnchange"])}var A=l(73530);const Z=[{text:A.A.viewAll,value:"ALL"},{text:A.A.instance,value:"INSTANCE"},{text:A.A.business,value:"BUSINESS"},{text:A.A.domain,value:"DOMAIN"}],Vt=[{text:A.A.normal,value:"NORMAL"},{text:A.A.warning,value:"WARNING"},{text:A.A.fatal,value:"FATAL"}],Yt=(0,e.pM)({components:{Dropdown:H.A},props:{isNew:{type:Boolean,required:!0},formData:{type:Object,required:!0},metricsTypeItems:{type:Object,required:!0}},emits:["update:metricsTypeItems"],setup(t,{emit:n}){const{state:a,dispatch:s}=(0,D.P)("metricsInRule"),o=(0,e.lW)(t,"formData"),m=async({value:d})=>{const{data:r}=await s(I.LOAD_METRICS_TYPES,d),i=(0,b.zu)(r);o.value.setting.groupType=d,o.value.setting.metricId=i[0].value,n("update:metricsTypeItems",i)};return(0,e.KC)(async()=>{await m({value:o.value.setting.groupType}),t.isNew||(o.value.setting.metricId=a.selectedItem.setting.metricId)}),{targetTypeItems:Z.slice(1,4),onChangeTargetType:m}}}),zt=(0,w.A)(Yt,[["render",Qt]]);function Jt(t,n,a,s,o,m){const d=(0,e.g2)("instance-setting"),r=(0,e.g2)("btn"),i=(0,e.g2)("rule-window");return(0,e.uX)(),(0,e.CE)("div",null,[t.foldInstanceSetting?(0,e.Q3)("v-if",!0):((0,e.uX)(),(0,e.Wv)(d,{key:0,description:t.i18n.M0707,"selected-domain-id":t.formData.domainId,"instance-names":t.formData.instanceSettings.map(p=>p.instanceName),"instance-oids":t.formData.instanceSettings.map(p=>p.instanceOid),"active-oids":t.formData.instanceSettings.filter(p=>p.applied).map(p=>p.instanceOid),"dist-top":-320,"only-live-agent":!1,onChange:t.onChangeTargetSettings,onSelect:t.onSelectTargetSetting},null,8,["description","selected-domain-id","instance-names","instance-oids","active-oids","onChange","onSelect"])),n[0]||(n[0]=(0,e.eW)()),(0,e.bF)(r,{class:"border-none fold-btn",items:[{iconType:t.foldIconTypes[t.foldInstanceSetting?"fold":"open"]}],onClick:t.onToggleFoldInstanceSetting,normal:""},null,8,["items","onClick"]),n[1]||(n[1]=(0,e.eW)()),t.targetFormData.instanceName!==""?((0,e.uX)(),(0,e.Wv)(i,{key:1,title:t.targetFormData.instanceName,item:t.targetFormData,onCancel:t.onCancelTargetItem,onApply:t.onApplyTargetItem},null,8,["title","item","onCancel","onApply"])):(0,e.Q3)("v-if",!0)])}var Zt=l(46555);const qt={class:"main"},xt={class:"row"},en={class:"subject"},tn={class:"component"},nn={class:"column"},sn={class:"subject"},on={class:"etc"},an={class:"row"},dn={class:"subject"},ln={class:"component"};function rn(t,n,a,s,o,m){const d=(0,e.g2)("toggle-switch"),r=(0,e.g2)("checkbox"),i=(0,e.g2)("input-field"),p=(0,e.g2)("window");return(0,e.uX)(),(0,e.Wv)(p,{class:"rule-window","open-w":420,"open-h":280,"open-x":t.position.left,"open-y":t.position.top,messages:{apply:t.i18n.save,cancel:t.i18n.cancel},onCancel:t.onClickCancelBtn,onApply:t.onClickApplyBtn},{subject:(0,e.k6)(()=>[(0,e.eW)((0,e.v_)(t.title),1)]),default:(0,e.k6)(()=>[n[9]||(n[9]=(0,e.eW)()),(0,e.Lk)("div",qt,[(0,e.Lk)("div",xt,[(0,e.Lk)("div",en,(0,e.v_)(t.i18n.instanceGlobalRule),1),n[4]||(n[4]=(0,e.eW)()),(0,e.Lk)("div",tn,[(0,e.bF)(d,{active:t.formData.applied,"onUpdate:active":n[0]||(n[0]=u=>t.formData.applied=u)},null,8,["active"])])]),n[7]||(n[7]=(0,e.eW)()),(0,e.Lk)("div",nn,[(0,e.Lk)("div",sn,[(0,e.bF)(r,{disabled:!t.formData.applied,label:t.i18n.scriptAutoRun,active:t.formData.scriptRunEnabled,"onUpdate:active":n[1]||(n[1]=u=>t.formData.scriptRunEnabled=u)},null,8,["disabled","label","active"])]),n[5]||(n[5]=(0,e.eW)()),(0,e.Lk)("div",on,[(0,e.bF)(i,{disabled:!t.formData.applied,value:t.formData.autoScriptCommand,"onUpdate:value":n[2]||(n[2]=u=>t.formData.autoScriptCommand=u)},null,8,["disabled","value"])])]),n[8]||(n[8]=(0,e.eW)()),(0,e.Lk)("div",an,[(0,e.Lk)("div",dn,(0,e.v_)(t.i18n.rule),1),n[6]||(n[6]=(0,e.eW)()),(0,e.Lk)("div",ln,[(0,e.bF)(i,{normal:"",value:t.formData.expression,"onUpdate:value":n[3]||(n[3]=u=>t.formData.expression=u),width:190},null,8,["value"])])])])]),_:1,__:[9]},8,["open-x","open-y","messages","onCancel","onApply"])}var pn=l(67281);const un=(0,e.pM)({inject:["i18n"],components:{Checkbox:G.A,ToggleSwitch:K.A,Window:pn.A,InputField:J.A},props:{title:{type:String,required:!1,default:""},item:{type:Object,required:!0}},emits:["cancel","apply"],setup(t,{emit:n}){const a=(0,e.WQ)("i18n",{}),s=(0,e.KR)({...t.item,expression:(0,Q.x4)(t.item.expression)}),o={left:window.innerWidth/2-210,top:window.innerHeight/2-140};return{i18n:a,formData:s,position:o,onClickCancelBtn:()=>{n("cancel")},onClickApplyBtn:()=>{n("apply",s.value)}}}}),mn=(0,w.A)(un,[["render",rn],["__scopeId","data-v-4230b7aa"]]);function q(t,n,a,s){return{instanceName:t,instanceId:n,instanceOid:a,applied:s.setting.applied,scriptRunEnabled:s.setting.scriptRunEnabled,autoScriptCommand:s.setting.autoScriptCommand,expression:s.setting.expression,groupType:s.setting.groupType}}const cn=(0,e.pM)({components:{InstanceSetting:Zt.A,Btn:L.A,RuleWindow:mn},props:{formData:{type:Object,required:!0}},setup(t){const{state:n,dispatch:a}=(0,D.P)("metricsInRule"),s=(0,e.WQ)("i18n"),o=(0,e.lW)(t,"formData"),m=(0,e.EW)(()=>n.instanceOidToIdMap),d=(0,e.KR)(o.value.instanceSettings.length===0),r=(0,e.KR)(q("",-1,-1,o.value)),i=async()=>{o.value.instanceSettings=await(0,b.nX)(o.value.domainId,o.value.setting.groupType,o.value.setting.metricId,o.value.setting.level)},p=()=>{r.value=q("",-1,-1,o.value)},u=async c=>{const{data:T}=await a(I.SAVE_ITEM_FOR_TARGET,{instanceId:c.instanceId,formData:{applied:c.applied,scriptRunEnabled:c.scriptRunEnabled,autoScriptCommand:c.autoScriptCommand,expression:c.expression}});if(T){const f=o.value.instanceSettings.findIndex(v=>v.instanceOid===r.value.instanceOid);isNaN(f)||(o.value.instanceSettings[f]=c,p())}},E=c=>{const T=o.value.instanceSettings.filter(f=>f.instanceOid===c.sub)[0];T&&(r.value=T)},y=async c=>{const T=[],f=[],v=c.oids.map(C=>m.value.get(C)),R=o.value.instanceSettings.map(C=>C.instanceId);o.value.instanceSettings.forEach(C=>{c.oids.includes(C.instanceOid)||f.push(C.instanceId)}),f.forEach(C=>{T.push(a(I.DELETE_ITEM_FOR_TARGET,C))}),v.forEach(C=>{C!==void 0&&!R.includes(C)&&T.push(a(I.SAVE_ITEM_FOR_TARGET,{instanceId:C,formData:{applied:o.value.setting.applied,scriptRunEnabled:o.value.setting.scriptRunEnabled,autoScriptCommand:o.value.setting.autoScriptCommand,expression:o.value.setting.expression}}))}),T.length>0&&W.A.all(T).then(async()=>{await i()})},g=()=>{d.value=!d.value};return{i18n:s,formData:o,targetFormData:r,foldInstanceSetting:d,foldIconTypes:{open:h.B2.arrowUp,fold:h.B2.arrowDown},onCancelTargetItem:p,onApplyTargetItem:u,onSelectTargetSetting:E,onChangeTargetSettings:y,onToggleFoldInstanceSetting:g}}}),_n=(0,w.A)(cn,[["render",Jt]]);var vn=l(57222);const gn=(0,e.pM)({components:{Checkbox:G.A,InputField:J.A,FormatNumberInput:Ht.A,Btn:L.A,Dropdown:H.A,ToggleSwitch:K.A,SvgIcon:h.Ah,Tooltip:Gt.A,AlertWindow:Kt.A,TargetTypeDropdown:zt,InstanceSettingWrapper:_n},props:{isNew:{type:Boolean,required:!0}},emits:["cancel"],setup(t,{emit:n}){const a=(0,D.P)("domain"),{state:s,dispatch:o}=(0,D.P)("metricsInRule"),m=(0,e.WQ)("i18n",{M0288:"Select a domain.",M0601:"This setting already exists.",M0035:"The rule setting is incorrect."}),d=(0,e.KR)(""),r=(0,e.EW)(()=>s.items),i=(0,e.Kh)({domainId:t.isNew?a.state.selectedOne.data.sid:s.selectedItem.domainId,fullName:s.selectedItem.fullName,setting:{...s.selectedItem.setting,expression:(0,Q.x4)(s.selectedItem.setting.expression)},instanceSettings:[...s.selectedItem.instanceSettings]}),p=(0,e.KR)(i.setting.checkTimeRange/1e3),u=(0,e.KR)(i.setting.iconRecoveryTime/1e3),E=(0,e.KR)([]),{fullName:y,setFullName:g}=(0,Y.bs)(a.state.domainList);g(i.domainId);const c=({value:k})=>{i.setting.level=k},T=({value:k})=>{i.setting.metricId=k},f=k=>{i.setting.checkTimeRange=k*1e3,p.value=k},v=k=>{i.setting.iconRecoveryTime=k*1e3,u.value=k},R=async()=>{if(t.isNew&&r.value.filter(B=>B.domainId===i.domainId&&B.setting.metricId===i.setting.metricId&&B.setting.level===i.setting.level&&B.setting.groupType===i.setting.groupType).length>0){F("M0601");return}const{data:k}=await o(I.SAVE_ITEM,i);if(!k){F("M0035");return}C()},C=()=>{n("cancel")},F=k=>{d.value=m[k]},N=()=>{d.value=""};return(0,vn.v)(()=>{C()}),(0,e.wB)(()=>i.setting.groupType,()=>{i.setting.scriptRunEnabled=!1,i.setting.autoScriptCommand=""}),{helpIconOptions:{type:h.B2.help,size:16},eventLevelItems:Vt,metricsTypeItems:E,i18n:m,formData:i,checkTimeRange:p,iconRecoveryTime:u,alertMessage:d,fullName:y,onChangeEventLevel:c,onChangeMetricsId:T,onInputCheckTimeRange:f,onInputIconRecoveryTime:v,onClickSaveBtn:R,onClickCancelBtn:C,onShowAlertMessage:F,onHideAlertMessage:N,...(0,e.QW)(t)}}}),In=(0,w.A)(gn,[["render",jt],["__scopeId","data-v-8bd35764"]]);var Tn=l(61997),Cn=l(10935);const En=(0,e.pM)({components:{Btn:L.A,LoadingIndicator:ee.A,Dropdown:H.A,DomainTreeLayer:te.A,BaseHeader:ne.A,Cards:qe,CardForm:In,DomainWindow:Tn.A,ConfirmWindow:Cn.A},setup(){(0,e.Gt)("i18n",A.A);const t=(0,D.P)("domain"),n=(0,e.EW)(()=>t.state.selectedOne),{state:a,commit:s,dispatch:o}=(0,D.P)("metricsInRule"),m=(0,e.EW)(()=>a.useLoading),d=(0,e.EW)(()=>a.screenMode),r=(0,e.EW)(()=>a.filterType),i=(0,e.EW)(()=>a.selectedItem),p=(0,e.EW)(()=>a.checkedItems),u=(0,e.KR)(!1),E=(0,e.KR)(!1),y=(0,e.KR)(""),g=(0,e.KR)(window.innerWidth>1280),c=(0,e.EW)(()=>(0,b.oB)(i.value.domainId)),T=N=>{s(_.CHANGE_FILTER_TYPE,N.value)},f=()=>{s(_.CHANGE_SCREEN_MODE,"write")},v=()=>{s(_.CHANGE_SCREEN_MODE,"list")},R=()=>{o(I.DELETE_ITEM,i.value),v()},C=()=>{o(I.DELETE_ITEMS),y.value=""},F=async N=>{E.value=!0;try{await o(I.COPY_ITEMS,N)}catch{}finally{E.value=!1,u.value=!1,v()}};return(0,e.wB)(n,()=>{d.value!=="list"&&s(_.CHANGE_SCREEN_MODE,"list")}),{targetTypeItems:Z,i18nMessages:A.A,iconTypes:{trashcan:h.B2.trashcan,add:h.B2.add},useLoading:m,screenMode:d,filterType:r,activeDomainWindow:u,copyLoading:E,domains:c,checkedItems:p,confirmMessage:y,selectedDomain:n,showDomainTreeLayer:g,onClickAddSetting:f,onChangeFilterType:T,onClickDeleteSetting:R,onClickDeleteSettings:C,onClickBackBtn:v,onCopyDomainSettings:F}}}),yn=(0,w.A)(En,[["render",M]])}}]);
