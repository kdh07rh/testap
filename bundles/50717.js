(()=>{"use strict";var X={31472:(s,_,a)=>{a.d(_,{H:()=>R,Qv:()=>c,W:()=>h,YX:()=>f,lL:()=>w,lv:()=>S,r2:()=>C,y$:()=>P});var t=a(86617);const n="/api-v2/manage/xview-pattern-recognition",c="/script/tf-model/reward_v20230630_2/model.json",h=60,R=60,f=54,C=5,P=5,S=[0,0,0,0,0,0,1,1,2,2,1,2,2,3,3,2,3,3,4,4,3,4,4,5,5],w={[t.i8.HTTP_IO_EXCEPTION]:5,[t.i8.HTTP_404_ERROR]:1,[t.i8.OUT_OF_MEMORY]:5,[t.i8.SERVICE_EXCEPTION]:5,[t.i8.SERVICE_ERROR]:1,[t.i8.DB_CONNECTION_UNCLOSED]:5,[t.i8.DB_STATEMENT_UNCLOSED]:1,[t.i8.DB_RESULTSET_UNCLOSED]:1,[t.i8.PLC_REJECTED]:5,[t.i8.DEADLOCK]:5,[t.i8.METHOD_EXCEPTION]:1,[t.i8.RECURSIVE_CALL]:1,[t.i8.REPETITIVE_CALL]:1,[t.i8.SQL_EXCEPTION]:4,[t.i8.SQL_TOOMANY_FETCH]:5,[t.i8.EXTERNALCALL_EXCEPTION]:5,[t.i8.DB_CONNECTION_FAIL]:5,[t.i8.DB_UN_COMMIT_ROLLBACK]:1,[t.i8.DB_CONNECTION_ILLEGAL_ACCESS]:1,[t.i8.CORE_ERROR]:5,[t.i8.COMPILE_ERROR]:3,[t.i8.PARSE_ERROR]:3,[t.i8.PHP_WARNING]:1,[t.i8.NATIVE_CRITICAL_ERROR]:5,[t.i8.BAD_RESPONSE_TIME_APPLICATION]:3,[t.i8.BAD_RESPONSE_TIME_SQL]:5,[t.i8.BAD_RESPONSE_TIME_EXTERNAL_CALL]:5,[t.i8.AGENT_STOP]:5,[t.i8.AGENT_START]:1,[t.i8.AGENT_RECONNECT]:1,[t.i8.THREAD_KILL_MANUAL]:1,[t.i8.THREAD_KILL_AUTO]:1}},95479:(s,_,a)=>{var t=a(3317),n=a(31472),c=a(41091);new c.Ay("UserdefinedDashboard").version(1).stores({thumbnails:"++id,dashboardKey,theme"});class R extends c.Ay{patterns;settings;constructor(){super("XViewPatternAnalysis"),this.version(1).stores({patterns:"++id, name, type, status, enable, image, embedding, description, createUser, createTimestamp",settings:"++id, enableRealtimeMessage, enableAutoAdjustAllowance, allowanceForTransaction, allowanceForError, allowanceForPatternRecognition"})}}const f=new R;importScripts("/script/tf.js");let C=8e3,P=C*.2,S=C*.5,w=10,b=60*w*1e3,y=parseInt(`${b/n.W}`),J=parseInt(`${C/n.H}`);async function Z(){const r={},e={};return await f.patterns.each(o=>{r[o.id]=o.embedding,e[o.id]=o}),[r,e]}function q(r){w=r,b=60*w*1e3,y=parseInt(`${b/n.W}`)}function G(r){C=r,P=C*.2,S=C*.5,J=parseInt(`${C/n.H}`)}function ee(r,e){const u=C/r;return u>2||u<.5?e=[]:e=e.map(l=>l*u),G(r),e}function $(r,e,o){if(r){let u=0;return e.forEach(d=>{d[1]>u&&(u=d[1])}),ee(u,o)}return o}function U(r){let e=0;return r.forEach(o=>{o[1]>=P&&o[1]<S?e+=1:o[1]>=S&&(e+=5)}),e}function k(r){let e=0;return r.forEach(o=>{o[2]!==0&&n.lL[o[2]]!==void 0&&(e+=n.lL[o[2]])}),e}function te(r){const e=new Array(n.r2*n.y$).fill(0);for(let o=0;o<n.H;o++)for(let u=0;u<n.W;u++){const l=parseInt(`${u/(n.W/n.r2)}`),E=parseInt(`${o/(n.H/n.y$)}`)*n.r2+l,g=o*n.W+u;e[E]==0&&r[g]>0&&(e[E]=n.lv[E])}return e.reduce((o,u)=>o+u,0)}function x(r,e){return r>0&&e>0?(r=Math.min(r,e),r=r/e):r=0,parseFloat(r.toFixed(3))}function re(r,e,o){return r*=1,e*=1,o*=1,parseFloat((1-(r+e+o)/3).toFixed(3))}async function ne(r){const e=await a.g.tf.loadGraphModel(n.Qv),[o,u]=await Z();try{const d=e.predict(r).arraySync()[0];return oe(o,u,d)}catch{}return null}function oe(r,e,o){const u=[];for(const l in r){let d=0;for(const E of r[l]){let g=se(E,o);g=Math.min(Math.max(g,0),1),d=Math.max(d,g)}u.push({row:e[l],score:e[l].enable?parseFloat(d.toFixed(3)):0})}return u}function se(r,e){const o=r.length;let u=0,l=0,d=0;for(let E=0;E<o;E++)u+=r[E]*e[E],l+=r[E]**2,d+=e[E]**2;return l=Math.sqrt(l),d=Math.sqrt(d),u/(l*d)}self.onmessage=async({data:r})=>{const e=await f.settings.get(1);if(e!==void 0&&e.enableRealtimeMessage===!0){let o,u,{rows:l,startTime:d,endTime:E,penaltyLimit:g=120,autoMaxY:Y=!1,axisMax:V=8e3,oldDelayPenalty:A=[],oldErrorPenalty:M=[],oldRows:K=[],isRealtime:ae=!0}=r;const Q=E-d;if(q(Q/1e3/60),G(V),A=$(Y,l,A),A.push(U(K)),M.push(k(K)),A.length>g&&A.shift(),M.length>g&&M.shift(),ae&&e.enableAutoAdjustAllowance){const p=A.reduce((O,m)=>O+m,0),H=M.reduce((O,m)=>O+m,0);o=Math.max(p/A.length*g,1)*4,u=Math.max(H/M.length*g,1)*4}else o=e.allowanceForTransaction,u=e.allowanceForError;A=$(Y,l,A);const z=(0,t.d)(l,d,Q,V);let B=U(l);B=x(B,o);let W=k(l);W=x(W,u);let F=te(z);F=x(F,n.YX);const D=re(B,W,F),ie=e.allowanceForPatternRecognition/10;a.g.tf.engine().startScope();const ue=[1,n.H,n.W,1],le=a.g.tf.tensor(z,ue);let v=await ne(le);if(a.g.tf.engine().endScope(),v!==null){v=v.map(I=>(I.score<.65?I.score=parseFloat((.7692307692307692*(I.score-0)+0).toFixed(3)):I.score=parseFloat((1.4285714285714286*(I.score-.65)+.5).toFixed(3)),I)).sort((I,ce)=>ce.score-I.score);const p=v[0],H=p.row.status==="normal";let O,m,T,L,N;p.score>ie?H?D>=.5?(m=!0,T=parseInt(`${D*100}`),L="",N="",O="(\uC815\uC0C1) \uC815\uC0C1 \uC0C1\uD0DC\uC77C \uAC00\uB2A5\uC131\uC774 "+T+"% \uC785\uB2C8\uB2E4."):(m=!0,T=parseInt(`${p.score*100}`),L=p.row.name,N=p.row.description,O="(\uC815\uC0C1) "+p.row.name+" \uD328\uD134\uC77C \uAC00\uB2A5\uC131\uC774 "+T+"% \uC785\uB2C8\uB2E4."):(m=!1,T=parseInt(`${p.score*100}`),L=p.row.name,N=p.row.description,O="(\uBE44\uC815\uC0C1) "+p.row.name+" \uD328\uD134\uC77C \uAC00\uB2A5\uC131\uC774 "+T+"% \uC785\uB2C8\uB2E4."):(L="",N="",D>=.5?(m=!0,T=parseInt(`${D*100}`)):(m=!1,T=parseInt(`${(1-D)*100}`),O="(\uBE44\uC815\uC0C1) \uBE44\uC815\uC0C1 \uC0C1\uD0DC\uC77C \uAC00\uB2A5\uC131\uC774 "+T+"% \uC785\uB2C8\uB2E4.")),self.postMessage({patternActive:l.length>0,patternStatus:m,patternScore:T,patternName:L,patternDescription:N,oldDelayPenalty:A,oldErrorPenalty:M,autoAdjust:e.enableAutoAdjustAllowance})}}}}},j={};function i(s){var _=j[s];if(_!==void 0)return _.exports;var a=j[s]={exports:{}};return X[s].call(a.exports,a,a.exports,i),a.exports}i.m=X,i.x=()=>{var s=i.O(void 0,[41091,18757],()=>i(95479));return s=i.O(s),s},(()=>{var s=[];i.O=(_,a,t,n)=>{if(a){n=n||0;for(var c=s.length;c>0&&s[c-1][2]>n;c--)s[c]=s[c-1];s[c]=[a,t,n];return}for(var h=1/0,c=0;c<s.length;c++){for(var[a,t,n]=s[c],R=!0,f=0;f<a.length;f++)(n&!1||h>=n)&&Object.keys(i.O).every(y=>i.O[y](a[f]))?a.splice(f--,1):(R=!1,n<h&&(h=n));if(R){s.splice(c--,1);var C=t();C!==void 0&&(_=C)}}return _}})(),i.d=(s,_)=>{for(var a in _)i.o(_,a)&&!i.o(s,a)&&Object.defineProperty(s,a,{enumerable:!0,get:_[a]})},i.f={},i.e=s=>Promise.all(Object.keys(i.f).reduce((_,a)=>(i.f[a](s,_),_),[])),i.u=s=>""+s+".js",i.miniCssF=s=>{},i.g=function(){if(typeof globalThis=="object")return globalThis;try{return this||new Function("return this")()}catch{if(typeof window=="object")return window}}(),i.o=(s,_)=>Object.prototype.hasOwnProperty.call(s,_),i.p="/bundles/",(()=>{var s={17860:1,50717:1,95479:1},_=n=>{var[c,h,R]=n;for(var f in h)i.o(h,f)&&(i.m[f]=h[f]);for(R&&R(i);c.length;)s[c.pop()]=1;t(n)};i.f.i=(n,c)=>{s[n]||importScripts(i.p+i.u(n))};var a=self.webpackChunkjennifer5_frontend=self.webpackChunkjennifer5_frontend||[],t=a.push.bind(a);a.push=_})(),(()=>{var s=i.x;i.x=()=>Promise.all([i.e(41091),i.e(18757)]).then(s)})();var _e=i.x()})();
