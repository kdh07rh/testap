"use strict";(self.webpackChunkjennifer5_frontend=self.webpackChunkjennifer5_frontend||[]).push([[12162],{6006:(me,X,T)=>{T.d(X,{T:()=>A});var V=T(22796),K=T(45635),j=T(67083),x=T(78386);function M(_){if(_.length===0)return null;if(_.length===1)return _[0];let I=0;function h(){if(I>=_.length)return null;const S=I,z=_[S].listHeight;for(I++;I<_.length&&_[I].listHeight===z;)I++;return I-S>=2?c(S===0&&I===_.length?_:_.slice(S,I),!1):_[S]}let f=h(),v=h();if(!v)return f;for(let S=h();S;S=h())C(f,v)<=C(v,S)?(f=d(f,v),v=S):v=d(v,S);return d(f,v)}function c(_,I=!1){if(_.length===0)return null;if(_.length===1)return _[0];let h=_.length;for(;h>3;){const f=h>>1;for(let v=0;v<f;v++){const P=v<<1;_[v]=V.Xw.create23(_[P],_[P+1],P+3===h?_[P+2]:null,I)}h=f}return V.Xw.create23(_[0],_[1],h>=3?_[2]:null,I)}function C(_,I){return Math.abs(_.listHeight-I.listHeight)}function d(_,I){return _.listHeight===I.listHeight?V.Xw.create23(_,I,null,!1):_.listHeight>I.listHeight?L(_,I):b(I,_)}function L(_,I){_=_.toMutable();let h=_;const f=[];let v;for(;;){if(I.listHeight===h.listHeight){v=I;break}if(h.kind!==4)throw new Error("unexpected");f.push(h),h=h.makeLastElementMutable()}for(let P=f.length-1;P>=0;P--){const S=f[P];v?S.childrenLength>=3?v=V.Xw.create23(S.unappendChild(),v,null,!1):(S.appendChildOfSameHeight(v),v=void 0):S.handleChildrenChanged()}return v?V.Xw.create23(_,v,null,!1):_}function b(_,I){_=_.toMutable();let h=_;const f=[];for(;I.listHeight!==h.listHeight;){if(h.kind!==4)throw new Error("unexpected");f.push(h),h=h.makeFirstElementMutable()}let v=I;for(let P=f.length-1;P>=0;P--){const S=f[P];v?S.childrenLength>=3?v=V.Xw.create23(v,S.unprependChild(),null,!1):(S.prependChildOfSameHeight(v),v=void 0):S.handleChildrenChanged()}return v?V.Xw.create23(v,_,null,!1):_}class p{constructor(I){this.lastOffset=x.Vp,this.nextNodes=[I],this.offsets=[x.Vp],this.idxs=[]}readLongestNodeAt(I,h){if((0,x.zG)(I,this.lastOffset))throw new Error("Invalid offset");for(this.lastOffset=I;;){const f=B(this.nextNodes);if(!f)return;const v=B(this.offsets);if((0,x.zG)(I,v))return;if((0,x.zG)(v,I))if((0,x.QB)(v,f.length)<=I)this.nextNodeAfterCurrent();else{const P=w(f);P!==-1?(this.nextNodes.push(f.getChild(P)),this.offsets.push(v),this.idxs.push(P)):this.nextNodeAfterCurrent()}else{if(h(f))return this.nextNodeAfterCurrent(),f;{const P=w(f);if(P===-1){this.nextNodeAfterCurrent();return}else this.nextNodes.push(f.getChild(P)),this.offsets.push(v),this.idxs.push(P)}}}}nextNodeAfterCurrent(){for(;;){const I=B(this.offsets),h=B(this.nextNodes);if(this.nextNodes.pop(),this.offsets.pop(),this.idxs.length===0)break;const f=B(this.nextNodes),v=w(f,this.idxs[this.idxs.length-1]);if(v!==-1){this.nextNodes.push(f.getChild(v)),this.offsets.push((0,x.QB)(I,h.length)),this.idxs[this.idxs.length-1]=v;break}else this.idxs.pop()}}}function w(_,I=-1){for(;;){if(I++,I>=_.childrenLength)return-1;if(_.getChild(I))return I}}function B(_){return _.length>0?_[_.length-1]:void 0}function A(_,I,h,f){return new G(_,I,h,f).parseDocument()}class G{constructor(I,h,f,v){if(this.tokenizer=I,this.createImmutableLists=v,this._itemsConstructed=0,this._itemsFromCache=0,f&&v)throw new Error("Not supported");this.oldNodeReader=f?new p(f):void 0,this.positionMapper=new K.W(h)}parseDocument(){this._itemsConstructed=0,this._itemsFromCache=0;let I=this.parseList(j.gV.getEmpty(),0);return I||(I=V.Xw.getEmpty()),I}parseList(I,h){const f=[];for(;;){let P=this.tryReadChildFromCache(I);if(!P){const S=this.tokenizer.peek();if(!S||S.kind===2&&S.bracketIds.intersects(I))break;P=this.parseChild(I,h+1)}P.kind===4&&P.childrenLength===0||f.push(P)}return this.oldNodeReader?M(f):c(f,this.createImmutableLists)}tryReadChildFromCache(I){if(this.oldNodeReader){const h=this.positionMapper.getDistanceToNextChange(this.tokenizer.offset);if(h===null||!(0,x.Vh)(h)){const f=this.oldNodeReader.readLongestNodeAt(this.positionMapper.getOffsetBeforeChange(this.tokenizer.offset),v=>h!==null&&!(0,x.zG)(v.length,h)?!1:v.canBeReused(I));if(f)return this._itemsFromCache++,this.tokenizer.skip(f.length),f}}}parseChild(I,h){this._itemsConstructed++;const f=this.tokenizer.read();switch(f.kind){case 2:return new V.Gc(f.bracketIds,f.length);case 0:return f.astNode;case 1:{if(h>300)return new V.yF(f.length);const v=I.merge(f.bracketIds),P=this.parseList(v,h+1),S=this.tokenizer.peek();return S&&S.kind===2&&(S.bracketId===f.bracketId||S.bracketIds.intersects(f.bracketIds))?(this.tokenizer.read(),V.Nn.create(f.astNode,P,S.astNode)):V.Nn.create(f.astNode,P,null)}default:throw new Error("unexpected")}}}},8731:(me,X,T)=>{T.d(X,{P:()=>L,k:()=>b});var V=T(51922),K=T(85565),j=T(23418),x=T(98414),M=T(52216),c=T(95312),C=T(52630),d=T(87856);class L extends M._{constructor(w,B){super(),this.textModel=w,this.languageConfigurationService=B}getLanguageConfiguration(w){return this.languageConfigurationService.getLanguageConfiguration(w)}_computeIndentLevel(w){return(0,c.G)(this.textModel.getLineContent(w+1),this.textModel.getOptions().tabSize)}getActiveIndentGuide(w,B,A){this.assertNotDisposed();const G=this.textModel.getLineCount();if(w<1||w>G)throw new d.D7("Illegal value for lineNumber");const _=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,I=!!(_&&_.offSide);let h=-2,f=-1,v=-2,P=-1;const S=oe=>{if(h!==-1&&(h===-2||h>oe-1)){h=-1,f=-1;for(let ae=oe-2;ae>=0;ae--){const fe=this._computeIndentLevel(ae);if(fe>=0){h=ae,f=fe;break}}}if(v===-2){v=-1,P=-1;for(let ae=oe;ae<G;ae++){const fe=this._computeIndentLevel(ae);if(fe>=0){v=ae,P=fe;break}}}};let z=-2,D=-1,E=-2,y=-1;const W=oe=>{if(z===-2){z=-1,D=-1;for(let ae=oe-2;ae>=0;ae--){const fe=this._computeIndentLevel(ae);if(fe>=0){z=ae,D=fe;break}}}if(E!==-1&&(E===-2||E<oe-1)){E=-1,y=-1;for(let ae=oe;ae<G;ae++){const fe=this._computeIndentLevel(ae);if(fe>=0){E=ae,y=fe;break}}}};let $=0,Y=!0,ne=0,ue=!0,_e=0,he=0;for(let oe=0;Y||ue;oe++){const ae=w-oe,fe=w+oe;oe>1&&(ae<1||ae<B)&&(Y=!1),oe>1&&(fe>G||fe>A)&&(ue=!1),oe>5e4&&(Y=!1,ue=!1);let Ce=-1;if(Y&&ae>=1){const Te=this._computeIndentLevel(ae-1);Te>=0?(v=ae-1,P=Te,Ce=Math.ceil(Te/this.textModel.getOptions().indentSize)):(S(ae),Ce=this._getIndentLevelForWhitespaceLine(I,f,P))}let Ie=-1;if(ue&&fe<=G){const Te=this._computeIndentLevel(fe-1);Te>=0?(z=fe-1,D=Te,Ie=Math.ceil(Te/this.textModel.getOptions().indentSize)):(W(fe),Ie=this._getIndentLevelForWhitespaceLine(I,D,y))}if(oe===0){he=Ce;continue}if(oe===1){if(fe<=G&&Ie>=0&&he+1===Ie){Y=!1,$=fe,ne=fe,_e=Ie;continue}if(ae>=1&&Ce>=0&&Ce-1===he){ue=!1,$=ae,ne=ae,_e=Ce;continue}if($=w,ne=w,_e=he,_e===0)return{startLineNumber:$,endLineNumber:ne,indent:_e}}Y&&(Ce>=_e?$=ae:Y=!1),ue&&(Ie>=_e?ne=fe:ue=!1)}return{startLineNumber:$,endLineNumber:ne,indent:_e}}getLinesBracketGuides(w,B,A,G){const _=[];for(let S=w;S<=B;S++)_.push([]);const I=!0,h=this.textModel.bracketPairs.getBracketPairsInRangeWithMinIndentation(new x.Q(w,1,B,this.textModel.getLineMaxColumn(B))).toArray();let f;if(A&&h.length>0){const S=(w<=A.lineNumber&&A.lineNumber<=B?h:this.textModel.bracketPairs.getBracketPairsInRange(x.Q.fromPositions(A)).toArray()).filter(z=>x.Q.strictContainsPosition(z.range,A));f=(0,V.Uk)(S,z=>I||z.range.startLineNumber!==z.range.endLineNumber)?.range}const v=this.textModel.getOptions().bracketPairColorizationOptions.independentColorPoolPerBracketType,P=new b;for(const S of h){if(!S.closingBracketRange)continue;const z=f&&S.range.equalsRange(f);if(!z&&!G.includeInactive)continue;const D=P.getInlineClassName(S.nestingLevel,S.nestingLevelOfEqualBracketType,v)+(G.highlightActive&&z?" "+P.activeClassName:""),E=S.openingBracketRange.getStartPosition(),y=S.closingBracketRange.getStartPosition(),W=G.horizontalGuides===C.N6.Enabled||G.horizontalGuides===C.N6.EnabledForActive&&z;if(S.range.startLineNumber===S.range.endLineNumber){I&&W&&_[S.range.startLineNumber-w].push(new C.TH(-1,S.openingBracketRange.getEndPosition().column,D,new C.pv(!1,y.column),-1,-1));continue}const $=this.getVisibleColumnFromPosition(y),Y=this.getVisibleColumnFromPosition(S.openingBracketRange.getStartPosition()),ne=Math.min(Y,$,S.minVisibleColumnIndentation+1);let ue=!1;K.HG(this.textModel.getLineContent(S.closingBracketRange.startLineNumber))<S.closingBracketRange.startColumn-1&&(ue=!0);const oe=Math.max(E.lineNumber,w),ae=Math.min(y.lineNumber,B),fe=ue?1:0;for(let Ce=oe;Ce<ae+fe;Ce++)_[Ce-w].push(new C.TH(ne,-1,D,null,Ce===E.lineNumber?E.column:-1,Ce===y.lineNumber?y.column:-1));W&&(E.lineNumber>=w&&Y>ne&&_[E.lineNumber-w].push(new C.TH(ne,-1,D,new C.pv(!1,E.column),-1,-1)),y.lineNumber<=B&&$>ne&&_[y.lineNumber-w].push(new C.TH(ne,-1,D,new C.pv(!ue,y.column),-1,-1)))}for(const S of _)S.sort((z,D)=>z.visibleColumn-D.visibleColumn);return _}getVisibleColumnFromPosition(w){return j.A.visibleColumnFromColumn(this.textModel.getLineContent(w.lineNumber),w.column,this.textModel.getOptions().tabSize)+1}getLinesIndentGuides(w,B){this.assertNotDisposed();const A=this.textModel.getLineCount();if(w<1||w>A)throw new Error("Illegal value for startLineNumber");if(B<1||B>A)throw new Error("Illegal value for endLineNumber");const G=this.textModel.getOptions(),_=this.getLanguageConfiguration(this.textModel.getLanguageId()).foldingRules,I=!!(_&&_.offSide),h=new Array(B-w+1);let f=-2,v=-1,P=-2,S=-1;for(let z=w;z<=B;z++){const D=z-w,E=this._computeIndentLevel(z-1);if(E>=0){f=z-1,v=E,h[D]=Math.ceil(E/G.indentSize);continue}if(f===-2){f=-1,v=-1;for(let y=z-2;y>=0;y--){const W=this._computeIndentLevel(y);if(W>=0){f=y,v=W;break}}}if(P!==-1&&(P===-2||P<z-1)){P=-1,S=-1;for(let y=z;y<A;y++){const W=this._computeIndentLevel(y);if(W>=0){P=y,S=W;break}}}h[D]=this._getIndentLevelForWhitespaceLine(I,v,S)}return h}_getIndentLevelForWhitespaceLine(w,B,A){const G=this.textModel.getOptions();return B===-1||A===-1?0:B<A?1+Math.floor(B/G.indentSize):B===A||w?Math.ceil(A/G.indentSize):1+Math.floor(A/G.indentSize)}}class b{constructor(){this.activeClassName="indent-active"}getInlineClassName(w,B,A){return this.getInlineClassNameOfLevel(A?B:w)}getInlineClassNameOfLevel(w){return`bracket-indent-guide lvl-${w%30}`}}},12162:(me,X,T)=>{T.r(X),T.d(X,{DefaultModelSHA1Computer:()=>z,ModelService:()=>S});var V=T(56491),K=T(60599),j=T(90692),x=T(87451),M=T(28841),c=T(49896),C=T(84059),d=T(54752),L=T(30894),b=T(79475),p=T(95981),w=T(54021),B=T(3223),A=T(81545),G=function(D,E,y,W){var $=arguments.length,Y=$<3?E:W===null?W=Object.getOwnPropertyDescriptor(E,y):W,ne;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")Y=Reflect.decorate(D,E,y,W);else for(var ue=D.length-1;ue>=0;ue--)(ne=D[ue])&&(Y=($<3?ne(Y):$>3?ne(E,y,Y):ne(E,y))||Y);return $>3&&Y&&Object.defineProperty(E,y,Y),Y},_=function(D,E){return function(y,W){E(y,W,D)}},I;function h(D){return D.toString()}class f{constructor(E,y,W){this.model=E,this._modelEventListeners=new K.Cm,this.model=E,this._modelEventListeners.add(E.onWillDispose(()=>y(E))),this._modelEventListeners.add(E.onDidChangeLanguage($=>W(E,$)))}dispose(){this._modelEventListeners.dispose()}}const v=j.j9||j.zx?1:2;class P{constructor(E,y,W,$,Y,ne,ue,_e){this.uri=E,this.initialUndoRedoSnapshot=y,this.time=W,this.sharesUndoRedoStack=$,this.heapSize=Y,this.sha1=ne,this.versionId=ue,this.alternativeVersionId=_e}}let S=class extends K.jG{static{I=this}static{this.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK=20*1024*1024}constructor(E,y,W,$){super(),this._configurationService=E,this._resourcePropertiesService=y,this._undoRedoService=W,this._instantiationService=$,this._onModelAdded=this._register(new V.vl),this.onModelAdded=this._onModelAdded.event,this._onModelRemoved=this._register(new V.vl),this.onModelRemoved=this._onModelRemoved.event,this._onModelModeChanged=this._register(new V.vl),this.onModelLanguageChanged=this._onModelModeChanged.event,this._modelCreationOptionsByLanguageAndResource=Object.create(null),this._models={},this._disposedModels=new Map,this._disposedModelsHeapSize=0,this._register(this._configurationService.onDidChangeConfiguration(Y=>this._updateModelOptions(Y))),this._updateModelOptions(void 0)}static _readModelOptions(E,y){let W=M.R.tabSize;if(E.editor&&typeof E.editor.tabSize<"u"){const fe=parseInt(E.editor.tabSize,10);isNaN(fe)||(W=fe),W<1&&(W=1)}let $="tabSize";if(E.editor&&typeof E.editor.indentSize<"u"&&E.editor.indentSize!=="tabSize"){const fe=parseInt(E.editor.indentSize,10);isNaN(fe)||($=Math.max(fe,1))}let Y=M.R.insertSpaces;E.editor&&typeof E.editor.insertSpaces<"u"&&(Y=E.editor.insertSpaces==="false"?!1:!!E.editor.insertSpaces);let ne=v;const ue=E.eol;ue===`\r
`?ne=2:ue===`
`&&(ne=1);let _e=M.R.trimAutoWhitespace;E.editor&&typeof E.editor.trimAutoWhitespace<"u"&&(_e=E.editor.trimAutoWhitespace==="false"?!1:!!E.editor.trimAutoWhitespace);let he=M.R.detectIndentation;E.editor&&typeof E.editor.detectIndentation<"u"&&(he=E.editor.detectIndentation==="false"?!1:!!E.editor.detectIndentation);let oe=M.R.largeFileOptimizations;E.editor&&typeof E.editor.largeFileOptimizations<"u"&&(oe=E.editor.largeFileOptimizations==="false"?!1:!!E.editor.largeFileOptimizations);let ae=M.R.bracketPairColorizationOptions;return E.editor?.bracketPairColorization&&typeof E.editor.bracketPairColorization=="object"&&(ae={enabled:!!E.editor.bracketPairColorization.enabled,independentColorPoolPerBracketType:!!E.editor.bracketPairColorization.independentColorPoolPerBracketType}),{isForSimpleWidget:y,tabSize:W,indentSize:$,insertSpaces:Y,detectIndentation:he,defaultEOL:ne,trimAutoWhitespace:_e,largeFileOptimizations:oe,bracketPairColorizationOptions:ae}}_getEOL(E,y){if(E)return this._resourcePropertiesService.getEOL(E,y);const W=this._configurationService.getValue("files.eol",{overrideIdentifier:y});return W&&typeof W=="string"&&W!=="auto"?W:j.OS===3||j.OS===2?`
`:`\r
`}_shouldRestoreUndoStack(){const E=this._configurationService.getValue("files.restoreUndoStack");return typeof E=="boolean"?E:!0}getCreationOptions(E,y,W){const $=typeof E=="string"?E:E.languageId;let Y=this._modelCreationOptionsByLanguageAndResource[$+y];if(!Y){const ne=this._configurationService.getValue("editor",{overrideIdentifier:$,resource:y}),ue=this._getEOL(y,$);Y=I._readModelOptions({editor:ne,eol:ue},W),this._modelCreationOptionsByLanguageAndResource[$+y]=Y}return Y}_updateModelOptions(E){const y=this._modelCreationOptionsByLanguageAndResource;this._modelCreationOptionsByLanguageAndResource=Object.create(null);const W=Object.keys(this._models);for(let $=0,Y=W.length;$<Y;$++){const ne=W[$],ue=this._models[ne],_e=ue.model.getLanguageId(),he=ue.model.uri;if(E&&!E.affectsConfiguration("editor",{overrideIdentifier:_e,resource:he})&&!E.affectsConfiguration("files.eol",{overrideIdentifier:_e,resource:he}))continue;const oe=y[_e+he],ae=this.getCreationOptions(_e,he,ue.model.isForSimpleWidget);I._setModelOptionsForModel(ue.model,ae,oe)}}static _setModelOptionsForModel(E,y,W){W&&W.defaultEOL!==y.defaultEOL&&E.getLineCount()===1&&E.setEOL(y.defaultEOL===1?0:1),!(W&&W.detectIndentation===y.detectIndentation&&W.insertSpaces===y.insertSpaces&&W.tabSize===y.tabSize&&W.indentSize===y.indentSize&&W.trimAutoWhitespace===y.trimAutoWhitespace&&(0,B.aI)(W.bracketPairColorizationOptions,y.bracketPairColorizationOptions))&&(y.detectIndentation?(E.detectIndentation(y.insertSpaces,y.tabSize),E.updateOptions({trimAutoWhitespace:y.trimAutoWhitespace,bracketColorizationOptions:y.bracketPairColorizationOptions})):E.updateOptions({insertSpaces:y.insertSpaces,tabSize:y.tabSize,indentSize:y.indentSize,trimAutoWhitespace:y.trimAutoWhitespace,bracketColorizationOptions:y.bracketPairColorizationOptions}))}_insertDisposedModel(E){this._disposedModels.set(h(E.uri),E),this._disposedModelsHeapSize+=E.heapSize}_removeDisposedModel(E){const y=this._disposedModels.get(h(E));return y&&(this._disposedModelsHeapSize-=y.heapSize),this._disposedModels.delete(h(E)),y}_ensureDisposedModelsHeapSize(E){if(this._disposedModelsHeapSize>E){const y=[];for(this._disposedModels.forEach(W=>{W.sharesUndoRedoStack||y.push(W)}),y.sort((W,$)=>W.time-$.time);y.length>0&&this._disposedModelsHeapSize>E;){const W=y.shift();this._removeDisposedModel(W.uri),W.initialUndoRedoSnapshot!==null&&this._undoRedoService.restoreSnapshot(W.initialUndoRedoSnapshot)}}}_createModelData(E,y,W,$){const Y=this.getCreationOptions(y,W,$),ne=this._instantiationService.createInstance(x.Bz,E,y,Y,W);if(W&&this._disposedModels.has(h(W))){const he=this._removeDisposedModel(W),oe=this._undoRedoService.getElements(W),ae=this._getSHA1Computer(),fe=ae.canComputeSHA1(ne)?ae.computeSHA1(ne)===he.sha1:!1;if(fe||he.sharesUndoRedoStack){for(const Ce of oe.past)(0,p.Th)(Ce)&&Ce.matchesResource(W)&&Ce.setModel(ne);for(const Ce of oe.future)(0,p.Th)(Ce)&&Ce.matchesResource(W)&&Ce.setModel(ne);this._undoRedoService.setElementsValidFlag(W,!0,Ce=>(0,p.Th)(Ce)&&Ce.matchesResource(W)),fe&&(ne._overwriteVersionId(he.versionId),ne._overwriteAlternativeVersionId(he.alternativeVersionId),ne._overwriteInitialUndoRedoSnapshot(he.initialUndoRedoSnapshot))}else he.initialUndoRedoSnapshot!==null&&this._undoRedoService.restoreSnapshot(he.initialUndoRedoSnapshot)}const ue=h(ne.uri);if(this._models[ue])throw new Error("ModelService: Cannot add model because it already exists!");const _e=new f(ne,he=>this._onWillDispose(he),(he,oe)=>this._onDidChangeLanguage(he,oe));return this._models[ue]=_e,_e}createModel(E,y,W,$=!1){let Y;return y?Y=this._createModelData(E,y,W,$):Y=this._createModelData(E,c.vH,W,$),this._onModelAdded.fire(Y.model),Y.model}getModels(){const E=[],y=Object.keys(this._models);for(let W=0,$=y.length;W<$;W++){const Y=y[W];E.push(this._models[Y].model)}return E}getModel(E){const y=h(E),W=this._models[y];return W?W.model:null}_schemaShouldMaintainUndoRedoElements(E){return E.scheme===w.ny.file||E.scheme===w.ny.vscodeRemote||E.scheme===w.ny.vscodeUserData||E.scheme===w.ny.vscodeNotebookCell||E.scheme==="fake-fs"}_onWillDispose(E){const y=h(E.uri),W=this._models[y],$=this._undoRedoService.getUriComparisonKey(E.uri)!==E.uri.toString();let Y=!1,ne=0;if($||this._shouldRestoreUndoStack()&&this._schemaShouldMaintainUndoRedoElements(E.uri)){const he=this._undoRedoService.getElements(E.uri);if(he.past.length>0||he.future.length>0){for(const oe of he.past)(0,p.Th)(oe)&&oe.matchesResource(E.uri)&&(Y=!0,ne+=oe.heapSize(E.uri),oe.setModel(E.uri));for(const oe of he.future)(0,p.Th)(oe)&&oe.matchesResource(E.uri)&&(Y=!0,ne+=oe.heapSize(E.uri),oe.setModel(E.uri))}}const ue=I.MAX_MEMORY_FOR_CLOSED_FILES_UNDO_STACK,_e=this._getSHA1Computer();if(Y)if(!$&&(ne>ue||!_e.canComputeSHA1(E))){const he=W.model.getInitialUndoRedoSnapshot();he!==null&&this._undoRedoService.restoreSnapshot(he)}else this._ensureDisposedModelsHeapSize(ue-ne),this._undoRedoService.setElementsValidFlag(E.uri,!1,he=>(0,p.Th)(he)&&he.matchesResource(E.uri)),this._insertDisposedModel(new P(E.uri,W.model.getInitialUndoRedoSnapshot(),Date.now(),$,ne,_e.computeSHA1(E),E.getVersionId(),E.getAlternativeVersionId()));else if(!$){const he=W.model.getInitialUndoRedoSnapshot();he!==null&&this._undoRedoService.restoreSnapshot(he)}delete this._models[y],W.dispose(),delete this._modelCreationOptionsByLanguageAndResource[E.getLanguageId()+E.uri],this._onModelRemoved.fire(E)}_onDidChangeLanguage(E,y){const W=y.oldLanguage,$=E.getLanguageId(),Y=this.getCreationOptions(W,E.uri,E.isForSimpleWidget),ne=this.getCreationOptions($,E.uri,E.isForSimpleWidget);I._setModelOptionsForModel(E,ne,Y),this._onModelModeChanged.fire({model:E,oldLanguageId:W})}_getSHA1Computer(){return new z}};S=I=G([_(0,d.pG),_(1,C.ITextResourcePropertiesService),_(2,L.$D),_(3,A._Y)],S);class z{static{this.MAX_MODEL_SIZE=10*1024*1024}canComputeSHA1(E){return E.getValueLength()<=z.MAX_MODEL_SIZE}computeSHA1(E){const y=new b.v7,W=E.createSnapshot();let $;for(;$=W.read();)y.update($);return y.digest()}}},14216:(me,X,T)=>{T.d(X,{T:()=>x,f:()=>K});var V=T(71269);class K{static{this.defaultTokenMetadata=(32768|2<<24)>>>0}static createEmpty(c,C){const d=K.defaultTokenMetadata,L=new Uint32Array(2);return L[0]=c.length,L[1]=d,new K(L,c,C)}static createFromTextAndMetadata(c,C){let d=0,L="";const b=new Array;for(const{text:p,metadata:w}of c)b.push(d+p.length,w),d+=p.length,L+=p;return new K(new Uint32Array(b),L,C)}constructor(c,C,d){this._lineTokensBrand=void 0,this._tokens=c,this._tokensCount=this._tokens.length>>>1,this._text=C,this.languageIdCodec=d}equals(c){return c instanceof K?this.slicedEquals(c,0,this._tokensCount):!1}slicedEquals(c,C,d){if(this._text!==c._text||this._tokensCount!==c._tokensCount)return!1;const L=C<<1,b=L+(d<<1);for(let p=L;p<b;p++)if(this._tokens[p]!==c._tokens[p])return!1;return!0}getLineContent(){return this._text}getCount(){return this._tokensCount}getStartOffset(c){return c>0?this._tokens[c-1<<1]:0}getMetadata(c){return this._tokens[(c<<1)+1]}getLanguageId(c){const C=this._tokens[(c<<1)+1],d=V.x.getLanguageId(C);return this.languageIdCodec.decodeLanguageId(d)}getStandardTokenType(c){const C=this._tokens[(c<<1)+1];return V.x.getTokenType(C)}getForeground(c){const C=this._tokens[(c<<1)+1];return V.x.getForeground(C)}getClassName(c){const C=this._tokens[(c<<1)+1];return V.x.getClassNameFromMetadata(C)}getInlineStyle(c,C){const d=this._tokens[(c<<1)+1];return V.x.getInlineStyleFromMetadata(d,C)}getPresentation(c){const C=this._tokens[(c<<1)+1];return V.x.getPresentationFromMetadata(C)}getEndOffset(c){return this._tokens[c<<1]}findTokenIndexAtOffset(c){return K.findIndexInTokensArray(this._tokens,c)}inflate(){return this}sliceAndInflate(c,C,d){return new j(this,c,C,d)}static convertToEndOffset(c,C){const L=(c.length>>>1)-1;for(let b=0;b<L;b++)c[b<<1]=c[b+1<<1];c[L<<1]=C}static findIndexInTokensArray(c,C){if(c.length<=2)return 0;let d=0,L=(c.length>>>1)-1;for(;d<L;){const b=d+Math.floor((L-d)/2),p=c[b<<1];if(p===C)return b+1;p<C?d=b+1:p>C&&(L=b)}return d}withInserted(c){if(c.length===0)return this;let C=0,d=0,L="";const b=new Array;let p=0;for(;;){const w=C<this._tokensCount?this._tokens[C<<1]:-1,B=d<c.length?c[d]:null;if(w!==-1&&(B===null||w<=B.offset)){L+=this._text.substring(p,w);const A=this._tokens[(C<<1)+1];b.push(L.length,A),C++,p=w}else if(B){if(B.offset>p){L+=this._text.substring(p,B.offset);const A=this._tokens[(C<<1)+1];b.push(L.length,A),p=B.offset}L+=B.text,b.push(L.length,B.tokenMetadata),d++}else break}return new K(new Uint32Array(b),L,this.languageIdCodec)}getTokenText(c){const C=this.getStartOffset(c),d=this.getEndOffset(c);return this._text.substring(C,d)}forEach(c){const C=this.getCount();for(let d=0;d<C;d++)c(d)}}class j{constructor(c,C,d,L){this._source=c,this._startOffset=C,this._endOffset=d,this._deltaOffset=L,this._firstTokenIndex=c.findTokenIndexAtOffset(C),this.languageIdCodec=c.languageIdCodec,this._tokensCount=0;for(let b=this._firstTokenIndex,p=c.getCount();b<p&&!(c.getStartOffset(b)>=d);b++)this._tokensCount++}getMetadata(c){return this._source.getMetadata(this._firstTokenIndex+c)}getLanguageId(c){return this._source.getLanguageId(this._firstTokenIndex+c)}getLineContent(){return this._source.getLineContent().substring(this._startOffset,this._endOffset)}equals(c){return c instanceof j?this._startOffset===c._startOffset&&this._endOffset===c._endOffset&&this._deltaOffset===c._deltaOffset&&this._source.slicedEquals(c._source,this._firstTokenIndex,this._tokensCount):!1}getCount(){return this._tokensCount}getStandardTokenType(c){return this._source.getStandardTokenType(this._firstTokenIndex+c)}getForeground(c){return this._source.getForeground(this._firstTokenIndex+c)}getEndOffset(c){const C=this._source.getEndOffset(this._firstTokenIndex+c);return Math.min(this._endOffset,C)-this._startOffset+this._deltaOffset}getClassName(c){return this._source.getClassName(this._firstTokenIndex+c)}getInlineStyle(c,C){return this._source.getInlineStyle(this._firstTokenIndex+c,C)}getPresentation(c){return this._source.getPresentation(this._firstTokenIndex+c)}findTokenIndexAtOffset(c){return this._source.findTokenIndexAtOffset(c+this._startOffset-this._deltaOffset)-this._firstTokenIndex}getTokenText(c){const C=this._firstTokenIndex+c,d=this._source.getStartOffset(C),L=this._source.getEndOffset(C);let b=this._source.getTokenText(C);return d<this._startOffset&&(b=b.substring(this._startOffset-d)),L>this._endOffset&&(b=b.substring(0,b.length-(L-this._endOffset))),b}forEach(c){for(let C=0;C<this.getCount();C++)c(C)}}function x(M,c){const C=c.lineNumber;if(!M.tokenization.isCheapToTokenize(C))return;M.tokenization.forceTokenization(C);const d=M.tokenization.getLineTokens(C),L=d.findTokenIndexAtOffset(c.column-1);return d.getStandardTokenType(L)}},16416:(me,X,T)=>{T.d(X,{k:()=>x,x:()=>M});var V=T(55409),K=T(81275);function j(C){return C.replace(/\n/g,"\\n").replace(/\r/g,"\\r")}class x{get oldLength(){return this.oldText.length}get oldEnd(){return this.oldPosition+this.oldText.length}get newLength(){return this.newText.length}get newEnd(){return this.newPosition+this.newText.length}constructor(d,L,b,p){this.oldPosition=d,this.oldText=L,this.newPosition=b,this.newText=p}toString(){return this.oldText.length===0?`(insert@${this.oldPosition} "${j(this.newText)}")`:this.newText.length===0?`(delete@${this.oldPosition} "${j(this.oldText)}")`:`(replace@${this.oldPosition} "${j(this.oldText)}" with "${j(this.newText)}")`}static _writeStringSize(d){return 4+2*d.length}static _writeString(d,L,b){const p=L.length;V.Sw(d,p,b),b+=4;for(let w=0;w<p;w++)V.gN(d,L.charCodeAt(w),b),b+=2;return b}static _readString(d,L){const b=V.bb(d,L);return L+=4,(0,K.Su)(d,L,b)}writeSize(){return 8+x._writeStringSize(this.oldText)+x._writeStringSize(this.newText)}write(d,L){return V.Sw(d,this.oldPosition,L),L+=4,V.Sw(d,this.newPosition,L),L+=4,L=x._writeString(d,this.oldText,L),L=x._writeString(d,this.newText,L),L}static read(d,L,b){const p=V.bb(d,L);L+=4;const w=V.bb(d,L);L+=4;const B=x._readString(d,L);L+=x._writeStringSize(B);const A=x._readString(d,L);return L+=x._writeStringSize(A),b.push(new x(p,B,w,A)),L}}function M(C,d){return C===null||C.length===0?d:new c(C,d).compress()}class c{constructor(d,L){this._prevEdits=d,this._currEdits=L,this._result=[],this._resultLen=0,this._prevLen=this._prevEdits.length,this._prevDeltaOffset=0,this._currLen=this._currEdits.length,this._currDeltaOffset=0}compress(){let d=0,L=0,b=this._getPrev(d),p=this._getCurr(L);for(;d<this._prevLen||L<this._currLen;){if(b===null){this._acceptCurr(p),p=this._getCurr(++L);continue}if(p===null){this._acceptPrev(b),b=this._getPrev(++d);continue}if(p.oldEnd<=b.newPosition){this._acceptCurr(p),p=this._getCurr(++L);continue}if(b.newEnd<=p.oldPosition){this._acceptPrev(b),b=this._getPrev(++d);continue}if(p.oldPosition<b.newPosition){const[_,I]=c._splitCurr(p,b.newPosition-p.oldPosition);this._acceptCurr(_),p=I;continue}if(b.newPosition<p.oldPosition){const[_,I]=c._splitPrev(b,p.oldPosition-b.newPosition);this._acceptPrev(_),b=I;continue}let A,G;if(p.oldEnd===b.newEnd)A=b,G=p,b=this._getPrev(++d),p=this._getCurr(++L);else if(p.oldEnd<b.newEnd){const[_,I]=c._splitPrev(b,p.oldLength);A=_,G=p,b=I,p=this._getCurr(++L)}else{const[_,I]=c._splitCurr(p,b.newLength);A=b,G=_,b=this._getPrev(++d),p=I}this._result[this._resultLen++]=new x(A.oldPosition,A.oldText,G.newPosition,G.newText),this._prevDeltaOffset+=A.newLength-A.oldLength,this._currDeltaOffset+=G.newLength-G.oldLength}const w=c._merge(this._result);return c._removeNoOps(w)}_acceptCurr(d){this._result[this._resultLen++]=c._rebaseCurr(this._prevDeltaOffset,d),this._currDeltaOffset+=d.newLength-d.oldLength}_getCurr(d){return d<this._currLen?this._currEdits[d]:null}_acceptPrev(d){this._result[this._resultLen++]=c._rebasePrev(this._currDeltaOffset,d),this._prevDeltaOffset+=d.newLength-d.oldLength}_getPrev(d){return d<this._prevLen?this._prevEdits[d]:null}static _rebaseCurr(d,L){return new x(L.oldPosition-d,L.oldText,L.newPosition,L.newText)}static _rebasePrev(d,L){return new x(L.oldPosition,L.oldText,L.newPosition+d,L.newText)}static _splitPrev(d,L){const b=d.newText.substr(0,L),p=d.newText.substr(L);return[new x(d.oldPosition,d.oldText,d.newPosition,b),new x(d.oldEnd,"",d.newPosition+L,p)]}static _splitCurr(d,L){const b=d.oldText.substr(0,L),p=d.oldText.substr(L);return[new x(d.oldPosition,b,d.newPosition,d.newText),new x(d.oldPosition+L,p,d.newEnd,"")]}static _merge(d){if(d.length===0)return d;const L=[];let b=0,p=d[0];for(let w=1;w<d.length;w++){const B=d[w];p.oldEnd===B.oldPosition?p=new x(p.oldPosition,p.oldText+B.oldText,p.newPosition,p.newText+B.newText):(L[b++]=p,p=B)}return L[b++]=p,L}static _removeNoOps(d){if(d.length===0)return d;const L=[];let b=0;for(let p=0;p<d.length;p++){const w=d[p];w.oldText!==w.newText&&(L[b++]=w)}return L}}},22461:(me,X,T)=>{T.d(X,{Fu:()=>I,az:()=>c,xb:()=>G});var V=T(85565),K=T(81275),j=T(98414);class x{constructor(f,v,P,S,z,D){this._richEditBracketBrand=void 0,this.languageId=f,this.index=v,this.open=P,this.close=S,this.forwardRegex=z,this.reversedRegex=D,this._openSet=x._toSet(this.open),this._closeSet=x._toSet(this.close)}isOpen(f){return this._openSet.has(f)}isClose(f){return this._closeSet.has(f)}static _toSet(f){const v=new Set;for(const P of f)v.add(P);return v}}function M(h){const f=h.length;h=h.map(D=>[D[0].toLowerCase(),D[1].toLowerCase()]);const v=[];for(let D=0;D<f;D++)v[D]=D;const P=(D,E)=>{const[y,W]=D,[$,Y]=E;return y===$||y===Y||W===$||W===Y},S=(D,E)=>{const y=Math.min(D,E),W=Math.max(D,E);for(let $=0;$<f;$++)v[$]===W&&(v[$]=y)};for(let D=0;D<f;D++){const E=h[D];for(let y=D+1;y<f;y++){const W=h[y];P(E,W)&&S(v[D],v[y])}}const z=[];for(let D=0;D<f;D++){const E=[],y=[];for(let W=0;W<f;W++)if(v[W]===D){const[$,Y]=h[W];E.push($),y.push(Y)}E.length>0&&z.push({open:E,close:y})}return z}class c{constructor(f,v){this._richEditBracketsBrand=void 0;const P=M(v);this.brackets=P.map((S,z)=>new x(f,z,S.open,S.close,b(S.open,S.close,P,z),p(S.open,S.close,P,z))),this.forwardRegex=w(this.brackets),this.reversedRegex=B(this.brackets),this.textIsBracket={},this.textIsOpenBracket={},this.maxBracketLength=0;for(const S of this.brackets){for(const z of S.open)this.textIsBracket[z]=S,this.textIsOpenBracket[z]=!0,this.maxBracketLength=Math.max(this.maxBracketLength,z.length);for(const z of S.close)this.textIsBracket[z]=S,this.textIsOpenBracket[z]=!1,this.maxBracketLength=Math.max(this.maxBracketLength,z.length)}}}function C(h,f,v,P){for(let S=0,z=f.length;S<z;S++){if(S===v)continue;const D=f[S];for(const E of D.open)E.indexOf(h)>=0&&P.push(E);for(const E of D.close)E.indexOf(h)>=0&&P.push(E)}}function d(h,f){return h.length-f.length}function L(h){if(h.length<=1)return h;const f=[],v=new Set;for(const P of h)v.has(P)||(f.push(P),v.add(P));return f}function b(h,f,v,P){let S=[];S=S.concat(h),S=S.concat(f);for(let z=0,D=S.length;z<D;z++)C(S[z],v,P,S);return S=L(S),S.sort(d),S.reverse(),G(S)}function p(h,f,v,P){let S=[];S=S.concat(h),S=S.concat(f);for(let z=0,D=S.length;z<D;z++)C(S[z],v,P,S);return S=L(S),S.sort(d),S.reverse(),G(S.map(_))}function w(h){let f=[];for(const v of h){for(const P of v.open)f.push(P);for(const P of v.close)f.push(P)}return f=L(f),G(f)}function B(h){let f=[];for(const v of h){for(const P of v.open)f.push(P);for(const P of v.close)f.push(P)}return f=L(f),G(f.map(_))}function A(h){const f=/^[\w ]+$/.test(h);return h=V.bm(h),f?`\\b${h}\\b`:h}function G(h,f){const v=`(${h.map(A).join(")|(")})`;return V.OS(v,!0,f)}const _=function(){function h(P){const S=new Uint16Array(P.length);let z=0;for(let D=P.length-1;D>=0;D--)S[z++]=P.charCodeAt(D);return K.b7().decode(S)}let f=null,v=null;return function(S){return f!==S&&(f=S,v=h(f)),v}}();class I{static _findPrevBracketInText(f,v,P,S){const z=P.match(f);if(!z)return null;const D=P.length-(z.index||0),E=z[0].length,y=S+D;return new j.Q(v,y-E+1,v,y+1)}static findPrevBracketInRange(f,v,P,S,z){const E=_(P).substring(P.length-z,P.length-S);return this._findPrevBracketInText(f,v,E,S)}static findNextBracketInText(f,v,P,S){const z=P.match(f);if(!z)return null;const D=z.index||0,E=z[0].length;if(E===0)return null;const y=S+D;return new j.Q(v,y+1,v,y+1+E)}static findNextBracketInRange(f,v,P,S,z){const D=P.substring(S,z);return this.findNextBracketInText(f,v,D,S)}}},22796:(me,X,T)=>{T.d(X,{Gc:()=>_,Nn:()=>c,Xw:()=>C,rh:()=>G,yF:()=>A});var V=T(87856),K=T(23418),j=T(78386),x=T(67083);class M{get length(){return this._length}constructor(h){this._length=h}}class c extends M{static create(h,f,v){let P=h.length;return f&&(P=(0,j.QB)(P,f.length)),v&&(P=(0,j.QB)(P,v.length)),new c(P,h,f,v,f?f.missingOpeningBracketIds:x.gV.getEmpty())}get kind(){return 2}get listHeight(){return 0}get childrenLength(){return 3}getChild(h){switch(h){case 0:return this.openingBracket;case 1:return this.child;case 2:return this.closingBracket}throw new Error("Invalid child index")}get children(){const h=[];return h.push(this.openingBracket),this.child&&h.push(this.child),this.closingBracket&&h.push(this.closingBracket),h}constructor(h,f,v,P,S){super(h),this.openingBracket=f,this.child=v,this.closingBracket=P,this.missingOpeningBracketIds=S}canBeReused(h){return!(this.closingBracket===null||h.intersects(this.missingOpeningBracketIds))}deepClone(){return new c(this.length,this.openingBracket.deepClone(),this.child&&this.child.deepClone(),this.closingBracket&&this.closingBracket.deepClone(),this.missingOpeningBracketIds)}computeMinIndentation(h,f){return this.child?this.child.computeMinIndentation((0,j.QB)(h,this.openingBracket.length),f):Number.MAX_SAFE_INTEGER}}class C extends M{static create23(h,f,v,P=!1){let S=h.length,z=h.missingOpeningBracketIds;if(h.listHeight!==f.listHeight)throw new Error("Invalid list heights");if(S=(0,j.QB)(S,f.length),z=z.merge(f.missingOpeningBracketIds),v){if(h.listHeight!==v.listHeight)throw new Error("Invalid list heights");S=(0,j.QB)(S,v.length),z=z.merge(v.missingOpeningBracketIds)}return P?new L(S,h.listHeight+1,h,f,v,z):new d(S,h.listHeight+1,h,f,v,z)}static getEmpty(){return new p(j.Vp,0,[],x.gV.getEmpty())}get kind(){return 4}get missingOpeningBracketIds(){return this._missingOpeningBracketIds}constructor(h,f,v){super(h),this.listHeight=f,this._missingOpeningBracketIds=v,this.cachedMinIndentation=-1}throwIfImmutable(){}makeLastElementMutable(){this.throwIfImmutable();const h=this.childrenLength;if(h===0)return;const f=this.getChild(h-1),v=f.kind===4?f.toMutable():f;return f!==v&&this.setChild(h-1,v),v}makeFirstElementMutable(){if(this.throwIfImmutable(),this.childrenLength===0)return;const f=this.getChild(0),v=f.kind===4?f.toMutable():f;return f!==v&&this.setChild(0,v),v}canBeReused(h){if(h.intersects(this.missingOpeningBracketIds)||this.childrenLength===0)return!1;let f=this;for(;f.kind===4;){const v=f.childrenLength;if(v===0)throw new V.D7;f=f.getChild(v-1)}return f.canBeReused(h)}handleChildrenChanged(){this.throwIfImmutable();const h=this.childrenLength;let f=this.getChild(0).length,v=this.getChild(0).missingOpeningBracketIds;for(let P=1;P<h;P++){const S=this.getChild(P);f=(0,j.QB)(f,S.length),v=v.merge(S.missingOpeningBracketIds)}this._length=f,this._missingOpeningBracketIds=v,this.cachedMinIndentation=-1}computeMinIndentation(h,f){if(this.cachedMinIndentation!==-1)return this.cachedMinIndentation;let v=Number.MAX_SAFE_INTEGER,P=h;for(let S=0;S<this.childrenLength;S++){const z=this.getChild(S);z&&(v=Math.min(v,z.computeMinIndentation(P,f)),P=(0,j.QB)(P,z.length))}return this.cachedMinIndentation=v,v}}class d extends C{get childrenLength(){return this._item3!==null?3:2}getChild(h){switch(h){case 0:return this._item1;case 1:return this._item2;case 2:return this._item3}throw new Error("Invalid child index")}setChild(h,f){switch(h){case 0:this._item1=f;return;case 1:this._item2=f;return;case 2:this._item3=f;return}throw new Error("Invalid child index")}get children(){return this._item3?[this._item1,this._item2,this._item3]:[this._item1,this._item2]}get item1(){return this._item1}get item2(){return this._item2}get item3(){return this._item3}constructor(h,f,v,P,S,z){super(h,f,z),this._item1=v,this._item2=P,this._item3=S}deepClone(){return new d(this.length,this.listHeight,this._item1.deepClone(),this._item2.deepClone(),this._item3?this._item3.deepClone():null,this.missingOpeningBracketIds)}appendChildOfSameHeight(h){if(this._item3)throw new Error("Cannot append to a full (2,3) tree node");this.throwIfImmutable(),this._item3=h,this.handleChildrenChanged()}unappendChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const h=this._item3;return this._item3=null,this.handleChildrenChanged(),h}prependChildOfSameHeight(h){if(this._item3)throw new Error("Cannot prepend to a full (2,3) tree node");this.throwIfImmutable(),this._item3=this._item2,this._item2=this._item1,this._item1=h,this.handleChildrenChanged()}unprependChild(){if(!this._item3)throw new Error("Cannot remove from a non-full (2,3) tree node");this.throwIfImmutable();const h=this._item1;return this._item1=this._item2,this._item2=this._item3,this._item3=null,this.handleChildrenChanged(),h}toMutable(){return this}}class L extends d{toMutable(){return new d(this.length,this.listHeight,this.item1,this.item2,this.item3,this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}class b extends C{get childrenLength(){return this._children.length}getChild(h){return this._children[h]}setChild(h,f){this._children[h]=f}get children(){return this._children}constructor(h,f,v,P){super(h,f,P),this._children=v}deepClone(){const h=new Array(this._children.length);for(let f=0;f<this._children.length;f++)h[f]=this._children[f].deepClone();return new b(this.length,this.listHeight,h,this.missingOpeningBracketIds)}appendChildOfSameHeight(h){this.throwIfImmutable(),this._children.push(h),this.handleChildrenChanged()}unappendChild(){this.throwIfImmutable();const h=this._children.pop();return this.handleChildrenChanged(),h}prependChildOfSameHeight(h){this.throwIfImmutable(),this._children.unshift(h),this.handleChildrenChanged()}unprependChild(){this.throwIfImmutable();const h=this._children.shift();return this.handleChildrenChanged(),h}toMutable(){return this}}class p extends b{toMutable(){return new b(this.length,this.listHeight,[...this.children],this.missingOpeningBracketIds)}throwIfImmutable(){throw new Error("this instance is immutable")}}const w=[];class B extends M{get listHeight(){return 0}get childrenLength(){return 0}getChild(h){return null}get children(){return w}deepClone(){return this}}class A extends B{get kind(){return 0}get missingOpeningBracketIds(){return x.gV.getEmpty()}canBeReused(h){return!0}computeMinIndentation(h,f){const v=(0,j.l4)(h),P=(v.columnCount===0?v.lineCount:v.lineCount+1)+1,S=(0,j.eu)((0,j.QB)(h,this.length))+1;let z=Number.MAX_SAFE_INTEGER;for(let D=P;D<=S;D++){const E=f.getLineFirstNonWhitespaceColumn(D),y=f.getLineContent(D);if(E===0)continue;const W=K.A.visibleColumnFromColumn(y,E,f.getOptions().tabSize);z=Math.min(z,W)}return z}}class G extends B{static create(h,f,v){return new G(h,f,v)}get kind(){return 1}get missingOpeningBracketIds(){return x.gV.getEmpty()}constructor(h,f,v){super(h),this.bracketInfo=f,this.bracketIds=v}get text(){return this.bracketInfo.bracketText}get languageId(){return this.bracketInfo.languageId}canBeReused(h){return!1}computeMinIndentation(h,f){return Number.MAX_SAFE_INTEGER}}class _ extends B{get kind(){return 3}constructor(h,f){super(f),this.missingOpeningBracketIds=h}canBeReused(h){return!h.intersects(this.missingOpeningBracketIds)}computeMinIndentation(h,f){return Number.MAX_SAFE_INTEGER}}},23418:(me,X,T)=>{T.d(X,{A:()=>K});var V=T(85565);class K{static _nextVisibleColumn(x,M,c){return x===9?K.nextRenderTabStop(M,c):V.ne(x)||V.Ss(x)?M+2:M+1}static visibleColumnFromColumn(x,M,c){const C=Math.min(M-1,x.length),d=x.substring(0,C),L=new V.km(d);let b=0;for(;!L.eol();){const p=V.Z5(d,C,L.offset);L.nextGraphemeLength(),b=this._nextVisibleColumn(p,b,c)}return b}static columnFromVisibleColumn(x,M,c){if(M<=0)return 1;const C=x.length,d=new V.km(x);let L=0,b=1;for(;!d.eol();){const p=V.Z5(x,C,d.offset);d.nextGraphemeLength();const w=this._nextVisibleColumn(p,L,c),B=d.offset+1;if(w>=M){const A=M-L;return w-M<A?B:b}L=w,b=B}return C+1}static nextRenderTabStop(x,M){return x+M-x%M}static nextIndentTabStop(x,M){return x+M-x%M}static prevRenderTabStop(x,M){return Math.max(0,x-1-(x-1)%M)}static prevIndentTabStop(x,M){return Math.max(0,x-1-(x-1)%M)}}},24934:(me,X,T)=>{T.d(X,{E$:()=>x,HP:()=>C,Ic:()=>L,U0:()=>j,Wn:()=>V,bg:()=>M,mS:()=>c,uK:()=>K,vn:()=>d});class V{constructor(){this.changeType=1}}class K{static applyInjectedText(p,w){if(!w||w.length===0)return p;let B="",A=0;for(const G of w)B+=p.substring(A,G.column-1),A=G.column-1,B+=G.options.content;return B+=p.substring(A),B}static fromDecorations(p){const w=[];for(const B of p)B.options.before&&B.options.before.content.length>0&&w.push(new K(B.ownerId,B.range.startLineNumber,B.range.startColumn,B.options.before,0)),B.options.after&&B.options.after.content.length>0&&w.push(new K(B.ownerId,B.range.endLineNumber,B.range.endColumn,B.options.after,1));return w.sort((B,A)=>B.lineNumber===A.lineNumber?B.column===A.column?B.order-A.order:B.column-A.column:B.lineNumber-A.lineNumber),w}constructor(p,w,B,A,G){this.ownerId=p,this.lineNumber=w,this.column=B,this.options=A,this.order=G}}class j{constructor(p,w,B){this.changeType=2,this.lineNumber=p,this.detail=w,this.injectedText=B}}class x{constructor(p,w){this.changeType=3,this.fromLineNumber=p,this.toLineNumber=w}}class M{constructor(p,w,B,A){this.changeType=4,this.injectedTexts=A,this.fromLineNumber=p,this.toLineNumber=w,this.detail=B}}class c{constructor(){this.changeType=5}}class C{constructor(p,w,B,A){this.changes=p,this.versionId=w,this.isUndoing=B,this.isRedoing=A,this.resultingSelection=null}containsEvent(p){for(let w=0,B=this.changes.length;w<B;w++)if(this.changes[w].changeType===p)return!0;return!1}static merge(p,w){const B=[].concat(p.changes).concat(w.changes),A=w.versionId,G=p.isUndoing||w.isUndoing,_=p.isRedoing||w.isRedoing;return new C(B,A,G,_)}}class d{constructor(p){this.changes=p}}class L{constructor(p,w){this.rawContentChangedEvent=p,this.contentChangedEvent=w}merge(p){const w=C.merge(this.rawContentChangedEvent,p.rawContentChangedEvent),B=L._mergeChangeEvents(this.contentChangedEvent,p.contentChangedEvent);return new L(w,B)}static _mergeChangeEvents(p,w){const B=[].concat(p.changes).concat(w.changes),A=w.eol,G=w.versionId,_=p.isUndoing||w.isUndoing,I=p.isRedoing||w.isRedoing,h=p.isFlush||w.isFlush,f=p.isEolChange&&w.isEolChange;return{changes:B,eol:A,isEolChange:f,versionId:G,isUndoing:_,isRedoing:I,isFlush:h}}}},28841:(me,X,T)=>{T.d(X,{R:()=>V});const V={tabSize:4,indentSize:4,insertSpaces:!0,detectIndentation:!0,trimAutoWhitespace:!0,largeFileOptimizations:!0,bracketPairColorizationOptions:{enabled:!0,independentColorPoolPerBracketType:!1}}},30894:(me,X,T)=>{T.d(X,{$D:()=>K,I_:()=>x,To:()=>j,Ym:()=>M});var V=T(81545);const K=(0,V.u1)("undoRedoService");class j{constructor(C,d){this.resource=C,this.elements=d}}class x{static{this._ID=0}constructor(){this.id=x._ID++,this.order=1}nextOrder(){return this.id===0?0:this.order++}static{this.None=new x}}class M{static{this._ID=0}constructor(){this.id=M._ID++,this.order=1}nextOrder(){return this.id===0?0:this.order++}static{this.None=new M}}},31633:(me,X,T)=>{T.d(X,{M:()=>x});var V=T(93009),K=T(45635),j=T(78386);function x(C,d){if(C.length===0)return d;if(d.length===0)return C;const L=new V.j3(c(C)),b=c(d);b.push({modified:!1,lengthBefore:void 0,lengthAfter:void 0});let p=L.dequeue();function w(_){if(_===void 0){const h=L.takeWhile(f=>!0)||[];return p&&h.unshift(p),h}const I=[];for(;p&&!(0,j.Vh)(_);){const[h,f]=p.splitAt(_);I.push(h),_=(0,j.MS)(h.lengthAfter,_),p=f??L.dequeue()}return(0,j.Vh)(_)||I.push(new M(!1,_,_)),I}const B=[];function A(_,I,h){if(B.length>0&&(0,j.wP)(B[B.length-1].endOffset,_)){const f=B[B.length-1];B[B.length-1]=new K.c(f.startOffset,I,(0,j.QB)(f.newLength,h))}else B.push({startOffset:_,endOffset:I,newLength:h})}let G=j.Vp;for(const _ of b){const I=w(_.lengthBefore);if(_.modified){const h=(0,j.pW)(I,v=>v.lengthBefore),f=(0,j.QB)(G,h);A(G,f,_.lengthAfter),G=f}else for(const h of I){const f=G;G=(0,j.QB)(G,h.lengthBefore),h.modified&&A(f,G,h.lengthAfter)}}return B}class M{constructor(d,L,b){this.modified=d,this.lengthBefore=L,this.lengthAfter=b}splitAt(d){const L=(0,j.MS)(d,this.lengthAfter);return(0,j.wP)(L,j.Vp)?[this,void 0]:this.modified?[new M(this.modified,this.lengthBefore,d),new M(this.modified,j.Vp,L)]:[new M(this.modified,d,d),new M(this.modified,L,L)]}toString(){return`${this.modified?"M":"U"}:${(0,j.l4)(this.lengthBefore)} -> ${(0,j.l4)(this.lengthAfter)}`}}function c(C){const d=[];let L=j.Vp;for(const b of C){const p=(0,j.MS)(L,b.startOffset);(0,j.Vh)(p)||d.push(new M(!1,p,p));const w=(0,j.MS)(b.startOffset,b.endOffset);d.push(new M(!0,w,b.newLength)),L=b.endOffset}return d}},32287:(me,X,T)=>{T.d(X,{$H:()=>j,Lh:()=>x,r3:()=>K});var V=T(9709);const K=new class{clone(){return this}equals(M){return this===M}};function j(M,c){return new V.$M([new V.ou(0,"",M)],c)}function x(M,c){const C=new Uint32Array(2);return C[0]=0,C[1]=(M<<0|0|0|32768|2<<24)>>>0,new V.rY(C,c===null?K:c)}},45635:(me,X,T)=>{T.d(X,{W:()=>x,c:()=>j});var V=T(98414),K=T(78386);class j{static fromModelContentChanges(C){return C.map(L=>{const b=V.Q.lift(L.range);return new j((0,K.VL)(b.getStartPosition()),(0,K.VL)(b.getEndPosition()),(0,K.rR)(L.text))}).reverse()}constructor(C,d,L){this.startOffset=C,this.endOffset=d,this.newLength=L}toString(){return`[${(0,K.l4)(this.startOffset)}...${(0,K.l4)(this.endOffset)}) -> ${(0,K.l4)(this.newLength)}`}}class x{constructor(C){this.nextEditIdx=0,this.deltaOldToNewLineCount=0,this.deltaOldToNewColumnCount=0,this.deltaLineIdxInOld=-1,this.edits=C.map(d=>M.from(d))}getOffsetBeforeChange(C){return this.adjustNextEdit(C),this.translateCurToOld(C)}getDistanceToNextChange(C){this.adjustNextEdit(C);const d=this.edits[this.nextEditIdx],L=d?this.translateOldToCur(d.offsetObj):null;return L===null?null:(0,K.MS)(C,L)}translateOldToCur(C){return C.lineCount===this.deltaLineIdxInOld?(0,K.qe)(C.lineCount+this.deltaOldToNewLineCount,C.columnCount+this.deltaOldToNewColumnCount):(0,K.qe)(C.lineCount+this.deltaOldToNewLineCount,C.columnCount)}translateCurToOld(C){const d=(0,K.l4)(C);return d.lineCount-this.deltaOldToNewLineCount===this.deltaLineIdxInOld?(0,K.qe)(d.lineCount-this.deltaOldToNewLineCount,d.columnCount-this.deltaOldToNewColumnCount):(0,K.qe)(d.lineCount-this.deltaOldToNewLineCount,d.columnCount)}adjustNextEdit(C){for(;this.nextEditIdx<this.edits.length;){const d=this.edits[this.nextEditIdx],L=this.translateOldToCur(d.endOffsetAfterObj);if((0,K.vr)(L,C)){this.nextEditIdx++;const b=(0,K.l4)(L),p=(0,K.l4)(this.translateOldToCur(d.endOffsetBeforeObj)),w=b.lineCount-p.lineCount;this.deltaOldToNewLineCount+=w;const B=this.deltaLineIdxInOld===d.endOffsetBeforeObj.lineCount?this.deltaOldToNewColumnCount:0,A=b.columnCount-p.columnCount;this.deltaOldToNewColumnCount=B+A,this.deltaLineIdxInOld=d.endOffsetBeforeObj.lineCount}else break}}}class M{static from(C){return new M(C.startOffset,C.endOffset,C.newLength)}constructor(C,d,L){this.endOffsetBeforeObj=(0,K.l4)(d),this.endOffsetAfterObj=(0,K.l4)((0,K.QB)(C,L)),this.offsetObj=(0,K.l4)(C)}}},52216:(me,X,T)=>{T.d(X,{_:()=>K});var V=T(60599);class K extends V.jG{constructor(){super(...arguments),this._isDisposed=!1}dispose(){super.dispose(),this._isDisposed=!0}assertNotDisposed(){if(this._isDisposed)throw new Error("TextModelPart is disposed!")}}},52630:(me,X,T)=>{T.d(X,{N6:()=>V,TH:()=>K,pv:()=>j});var V;(function(x){x[x.Disabled=0]="Disabled",x[x.EnabledForActive=1]="EnabledForActive",x[x.Enabled=2]="Enabled"})(V||(V={}));class K{constructor(M,c,C,d,L,b){if(this.visibleColumn=M,this.column=c,this.className=C,this.horizontalLine=d,this.forWrappedLinesAfterColumn=L,this.forWrappedLinesBeforeOrAtColumn=b,M!==-1==(c!==-1))throw new Error}}class j{constructor(M,c){this.top=M,this.endColumn=c}}},55409:(me,X,T)=>{T.d(X,{$l:()=>c,Gs:()=>p,MB:()=>M,Sw:()=>L,bb:()=>d,gN:()=>C,pJ:()=>b});var V=T(37145);const K=typeof Buffer<"u",j=new V.d(()=>new Uint8Array(256));let x;class M{static wrap(B){return K&&!Buffer.isBuffer(B)&&(B=Buffer.from(B.buffer,B.byteOffset,B.byteLength)),new M(B)}constructor(B){this.buffer=B,this.byteLength=this.buffer.byteLength}toString(){return K?this.buffer.toString():(x||(x=new TextDecoder),x.decode(this.buffer))}}function c(w,B){return w[B+0]<<0>>>0|w[B+1]<<8>>>0}function C(w,B,A){w[A+0]=B&255,B=B>>>8,w[A+1]=B&255}function d(w,B){return w[B]*2**24+w[B+1]*2**16+w[B+2]*2**8+w[B+3]}function L(w,B,A){w[A+3]=B,B=B>>>8,w[A+2]=B,B=B>>>8,w[A+1]=B,B=B>>>8,w[A]=B}function b(w,B){return w[B]}function p(w,B,A){w[A]=B}},58932:(me,X,T)=>{T.d(X,{P:()=>x});var V=T(85565),K=T(23418);function j(M,c,C){let d=0;for(let b=0;b<M.length;b++)M.charAt(b)==="	"?d=K.A.nextIndentTabStop(d,c):d++;let L="";if(!C){const b=Math.floor(d/c);d=d%c;for(let p=0;p<b;p++)L+="	"}for(let b=0;b<d;b++)L+=" ";return L}function x(M,c,C){let d=V.HG(M);return d===-1&&(d=M.length),j(M.substring(0,d),c,C)+M.substring(d)}},60753:(me,X,T)=>{T.d(X,{d:()=>V});class V{constructor(j,x=[],M=!1){this.ctor=j,this.staticArguments=x,this.supportsDelayedInstantiation=M}}},61231:(me,X,T)=>{T.d(X,{JZ:()=>Y,Cw:()=>ae});var V=T(56491),K=T(60599),j=T(85565),x=T(5751),M=T(81483);class c{static{this.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES=`;:.,=}])> 
	`}static{this.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS=`'"\`;:.,=}])> 
	`}constructor(R){if(R.autoClosingPairs?this._autoClosingPairs=R.autoClosingPairs.map(H=>new M.i3(H)):R.brackets?this._autoClosingPairs=R.brackets.map(H=>new M.i3({open:H[0],close:H[1]})):this._autoClosingPairs=[],R.__electricCharacterSupport&&R.__electricCharacterSupport.docComment){const H=R.__electricCharacterSupport.docComment;this._autoClosingPairs.push(new M.i3({open:H.open,close:H.close||""}))}this._autoCloseBeforeForQuotes=typeof R.autoCloseBefore=="string"?R.autoCloseBefore:c.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_QUOTES,this._autoCloseBeforeForBrackets=typeof R.autoCloseBefore=="string"?R.autoCloseBefore:c.DEFAULT_AUTOCLOSE_BEFORE_LANGUAGE_DEFINED_BRACKETS,this._surroundingPairs=R.surroundingPairs||this._autoClosingPairs}getAutoClosingPairs(){return this._autoClosingPairs}getAutoCloseBeforeSet(R){return R?this._autoCloseBeforeForQuotes:this._autoCloseBeforeForBrackets}getSurroundingPairs(){return this._surroundingPairs}}var C=T(93009),d=T(90439),L=T(22461);class b{constructor(R){this._richEditBrackets=R}getElectricCharacters(){const R=[];if(this._richEditBrackets)for(const H of this._richEditBrackets.brackets)for(const te of H.close){const ie=te.charAt(te.length-1);R.push(ie)}return(0,C.dM)(R)}onElectricCharacter(R,H,te){if(!this._richEditBrackets||this._richEditBrackets.brackets.length===0)return null;const ie=H.findTokenIndexAtOffset(te-1);if((0,d.Yo)(H.getStandardTokenType(ie)))return null;const ge=this._richEditBrackets.reversedRegex,Le=H.getLineContent().substring(0,te-1)+R,J=L.Fu.findPrevBracketInRange(ge,1,Le,0,Le.length);if(!J)return null;const se=Le.substring(J.startColumn-1,J.endColumn-1).toLowerCase();if(this._richEditBrackets.textIsOpenBracket[se])return null;const le=H.getActualLineContentBefore(J.startColumn-1);return/^\s*$/.test(le)?{matchOpenBracket:se}:null}}function p(ce){return ce.global&&(ce.lastIndex=0),!0}class w{constructor(R){this._indentationRules=R}shouldIncrease(R){return!!(this._indentationRules&&this._indentationRules.increaseIndentPattern&&p(this._indentationRules.increaseIndentPattern)&&this._indentationRules.increaseIndentPattern.test(R))}shouldDecrease(R){return!!(this._indentationRules&&this._indentationRules.decreaseIndentPattern&&p(this._indentationRules.decreaseIndentPattern)&&this._indentationRules.decreaseIndentPattern.test(R))}shouldIndentNextLine(R){return!!(this._indentationRules&&this._indentationRules.indentNextLinePattern&&p(this._indentationRules.indentNextLinePattern)&&this._indentationRules.indentNextLinePattern.test(R))}shouldIgnore(R){return!!(this._indentationRules&&this._indentationRules.unIndentedLinePattern&&p(this._indentationRules.unIndentedLinePattern)&&this._indentationRules.unIndentedLinePattern.test(R))}getIndentMetadata(R){let H=0;return this.shouldIncrease(R)&&(H+=1),this.shouldDecrease(R)&&(H+=2),this.shouldIndentNextLine(R)&&(H+=4),this.shouldIgnore(R)&&(H+=8),H}}var B=T(87856);class A{constructor(R){R=R||{},R.brackets=R.brackets||[["(",")"],["{","}"],["[","]"]],this._brackets=[],R.brackets.forEach(H=>{const te=A._createOpenBracketRegExp(H[0]),ie=A._createCloseBracketRegExp(H[1]);te&&ie&&this._brackets.push({open:H[0],openRegExp:te,close:H[1],closeRegExp:ie})}),this._regExpRules=R.onEnterRules||[]}onEnter(R,H,te,ie){if(R>=3)for(let ge=0,Le=this._regExpRules.length;ge<Le;ge++){const J=this._regExpRules[ge];if([{reg:J.beforeText,text:te},{reg:J.afterText,text:ie},{reg:J.previousLineText,text:H}].every(de=>de.reg?(de.reg.lastIndex=0,de.reg.test(de.text)):!0))return J.action}if(R>=2&&te.length>0&&ie.length>0)for(let ge=0,Le=this._brackets.length;ge<Le;ge++){const J=this._brackets[ge];if(J.openRegExp.test(te)&&J.closeRegExp.test(ie))return{indentAction:M.l.IndentOutdent}}if(R>=2&&te.length>0){for(let ge=0,Le=this._brackets.length;ge<Le;ge++)if(this._brackets[ge].openRegExp.test(te))return{indentAction:M.l.Indent}}return null}static _createOpenBracketRegExp(R){let H=j.bm(R);return/\B/.test(H.charAt(0))||(H="\\b"+H),H+="\\s*$",A._safeRegExp(H)}static _createCloseBracketRegExp(R){let H=j.bm(R);return/\B/.test(H.charAt(H.length-1))||(H=H+"\\b"),H="^\\s*"+H,A._safeRegExp(H)}static _safeRegExp(R){try{return new RegExp(R)}catch(H){return(0,B.dz)(H),null}}}var G=T(81545),_=T(54752),I=T(71521),h=T(73429),f=T(49896),v=T(20817);class P{constructor(R,H){this.languageId=R;const te=H.brackets?S(H.brackets):[],ie=new v.VV(J=>{const se=new Set;return{info:new D(this,J,se),closing:se}}),ge=new v.VV(J=>{const se=new Set,de=new Set;return{info:new E(this,J,se,de),opening:se,openingColorized:de}});for(const[J,se]of te){const de=ie.get(J),le=ge.get(se);de.closing.add(le.info),le.opening.add(de.info)}const Le=H.colorizedBracketPairs?S(H.colorizedBracketPairs):te.filter(J=>!(J[0]==="<"&&J[1]===">"));for(const[J,se]of Le){const de=ie.get(J),le=ge.get(se);de.closing.add(le.info),le.openingColorized.add(de.info),le.opening.add(de.info)}this._openingBrackets=new Map([...ie.cachedValues].map(([J,se])=>[J,se.info])),this._closingBrackets=new Map([...ge.cachedValues].map(([J,se])=>[J,se.info]))}get openingBrackets(){return[...this._openingBrackets.values()]}get closingBrackets(){return[...this._closingBrackets.values()]}getOpeningBracketInfo(R){return this._openingBrackets.get(R)}getClosingBracketInfo(R){return this._closingBrackets.get(R)}getBracketInfo(R){return this.getOpeningBracketInfo(R)||this.getClosingBracketInfo(R)}getBracketRegExp(R){const H=Array.from([...this._openingBrackets.keys(),...this._closingBrackets.keys()]);return(0,L.xb)(H,R)}}function S(ce){return ce.filter(([R,H])=>R!==""&&H!=="")}class z{constructor(R,H){this.config=R,this.bracketText=H}get languageId(){return this.config.languageId}}class D extends z{constructor(R,H,te){super(R,H),this.openedBrackets=te,this.isOpeningBracket=!0}}class E extends z{constructor(R,H,te,ie){super(R,H),this.openingBrackets=te,this.openingColorizedBrackets=ie,this.isOpeningBracket=!1}closes(R){return R.config!==this.config?!1:this.openingBrackets.has(R)}closesColorized(R){return R.config!==this.config?!1:this.openingColorizedBrackets.has(R)}getOpeningBrackets(){return[...this.openingBrackets]}}var y=function(ce,R,H,te){var ie=arguments.length,ge=ie<3?R:te===null?te=Object.getOwnPropertyDescriptor(R,H):te,Le;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")ge=Reflect.decorate(ce,R,H,te);else for(var J=ce.length-1;J>=0;J--)(Le=ce[J])&&(ge=(ie<3?Le(ge):ie>3?Le(R,H,ge):Le(R,H))||ge);return ie>3&&ge&&Object.defineProperty(R,H,ge),ge},W=function(ce,R){return function(H,te){R(H,te,ce)}};class ${constructor(R){this.languageId=R}affects(R){return this.languageId?this.languageId===R:!0}}const Y=(0,G.u1)("languageConfigurationService");let ne=class extends K.jG{constructor(R,H){super(),this.configurationService=R,this.languageService=H,this._registry=this._register(new Ne),this.onDidChangeEmitter=this._register(new V.vl),this.onDidChange=this.onDidChangeEmitter.event,this.configurations=new Map;const te=new Set(Object.values(_e));this._register(this.configurationService.onDidChangeConfiguration(ie=>{const ge=ie.change.keys.some(J=>te.has(J)),Le=ie.change.overrides.filter(([J,se])=>se.some(de=>te.has(de))).map(([J])=>J);if(ge)this.configurations.clear(),this.onDidChangeEmitter.fire(new $(void 0));else for(const J of Le)this.languageService.isRegisteredLanguageId(J)&&(this.configurations.delete(J),this.onDidChangeEmitter.fire(new $(J)))})),this._register(this._registry.onDidChange(ie=>{this.configurations.delete(ie.languageId),this.onDidChangeEmitter.fire(new $(ie.languageId))}))}register(R,H,te){return this._registry.register(R,H,te)}getLanguageConfiguration(R){let H=this.configurations.get(R);return H||(H=ue(R,this._registry,this.configurationService,this.languageService),this.configurations.set(R,H)),H}};ne=y([W(0,_.pG),W(1,I.L)],ne);function ue(ce,R,H,te){let ie=R.getLanguageConfiguration(ce);if(!ie){if(!te.isRegisteredLanguageId(ce))return new We(ce,{});ie=new We(ce,{})}const ge=he(ie.languageId,H),Le=Ce([ie.underlyingConfig,ge]);return new We(ie.languageId,Le)}const _e={brackets:"editor.language.brackets",colorizedBracketPairs:"editor.language.colorizedBracketPairs"};function he(ce,R){const H=R.getValue(_e.brackets,{overrideIdentifier:ce}),te=R.getValue(_e.colorizedBracketPairs,{overrideIdentifier:ce});return{brackets:oe(H),colorizedBracketPairs:oe(te)}}function oe(ce){if(Array.isArray(ce))return ce.map(R=>{if(!(!Array.isArray(R)||R.length!==2))return[R[0],R[1]]}).filter(R=>!!R)}function ae(ce,R,H){const te=ce.getLineContent(R);let ie=j.UU(te);return ie.length>H-1&&(ie=ie.substring(0,H-1)),ie}class fe{constructor(R){this.languageId=R,this._resolved=null,this._entries=[],this._order=0,this._resolved=null}register(R,H){const te=new Ie(R,H,++this._order);return this._entries.push(te),this._resolved=null,(0,K.s)(()=>{for(let ie=0;ie<this._entries.length;ie++)if(this._entries[ie]===te){this._entries.splice(ie,1),this._resolved=null;break}})}getResolvedConfiguration(){if(!this._resolved){const R=this._resolve();R&&(this._resolved=new We(this.languageId,R))}return this._resolved}_resolve(){return this._entries.length===0?null:(this._entries.sort(Ie.cmp),Ce(this._entries.map(R=>R.configuration)))}}function Ce(ce){let R={comments:void 0,brackets:void 0,wordPattern:void 0,indentationRules:void 0,onEnterRules:void 0,autoClosingPairs:void 0,surroundingPairs:void 0,autoCloseBefore:void 0,folding:void 0,colorizedBracketPairs:void 0,__electricCharacterSupport:void 0};for(const H of ce)R={comments:H.comments||R.comments,brackets:H.brackets||R.brackets,wordPattern:H.wordPattern||R.wordPattern,indentationRules:H.indentationRules||R.indentationRules,onEnterRules:H.onEnterRules||R.onEnterRules,autoClosingPairs:H.autoClosingPairs||R.autoClosingPairs,surroundingPairs:H.surroundingPairs||R.surroundingPairs,autoCloseBefore:H.autoCloseBefore||R.autoCloseBefore,folding:H.folding||R.folding,colorizedBracketPairs:H.colorizedBracketPairs||R.colorizedBracketPairs,__electricCharacterSupport:H.__electricCharacterSupport||R.__electricCharacterSupport};return R}class Ie{constructor(R,H,te){this.configuration=R,this.priority=H,this.order=te}static cmp(R,H){return R.priority===H.priority?R.order-H.order:R.priority-H.priority}}class Te{constructor(R){this.languageId=R}}class Ne extends K.jG{constructor(){super(),this._entries=new Map,this._onDidChange=this._register(new V.vl),this.onDidChange=this._onDidChange.event,this._register(this.register(f.vH,{brackets:[["(",")"],["[","]"],["{","}"]],surroundingPairs:[{open:"{",close:"}"},{open:"[",close:"]"},{open:"(",close:")"},{open:"<",close:">"},{open:'"',close:'"'},{open:"'",close:"'"},{open:"`",close:"`"}],colorizedBracketPairs:[],folding:{offSide:!0}},0))}register(R,H,te=0){let ie=this._entries.get(R);ie||(ie=new fe(R),this._entries.set(R,ie));const ge=ie.register(H,te);return this._onDidChange.fire(new Te(R)),(0,K.s)(()=>{ge.dispose(),this._onDidChange.fire(new Te(R))})}getLanguageConfiguration(R){return this._entries.get(R)?.getResolvedConfiguration()||null}}class We{constructor(R,H){this.languageId=R,this.underlyingConfig=H,this._brackets=null,this._electricCharacter=null,this._onEnterSupport=this.underlyingConfig.brackets||this.underlyingConfig.indentationRules||this.underlyingConfig.onEnterRules?new A(this.underlyingConfig):null,this.comments=We._handleComments(this.underlyingConfig),this.characterPair=new c(this.underlyingConfig),this.wordDefinition=this.underlyingConfig.wordPattern||x.Ld,this.indentationRules=this.underlyingConfig.indentationRules,this.underlyingConfig.indentationRules?this.indentRulesSupport=new w(this.underlyingConfig.indentationRules):this.indentRulesSupport=null,this.foldingRules=this.underlyingConfig.folding||{},this.bracketsNew=new P(R,this.underlyingConfig)}getWordDefinition(){return(0,x.Io)(this.wordDefinition)}get brackets(){return!this._brackets&&this.underlyingConfig.brackets&&(this._brackets=new L.az(this.languageId,this.underlyingConfig.brackets)),this._brackets}get electricCharacter(){return this._electricCharacter||(this._electricCharacter=new b(this.brackets)),this._electricCharacter}onEnter(R,H,te,ie){return this._onEnterSupport?this._onEnterSupport.onEnter(R,H,te,ie):null}getAutoClosingPairs(){return new M.GB(this.characterPair.getAutoClosingPairs())}getAutoCloseBeforeSet(R){return this.characterPair.getAutoCloseBeforeSet(R)}getSurroundingPairs(){return this.characterPair.getSurroundingPairs()}static _handleComments(R){const H=R.comments;if(!H)return null;const te={};if(H.lineComment&&(te.lineCommentToken=H.lineComment),H.blockComment){const[ie,ge]=H.blockComment;te.blockCommentStartToken=ie,te.blockCommentEndToken=ge}return te}}(0,h.v)(Y,ne,1)},67083:(me,X,T)=>{T.d(X,{FD:()=>j,Mg:()=>x,gV:()=>K});const V=[];class K{static{this.cache=new Array(129)}static create(c,C){if(c<=128&&C.length===0){let d=K.cache[c];return d||(d=new K(c,C),K.cache[c]=d),d}return new K(c,C)}static{this.empty=K.create(0,V)}static getEmpty(){return this.empty}constructor(c,C){this.items=c,this.additionalItems=C}add(c,C){const d=C.getKey(c);let L=d>>5;if(L===0){const p=1<<d|this.items;return p===this.items?this:K.create(p,this.additionalItems)}L--;const b=this.additionalItems.slice(0);for(;b.length<L;)b.push(0);return b[L]|=1<<(d&31),K.create(this.items,b)}merge(c){const C=this.items|c.items;if(this.additionalItems===V&&c.additionalItems===V)return C===this.items?this:C===c.items?c:K.create(C,V);const d=[];for(let L=0;L<Math.max(this.additionalItems.length,c.additionalItems.length);L++){const b=this.additionalItems[L]||0,p=c.additionalItems[L]||0;d.push(b|p)}return K.create(C,d)}intersects(c){if((this.items&c.items)!==0)return!0;for(let C=0;C<Math.min(this.additionalItems.length,c.additionalItems.length);C++)if((this.additionalItems[C]&c.additionalItems[C])!==0)return!0;return!1}}const j={getKey(M){return M}};class x{constructor(){this.items=new Map}getKey(c){let C=this.items.get(c);return C===void 0&&(C=this.items.size,this.items.set(c,C)),C}}},69977:(me,X,T)=>{T.d(X,{_:()=>L,ou:()=>c,tk:()=>C});var V=T(87856),K=T(71269),j=T(22796),x=T(78386),M=T(67083);class c{constructor(p,w,B,A,G){this.length=p,this.kind=w,this.bracketId=B,this.bracketIds=A,this.astNode=G}}class C{constructor(p,w){this.textModel=p,this.bracketTokens=w,this.reader=new d(this.textModel,this.bracketTokens),this._offset=x.Vp,this.didPeek=!1,this.peeked=null,this.textBufferLineCount=p.getLineCount(),this.textBufferLastLineLength=p.getLineLength(this.textBufferLineCount)}get offset(){return this._offset}get length(){return(0,x.qe)(this.textBufferLineCount-1,this.textBufferLastLineLength)}skip(p){this.didPeek=!1,this._offset=(0,x.QB)(this._offset,p);const w=(0,x.l4)(this._offset);this.reader.setPosition(w.lineCount,w.columnCount)}read(){let p;return this.peeked?(this.didPeek=!1,p=this.peeked):p=this.reader.read(),p&&(this._offset=(0,x.QB)(this._offset,p.length)),p}peek(){return this.didPeek||(this.peeked=this.reader.read(),this.didPeek=!0),this.peeked}}class d{constructor(p,w){this.textModel=p,this.bracketTokens=w,this.lineIdx=0,this.line=null,this.lineCharOffset=0,this.lineTokens=null,this.lineTokenOffset=0,this.peekedToken=null,this.textBufferLineCount=p.getLineCount(),this.textBufferLastLineLength=p.getLineLength(this.textBufferLineCount)}setPosition(p,w){p===this.lineIdx?(this.lineCharOffset=w,this.line!==null&&(this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset))):(this.lineIdx=p,this.lineCharOffset=w,this.line=null),this.peekedToken=null}read(){if(this.peekedToken){const G=this.peekedToken;return this.peekedToken=null,this.lineCharOffset+=(0,x.sS)(G.length),G}if(this.lineIdx>this.textBufferLineCount-1||this.lineIdx===this.textBufferLineCount-1&&this.lineCharOffset>=this.textBufferLastLineLength)return null;this.line===null&&(this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.line=this.lineTokens.getLineContent(),this.lineTokenOffset=this.lineCharOffset===0?0:this.lineTokens.findTokenIndexAtOffset(this.lineCharOffset));const p=this.lineIdx,w=this.lineCharOffset;let B=0;for(;;){const G=this.lineTokens,_=G.getCount();let I=null;if(this.lineTokenOffset<_){const h=G.getMetadata(this.lineTokenOffset);for(;this.lineTokenOffset+1<_&&h===G.getMetadata(this.lineTokenOffset+1);)this.lineTokenOffset++;const f=K.x.getTokenType(h)===0,v=K.x.containsBalancedBrackets(h),P=G.getEndOffset(this.lineTokenOffset);if(v&&f&&this.lineCharOffset<P){const S=G.getLanguageId(this.lineTokenOffset),z=this.line.substring(this.lineCharOffset,P),D=this.bracketTokens.getSingleLanguageBracketTokens(S),E=D.regExpGlobal;if(E){E.lastIndex=0;const y=E.exec(z);y&&(I=D.getToken(y[0]),I&&(this.lineCharOffset+=y.index))}}if(B+=P-this.lineCharOffset,I)if(p!==this.lineIdx||w!==this.lineCharOffset){this.peekedToken=I;break}else return this.lineCharOffset+=(0,x.sS)(I.length),I;else this.lineTokenOffset++,this.lineCharOffset=P}else if(this.lineIdx===this.textBufferLineCount-1||(this.lineIdx++,this.lineTokens=this.textModel.tokenization.getLineTokens(this.lineIdx+1),this.lineTokenOffset=0,this.line=this.lineTokens.getLineContent(),this.lineCharOffset=0,B+=33,B>1e3))break;if(B>1500)break}const A=(0,x.C7)(p,w,this.lineIdx,this.lineCharOffset);return new c(A,0,-1,M.gV.getEmpty(),new j.yF(A))}}class L{constructor(p,w){this.text=p,this._offset=x.Vp,this.idx=0;const B=w.getRegExpStr(),A=B?new RegExp(B+`|
`,"gi"):null,G=[];let _,I=0,h=0,f=0,v=0;const P=[];for(let D=0;D<60;D++)P.push(new c((0,x.qe)(0,D),0,-1,M.gV.getEmpty(),new j.yF((0,x.qe)(0,D))));const S=[];for(let D=0;D<60;D++)S.push(new c((0,x.qe)(1,D),0,-1,M.gV.getEmpty(),new j.yF((0,x.qe)(1,D))));if(A)for(A.lastIndex=0;(_=A.exec(p))!==null;){const D=_.index,E=_[0];if(E===`
`)I++,h=D+1;else{if(f!==D){let y;if(v===I){const W=D-f;if(W<P.length)y=P[W];else{const $=(0,x.qe)(0,W);y=new c($,0,-1,M.gV.getEmpty(),new j.yF($))}}else{const W=I-v,$=D-h;if(W===1&&$<S.length)y=S[$];else{const Y=(0,x.qe)(W,$);y=new c(Y,0,-1,M.gV.getEmpty(),new j.yF(Y))}}G.push(y)}G.push(w.getToken(E)),f=D+E.length,v=I}}const z=p.length;if(f!==z){const D=v===I?(0,x.qe)(0,z-f):(0,x.qe)(I-v,z-h);G.push(new c(D,0,-1,M.gV.getEmpty(),new j.yF(D)))}this.length=(0,x.qe)(I,z-h),this.tokens=G}get offset(){return this._offset}read(){return this.tokens[this.idx++]||null}peek(){return this.tokens[this.idx]||null}skip(p){throw new V.EM}}},73429:(me,X,T)=>{T.d(X,{N:()=>x,v:()=>j});var V=T(60753);const K=[];function j(M,c,C){c instanceof V.d||(c=new V.d(c,[],!!C)),K.push([M,c])}function x(){return K}},78386:(me,X,T)=>{T.d(X,{C7:()=>x,MS:()=>G,QB:()=>w,Qx:()=>v,VL:()=>f,Vh:()=>c,Vp:()=>M,eu:()=>b,l4:()=>L,o0:()=>h,pW:()=>B,qe:()=>d,rR:()=>P,sS:()=>p,vr:()=>I,wP:()=>A,zG:()=>_});var V=T(85565),K=T(98414),j=T(43228);function x(S,z,D,E){return S!==D?d(D-S,E):d(0,E-z)}const M=0;function c(S){return S===0}const C=2**26;function d(S,z){return S*C+z}function L(S){const z=S,D=Math.floor(z/C),E=z-D*C;return new j.W(D,E)}function b(S){return Math.floor(S/C)}function p(S){return S}function w(S,z){let D=S+z;return z>=C&&(D=D-S%C),D}function B(S,z){return S.reduce((D,E)=>w(D,z(E)),M)}function A(S,z){return S===z}function G(S,z){const D=S,E=z;if(E-D<=0)return M;const W=Math.floor(D/C),$=Math.floor(E/C),Y=E-$*C;if(W===$){const ne=D-W*C;return d(0,Y-ne)}else return d($-W,Y)}function _(S,z){return S<z}function I(S,z){return S<=z}function h(S,z){return S>=z}function f(S){return d(S.lineNumber-1,S.column-1)}function v(S,z){const D=S,E=Math.floor(D/C),y=D-E*C,W=z,$=Math.floor(W/C),Y=W-$*C;return new K.Q(E+1,y+1,$+1,Y+1)}function P(S){const z=(0,V.uz)(S);return d(z.length-1,z[z.length-1].length)}},81275:(me,X,T)=>{T.d(X,{Su:()=>b,b7:()=>L,fe:()=>w});var V=T(85565),K=T(90692),j=T(55409);let x;function M(){return x||(x=new TextDecoder("UTF-16LE")),x}let c;function C(){return c||(c=new TextDecoder("UTF-16BE")),c}let d;function L(){return d||(d=K.cm()?M():C()),d}function b(B,A,G){const _=new Uint16Array(B.buffer,A,G);return G>0&&(_[0]===65279||_[0]===65534)?p(B,A,G):M().decode(_)}function p(B,A,G){const _=[];let I=0;for(let h=0;h<G;h++){const f=j.$l(B,A);A+=2,_[I++]=String.fromCharCode(f)}return _.join("")}class w{constructor(A){this._capacity=A|0,this._buffer=new Uint16Array(this._capacity),this._completedStrings=null,this._bufferLength=0}reset(){this._completedStrings=null,this._bufferLength=0}build(){return this._completedStrings!==null?(this._flushBuffer(),this._completedStrings.join("")):this._buildBuffer()}_buildBuffer(){if(this._bufferLength===0)return"";const A=new Uint16Array(this._buffer.buffer,0,this._bufferLength);return L().decode(A)}_flushBuffer(){const A=this._buildBuffer();this._bufferLength=0,this._completedStrings===null?this._completedStrings=[A]:this._completedStrings[this._completedStrings.length]=A}appendCharCode(A){const G=this._capacity-this._bufferLength;G<=1&&(G===0||V.pc(A))&&this._flushBuffer(),this._buffer[this._bufferLength++]=A}appendASCIICharCode(A){this._bufferLength===this._capacity&&this._flushBuffer(),this._buffer[this._bufferLength++]=A}appendString(A){const G=A.length;if(this._bufferLength+G>=this._capacity){this._flushBuffer(),this._completedStrings[this._completedStrings.length]=A;return}for(let _=0;_<G;_++)this._buffer[this._bufferLength++]=A.charCodeAt(_)}}},81483:(me,X,T)=>{T.d(X,{GB:()=>j,i3:()=>K,l:()=>V});var V;(function(M){M[M.None=0]="None",M[M.Indent=1]="Indent",M[M.IndentOutdent=2]="IndentOutdent",M[M.Outdent=3]="Outdent"})(V||(V={}));class K{constructor(c){if(this._neutralCharacter=null,this._neutralCharacterSearched=!1,this.open=c.open,this.close=c.close,this._inString=!0,this._inComment=!0,this._inRegEx=!0,Array.isArray(c.notIn))for(let C=0,d=c.notIn.length;C<d;C++)switch(c.notIn[C]){case"string":this._inString=!1;break;case"comment":this._inComment=!1;break;case"regex":this._inRegEx=!1;break}}isOK(c){switch(c){case 0:return!0;case 1:return this._inComment;case 2:return this._inString;case 3:return this._inRegEx}}shouldAutoClose(c,C){if(c.getTokenCount()===0)return!0;const d=c.findTokenIndexAtOffset(C-2),L=c.getStandardTokenType(d);return this.isOK(L)}_findNeutralCharacterInRange(c,C){for(let d=c;d<=C;d++){const L=String.fromCharCode(d);if(!this.open.includes(L)&&!this.close.includes(L))return L}return null}findNeutralCharacter(){return this._neutralCharacterSearched||(this._neutralCharacterSearched=!0,this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(48,57)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(97,122)),this._neutralCharacter||(this._neutralCharacter=this._findNeutralCharacterInRange(65,90))),this._neutralCharacter}}class j{constructor(c){this.autoClosingPairsOpenByStart=new Map,this.autoClosingPairsOpenByEnd=new Map,this.autoClosingPairsCloseByStart=new Map,this.autoClosingPairsCloseByEnd=new Map,this.autoClosingPairsCloseSingleChar=new Map;for(const C of c)x(this.autoClosingPairsOpenByStart,C.open.charAt(0),C),x(this.autoClosingPairsOpenByEnd,C.open.charAt(C.open.length-1),C),x(this.autoClosingPairsCloseByStart,C.close.charAt(0),C),x(this.autoClosingPairsCloseByEnd,C.close.charAt(C.close.length-1),C),C.close.length===1&&C.open.length===1&&x(this.autoClosingPairsCloseSingleChar,C.close,C)}}function x(M,c,C){M.has(c)?M.get(c).push(C):M.set(c,[C])}},84059:(me,X,T)=>{T.r(X),T.d(X,{ITextResourceConfigurationService:()=>K,ITextResourcePropertiesService:()=>j});var V=T(81545);const K=(0,V.u1)("textResourceConfigurationService"),j=(0,V.u1)("textResourcePropertiesService")},84715:(me,X,T)=>{T.d(X,{Z:()=>d});var V=T(85565),K=T(22796),j=T(78386),x=T(67083),M=T(69977);class c{static createFromLanguage(b,p){function w(A){return p.getKey(`${A.languageId}:::${A.bracketText}`)}const B=new Map;for(const A of b.bracketsNew.openingBrackets){const G=(0,j.qe)(0,A.bracketText.length),_=w(A),I=x.gV.getEmpty().add(_,x.FD);B.set(A.bracketText,new M.ou(G,1,_,I,K.rh.create(G,A,I)))}for(const A of b.bracketsNew.closingBrackets){const G=(0,j.qe)(0,A.bracketText.length);let _=x.gV.getEmpty();const I=A.getOpeningBrackets();for(const h of I)_=_.add(w(h),x.FD);B.set(A.bracketText,new M.ou(G,2,w(I[0]),_,K.rh.create(G,A,_)))}return new c(B)}constructor(b){this.map=b,this.hasRegExp=!1,this._regExpGlobal=null}getRegExpStr(){if(this.isEmpty)return null;{const b=[...this.map.keys()];return b.sort(),b.reverse(),b.map(p=>C(p)).join("|")}}get regExpGlobal(){if(!this.hasRegExp){const b=this.getRegExpStr();this._regExpGlobal=b?new RegExp(b,"gi"):null,this.hasRegExp=!0}return this._regExpGlobal}getToken(b){return this.map.get(b.toLowerCase())}findClosingTokenText(b){for(const[p,w]of this.map)if(w.kind===2&&w.bracketIds.intersects(b))return p}get isEmpty(){return this.map.size===0}}function C(L){let b=(0,V.bm)(L);return/^[\w ]+/.test(L)&&(b=`\\b${b}`),/[\w ]+$/.test(L)&&(b=`${b}\\b`),b}class d{constructor(b,p){this.denseKeyProvider=b,this.getLanguageConfiguration=p,this.languageIdToBracketTokens=new Map}didLanguageChange(b){return this.languageIdToBracketTokens.has(b)}getSingleLanguageBracketTokens(b){let p=this.languageIdToBracketTokens.get(b);return p||(p=c.createFromLanguage(this.getLanguageConfiguration(b),this.denseKeyProvider),this.languageIdToBracketTokens.set(b,p)),p}}},87451:(me,X,T)=>{T.d(X,{Ho:()=>Qe,kI:()=>Oe,Bz:()=>vt});var V=T(93009),K=T(34920),j=T(87856),x=T(56491),M=T(60599),c=T(85565),C=T(37473),d=T(41135),L=T(58932),b=T(69504),p=T(98414),w=T(47545),B=T(28841),A=T(71521),G=T(61231),_=T(26342),I=T(90439),h=T(22461);class f{constructor(e,t,n,i){this.range=e,this.nestingLevel=t,this.nestingLevelOfEqualBracketType=n,this.isInvalid=i}}class v{constructor(e,t,n,i,s,r){this.range=e,this.openingBracketRange=t,this.closingBracketRange=n,this.nestingLevel=i,this.nestingLevelOfEqualBracketType=s,this.bracketPairNode=r}get openingBracketInfo(){return this.bracketPairNode.openingBracket.bracketInfo}}class P extends v{constructor(e,t,n,i,s,r,o){super(e,t,n,i,s,r),this.minVisibleColumnIndentation=o}}var S=T(45635),z=T(84715),D=T(78386),E=T(6006),y=T(67083),W=T(69977),$=T(31633);class Y extends M.jG{didLanguageChange(e){return this.brackets.didLanguageChange(e)}constructor(e,t){if(super(),this.textModel=e,this.getLanguageConfiguration=t,this.didChangeEmitter=new x.vl,this.denseKeyProvider=new y.Mg,this.brackets=new z.Z(this.denseKeyProvider,this.getLanguageConfiguration),this.onDidChange=this.didChangeEmitter.event,this.queuedTextEditsForInitialAstWithoutTokens=[],this.queuedTextEdits=[],e.tokenization.hasTokens)e.tokenization.backgroundTokenizationState===2?(this.initialAstWithoutTokens=void 0,this.astWithTokens=this.parseDocumentFromTextBuffer([],void 0,!1)):(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer([],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens);else{const n=this.brackets.getSingleLanguageBracketTokens(this.textModel.getLanguageId()),i=new W._(this.textModel.getValue(),n);this.initialAstWithoutTokens=(0,E.T)(i,[],void 0,!0),this.astWithTokens=this.initialAstWithoutTokens}}handleDidChangeBackgroundTokenizationState(){if(this.textModel.tokenization.backgroundTokenizationState===2){const e=this.initialAstWithoutTokens===void 0;this.initialAstWithoutTokens=void 0,e||this.didChangeEmitter.fire()}}handleDidChangeTokens({ranges:e}){const t=e.map(n=>new S.c((0,D.qe)(n.fromLineNumber-1,0),(0,D.qe)(n.toLineNumber,0),(0,D.qe)(n.toLineNumber-n.fromLineNumber+1,0)));this.handleEdits(t,!0),this.initialAstWithoutTokens||this.didChangeEmitter.fire()}handleContentChanged(e){const t=S.c.fromModelContentChanges(e.changes);this.handleEdits(t,!1)}handleEdits(e,t){const n=(0,$.M)(this.queuedTextEdits,e);this.queuedTextEdits=n,this.initialAstWithoutTokens&&!t&&(this.queuedTextEditsForInitialAstWithoutTokens=(0,$.M)(this.queuedTextEditsForInitialAstWithoutTokens,e))}flushQueue(){this.queuedTextEdits.length>0&&(this.astWithTokens=this.parseDocumentFromTextBuffer(this.queuedTextEdits,this.astWithTokens,!1),this.queuedTextEdits=[]),this.queuedTextEditsForInitialAstWithoutTokens.length>0&&(this.initialAstWithoutTokens&&(this.initialAstWithoutTokens=this.parseDocumentFromTextBuffer(this.queuedTextEditsForInitialAstWithoutTokens,this.initialAstWithoutTokens,!1)),this.queuedTextEditsForInitialAstWithoutTokens=[])}parseDocumentFromTextBuffer(e,t,n){const s=t,r=new W.tk(this.textModel,this.brackets);return(0,E.T)(r,e,s,n)}getBracketsInRange(e,t){this.flushQueue();const n=(0,D.qe)(e.startLineNumber-1,e.startColumn-1),i=(0,D.qe)(e.endLineNumber-1,e.endColumn-1);return new V.c1(s=>{const r=this.initialAstWithoutTokens||this.astWithTokens;_e(r,D.Vp,r.length,n,i,s,0,0,new Map,t)})}getBracketPairsInRange(e,t){this.flushQueue();const n=(0,D.VL)(e.getStartPosition()),i=(0,D.VL)(e.getEndPosition());return new V.c1(s=>{const r=this.initialAstWithoutTokens||this.astWithTokens,o=new he(s,t,this.textModel);oe(r,D.Vp,r.length,n,i,o,0,new Map)})}getFirstBracketAfter(e){this.flushQueue();const t=this.initialAstWithoutTokens||this.astWithTokens;return ue(t,D.Vp,t.length,(0,D.VL)(e))}getFirstBracketBefore(e){this.flushQueue();const t=this.initialAstWithoutTokens||this.astWithTokens;return ne(t,D.Vp,t.length,(0,D.VL)(e))}}function ne(a,e,t,n){if(a.kind===4||a.kind===2){const i=[];for(const s of a.children)t=(0,D.QB)(e,s.length),i.push({nodeOffsetStart:e,nodeOffsetEnd:t}),e=t;for(let s=i.length-1;s>=0;s--){const{nodeOffsetStart:r,nodeOffsetEnd:o}=i[s];if((0,D.zG)(r,n)){const l=ne(a.children[s],r,o,n);if(l)return l}}return null}else{if(a.kind===3)return null;if(a.kind===1){const i=(0,D.Qx)(e,t);return{bracketInfo:a.bracketInfo,range:i}}}return null}function ue(a,e,t,n){if(a.kind===4||a.kind===2){for(const i of a.children){if(t=(0,D.QB)(e,i.length),(0,D.zG)(n,t)){const s=ue(i,e,t,n);if(s)return s}e=t}return null}else{if(a.kind===3)return null;if(a.kind===1){const i=(0,D.Qx)(e,t);return{bracketInfo:a.bracketInfo,range:i}}}return null}function _e(a,e,t,n,i,s,r,o,l,g,m=!1){if(r>200)return!0;e:for(;;)switch(a.kind){case 4:{const u=a.childrenLength;for(let k=0;k<u;k++){const O=a.getChild(k);if(O){if(t=(0,D.QB)(e,O.length),(0,D.vr)(e,i)&&(0,D.o0)(t,n)){if((0,D.o0)(t,i)){a=O;continue e}if(!_e(O,e,t,n,i,s,r,0,l,g))return!1}e=t}}return!0}case 2:{const u=!g||!a.closingBracket||a.closingBracket.bracketInfo.closesColorized(a.openingBracket.bracketInfo);let k=0;if(l){let N=l.get(a.openingBracket.text);N===void 0&&(N=0),k=N,u&&(N++,l.set(a.openingBracket.text,N))}const O=a.childrenLength;for(let N=0;N<O;N++){const F=a.getChild(N);if(F){if(t=(0,D.QB)(e,F.length),(0,D.vr)(e,i)&&(0,D.o0)(t,n)){if((0,D.o0)(t,i)&&F.kind!==1){a=F,u?(r++,o=k+1):o=k;continue e}if((u||F.kind!==1||!a.closingBracket)&&!_e(F,e,t,n,i,s,u?r+1:r,u?k+1:k,l,g,!a.closingBracket))return!1}e=t}}return l?.set(a.openingBracket.text,k),!0}case 3:{const u=(0,D.Qx)(e,t);return s(new f(u,r-1,0,!0))}case 1:{const u=(0,D.Qx)(e,t);return s(new f(u,r-1,o-1,m))}case 0:return!0}}class he{constructor(e,t,n){this.push=e,this.includeMinIndentation=t,this.textModel=n}}function oe(a,e,t,n,i,s,r,o){if(r>200)return!0;let l=!0;if(a.kind===2){let g=0;if(o){let k=o.get(a.openingBracket.text);k===void 0&&(k=0),g=k,k++,o.set(a.openingBracket.text,k)}const m=(0,D.QB)(e,a.openingBracket.length);let u=-1;if(s.includeMinIndentation&&(u=a.computeMinIndentation(e,s.textModel)),l=s.push(new P((0,D.Qx)(e,t),(0,D.Qx)(e,m),a.closingBracket?(0,D.Qx)((0,D.QB)(m,a.child?.length||D.Vp),t):void 0,r,g,a,u)),e=m,l&&a.child){const k=a.child;if(t=(0,D.QB)(e,k.length),(0,D.vr)(e,i)&&(0,D.o0)(t,n)&&(l=oe(k,e,t,n,i,s,r+1,o),!l))return!1}o?.set(a.openingBracket.text,g)}else{let g=e;for(const m of a.children){const u=g;if(g=(0,D.QB)(g,m.length),(0,D.vr)(u,i)&&(0,D.vr)(n,g)&&(l=oe(m,u,g,n,i,s,r,o),!l))return!1}}return l}class ae extends M.jG{get canBuildAST(){return this.textModel.getValueLength()<=5e6}constructor(e,t){super(),this.textModel=e,this.languageConfigurationService=t,this.bracketPairsTree=this._register(new M.HE),this.onDidChangeEmitter=new x.vl,this.onDidChange=this.onDidChangeEmitter.event,this.bracketsRequested=!1}handleLanguageConfigurationServiceChange(e){(!e.languageId||this.bracketPairsTree.value?.object.didLanguageChange(e.languageId))&&(this.bracketPairsTree.clear(),this.updateBracketPairsTree())}handleDidChangeOptions(e){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeLanguage(e){this.bracketPairsTree.clear(),this.updateBracketPairsTree()}handleDidChangeContent(e){this.bracketPairsTree.value?.object.handleContentChanged(e)}handleDidChangeBackgroundTokenizationState(){this.bracketPairsTree.value?.object.handleDidChangeBackgroundTokenizationState()}handleDidChangeTokens(e){this.bracketPairsTree.value?.object.handleDidChangeTokens(e)}updateBracketPairsTree(){if(this.bracketsRequested&&this.canBuildAST){if(!this.bracketPairsTree.value){const e=new M.Cm;this.bracketPairsTree.value=fe(e.add(new Y(this.textModel,t=>this.languageConfigurationService.getLanguageConfiguration(t))),e),e.add(this.bracketPairsTree.value.object.onDidChange(t=>this.onDidChangeEmitter.fire(t))),this.onDidChangeEmitter.fire()}}else this.bracketPairsTree.value&&(this.bracketPairsTree.clear(),this.onDidChangeEmitter.fire())}getBracketPairsInRange(e){return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getBracketPairsInRange(e,!1)||V.c1.empty}getBracketPairsInRangeWithMinIndentation(e){return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getBracketPairsInRange(e,!0)||V.c1.empty}getBracketsInRange(e,t=!1){return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getBracketsInRange(e,t)||V.c1.empty}findMatchingBracketUp(e,t,n){const i=this.textModel.validatePosition(t),s=this.textModel.getLanguageIdAtPosition(i.lineNumber,i.column);if(this.canBuildAST){const r=this.languageConfigurationService.getLanguageConfiguration(s).bracketsNew.getClosingBracketInfo(e);if(!r)return null;const o=this.getBracketPairsInRange(p.Q.fromPositions(t,t)).findLast(l=>r.closes(l.openingBracketInfo));return o?o.openingBracketRange:null}else{const r=e.toLowerCase(),o=this.languageConfigurationService.getLanguageConfiguration(s).brackets;if(!o)return null;const l=o.textIsBracket[r];return l?Te(this._findMatchingBracketUp(l,i,Ce(n))):null}}matchBracket(e,t){if(this.canBuildAST){const n=this.getBracketPairsInRange(p.Q.fromPositions(e,e)).filter(i=>i.closingBracketRange!==void 0&&(i.openingBracketRange.containsPosition(e)||i.closingBracketRange.containsPosition(e))).findLastMaxBy((0,V.VE)(i=>i.openingBracketRange.containsPosition(e)?i.openingBracketRange:i.closingBracketRange,p.Q.compareRangesUsingStarts));return n?[n.openingBracketRange,n.closingBracketRange]:null}else{const n=Ce(t);return this._matchBracket(this.textModel.validatePosition(e),n)}}_establishBracketSearchOffsets(e,t,n,i){const s=t.getCount(),r=t.getLanguageId(i);let o=Math.max(0,e.column-1-n.maxBracketLength);for(let g=i-1;g>=0;g--){const m=t.getEndOffset(g);if(m<=o)break;if((0,I.Yo)(t.getStandardTokenType(g))||t.getLanguageId(g)!==r){o=m;break}}let l=Math.min(t.getLineContent().length,e.column-1+n.maxBracketLength);for(let g=i+1;g<s;g++){const m=t.getStartOffset(g);if(m>=l)break;if((0,I.Yo)(t.getStandardTokenType(g))||t.getLanguageId(g)!==r){l=m;break}}return{searchStartOffset:o,searchEndOffset:l}}_matchBracket(e,t){const n=e.lineNumber,i=this.textModel.tokenization.getLineTokens(n),s=this.textModel.getLineContent(n),r=i.findTokenIndexAtOffset(e.column-1);if(r<0)return null;const o=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(r)).brackets;if(o&&!(0,I.Yo)(i.getStandardTokenType(r))){let{searchStartOffset:l,searchEndOffset:g}=this._establishBracketSearchOffsets(e,i,o,r),m=null;for(;;){const u=h.Fu.findNextBracketInRange(o.forwardRegex,n,s,l,g);if(!u)break;if(u.startColumn<=e.column&&e.column<=u.endColumn){const k=s.substring(u.startColumn-1,u.endColumn-1).toLowerCase(),O=this._matchFoundBracket(u,o.textIsBracket[k],o.textIsOpenBracket[k],t);if(O){if(O instanceof Ie)return null;m=O}}l=u.endColumn-1}if(m)return m}if(r>0&&i.getStartOffset(r)===e.column-1){const l=r-1,g=this.languageConfigurationService.getLanguageConfiguration(i.getLanguageId(l)).brackets;if(g&&!(0,I.Yo)(i.getStandardTokenType(l))){const{searchStartOffset:m,searchEndOffset:u}=this._establishBracketSearchOffsets(e,i,g,l),k=h.Fu.findPrevBracketInRange(g.reversedRegex,n,s,m,u);if(k&&k.startColumn<=e.column&&e.column<=k.endColumn){const O=s.substring(k.startColumn-1,k.endColumn-1).toLowerCase(),N=this._matchFoundBracket(k,g.textIsBracket[O],g.textIsOpenBracket[O],t);if(N)return N instanceof Ie?null:N}}}return null}_matchFoundBracket(e,t,n,i){if(!t)return null;const s=n?this._findMatchingBracketDown(t,e.getEndPosition(),i):this._findMatchingBracketUp(t,e.getStartPosition(),i);return s?s instanceof Ie?s:[e,s]:null}_findMatchingBracketUp(e,t,n){const i=e.languageId,s=e.reversedRegex;let r=-1,o=0;const l=(g,m,u,k)=>{for(;;){if(n&&++o%100===0&&!n())return Ie.INSTANCE;const O=h.Fu.findPrevBracketInRange(s,g,m,u,k);if(!O)break;const N=m.substring(O.startColumn-1,O.endColumn-1).toLowerCase();if(e.isOpen(N)?r++:e.isClose(N)&&r--,r===0)return O;k=O.startColumn-1}return null};for(let g=t.lineNumber;g>=1;g--){const m=this.textModel.tokenization.getLineTokens(g),u=m.getCount(),k=this.textModel.getLineContent(g);let O=u-1,N=k.length,F=k.length;g===t.lineNumber&&(O=m.findTokenIndexAtOffset(t.column-1),N=t.column-1,F=t.column-1);let U=!0;for(;O>=0;O--){const Q=m.getLanguageId(O)===i&&!(0,I.Yo)(m.getStandardTokenType(O));if(Q)U?N=m.getStartOffset(O):(N=m.getStartOffset(O),F=m.getEndOffset(O));else if(U&&N!==F){const q=l(g,k,N,F);if(q)return q}U=Q}if(U&&N!==F){const Q=l(g,k,N,F);if(Q)return Q}}return null}_findMatchingBracketDown(e,t,n){const i=e.languageId,s=e.forwardRegex;let r=1,o=0;const l=(m,u,k,O)=>{for(;;){if(n&&++o%100===0&&!n())return Ie.INSTANCE;const N=h.Fu.findNextBracketInRange(s,m,u,k,O);if(!N)break;const F=u.substring(N.startColumn-1,N.endColumn-1).toLowerCase();if(e.isOpen(F)?r++:e.isClose(F)&&r--,r===0)return N;k=N.endColumn-1}return null},g=this.textModel.getLineCount();for(let m=t.lineNumber;m<=g;m++){const u=this.textModel.tokenization.getLineTokens(m),k=u.getCount(),O=this.textModel.getLineContent(m);let N=0,F=0,U=0;m===t.lineNumber&&(N=u.findTokenIndexAtOffset(t.column-1),F=t.column-1,U=t.column-1);let Q=!0;for(;N<k;N++){const q=u.getLanguageId(N)===i&&!(0,I.Yo)(u.getStandardTokenType(N));if(q)Q||(F=u.getStartOffset(N)),U=u.getEndOffset(N);else if(Q&&F!==U){const re=l(m,O,F,U);if(re)return re}Q=q}if(Q&&F!==U){const q=l(m,O,F,U);if(q)return q}}return null}findPrevBracket(e){const t=this.textModel.validatePosition(e);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getFirstBracketBefore(t)||null;let n=null,i=null,s=null;for(let r=t.lineNumber;r>=1;r--){const o=this.textModel.tokenization.getLineTokens(r),l=o.getCount(),g=this.textModel.getLineContent(r);let m=l-1,u=g.length,k=g.length;if(r===t.lineNumber){m=o.findTokenIndexAtOffset(t.column-1),u=t.column-1,k=t.column-1;const N=o.getLanguageId(m);n!==N&&(n=N,i=this.languageConfigurationService.getLanguageConfiguration(n).brackets,s=this.languageConfigurationService.getLanguageConfiguration(n).bracketsNew)}let O=!0;for(;m>=0;m--){const N=o.getLanguageId(m);if(n!==N){if(i&&s&&O&&u!==k){const U=h.Fu.findPrevBracketInRange(i.reversedRegex,r,g,u,k);if(U)return this._toFoundBracket(s,U);O=!1}n=N,i=this.languageConfigurationService.getLanguageConfiguration(n).brackets,s=this.languageConfigurationService.getLanguageConfiguration(n).bracketsNew}const F=!!i&&!(0,I.Yo)(o.getStandardTokenType(m));if(F)O?u=o.getStartOffset(m):(u=o.getStartOffset(m),k=o.getEndOffset(m));else if(s&&i&&O&&u!==k){const U=h.Fu.findPrevBracketInRange(i.reversedRegex,r,g,u,k);if(U)return this._toFoundBracket(s,U)}O=F}if(s&&i&&O&&u!==k){const N=h.Fu.findPrevBracketInRange(i.reversedRegex,r,g,u,k);if(N)return this._toFoundBracket(s,N)}}return null}findNextBracket(e){const t=this.textModel.validatePosition(e);if(this.canBuildAST)return this.bracketsRequested=!0,this.updateBracketPairsTree(),this.bracketPairsTree.value?.object.getFirstBracketAfter(t)||null;const n=this.textModel.getLineCount();let i=null,s=null,r=null;for(let o=t.lineNumber;o<=n;o++){const l=this.textModel.tokenization.getLineTokens(o),g=l.getCount(),m=this.textModel.getLineContent(o);let u=0,k=0,O=0;if(o===t.lineNumber){u=l.findTokenIndexAtOffset(t.column-1),k=t.column-1,O=t.column-1;const F=l.getLanguageId(u);i!==F&&(i=F,s=this.languageConfigurationService.getLanguageConfiguration(i).brackets,r=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew)}let N=!0;for(;u<g;u++){const F=l.getLanguageId(u);if(i!==F){if(r&&s&&N&&k!==O){const Q=h.Fu.findNextBracketInRange(s.forwardRegex,o,m,k,O);if(Q)return this._toFoundBracket(r,Q);N=!1}i=F,s=this.languageConfigurationService.getLanguageConfiguration(i).brackets,r=this.languageConfigurationService.getLanguageConfiguration(i).bracketsNew}const U=!!s&&!(0,I.Yo)(l.getStandardTokenType(u));if(U)N||(k=l.getStartOffset(u)),O=l.getEndOffset(u);else if(r&&s&&N&&k!==O){const Q=h.Fu.findNextBracketInRange(s.forwardRegex,o,m,k,O);if(Q)return this._toFoundBracket(r,Q)}N=U}if(r&&s&&N&&k!==O){const F=h.Fu.findNextBracketInRange(s.forwardRegex,o,m,k,O);if(F)return this._toFoundBracket(r,F)}}return null}findEnclosingBrackets(e,t){const n=this.textModel.validatePosition(e);if(this.canBuildAST){const O=p.Q.fromPositions(n),N=this.getBracketPairsInRange(p.Q.fromPositions(n,n)).findLast(F=>F.closingBracketRange!==void 0&&F.range.strictContainsRange(O));return N?[N.openingBracketRange,N.closingBracketRange]:null}const i=Ce(t),s=this.textModel.getLineCount(),r=new Map;let o=[];const l=(O,N)=>{if(!r.has(O)){const F=[];for(let U=0,Q=N?N.brackets.length:0;U<Q;U++)F[U]=0;r.set(O,F)}o=r.get(O)};let g=0;const m=(O,N,F,U,Q)=>{for(;;){if(i&&++g%100===0&&!i())return Ie.INSTANCE;const q=h.Fu.findNextBracketInRange(O.forwardRegex,N,F,U,Q);if(!q)break;const re=F.substring(q.startColumn-1,q.endColumn-1).toLowerCase(),pe=O.textIsBracket[re];if(pe&&(pe.isOpen(re)?o[pe.index]++:pe.isClose(re)&&o[pe.index]--,o[pe.index]===-1))return this._matchFoundBracket(q,pe,!1,i);U=q.endColumn-1}return null};let u=null,k=null;for(let O=n.lineNumber;O<=s;O++){const N=this.textModel.tokenization.getLineTokens(O),F=N.getCount(),U=this.textModel.getLineContent(O);let Q=0,q=0,re=0;if(O===n.lineNumber){Q=N.findTokenIndexAtOffset(n.column-1),q=n.column-1,re=n.column-1;const ke=N.getLanguageId(Q);u!==ke&&(u=ke,k=this.languageConfigurationService.getLanguageConfiguration(u).brackets,l(u,k))}let pe=!0;for(;Q<F;Q++){const ke=N.getLanguageId(Q);if(u!==ke){if(k&&pe&&q!==re){const Ee=m(k,O,U,q,re);if(Ee)return Te(Ee);pe=!1}u=ke,k=this.languageConfigurationService.getLanguageConfiguration(u).brackets,l(u,k)}const be=!!k&&!(0,I.Yo)(N.getStandardTokenType(Q));if(be)pe||(q=N.getStartOffset(Q)),re=N.getEndOffset(Q);else if(k&&pe&&q!==re){const Ee=m(k,O,U,q,re);if(Ee)return Te(Ee)}pe=be}if(k&&pe&&q!==re){const ke=m(k,O,U,q,re);if(ke)return Te(ke)}}return null}_toFoundBracket(e,t){if(!t)return null;let n=this.textModel.getValueInRange(t);n=n.toLowerCase();const i=e.getBracketInfo(n);return i?{range:t,bracketInfo:i}:null}}function fe(a,e){return{object:a,dispose:()=>e?.dispose()}}function Ce(a){if(typeof a>"u")return()=>!0;{const e=Date.now();return()=>Date.now()-e<=a}}class Ie{static{this.INSTANCE=new Ie}constructor(){this._searchCanceledBrand=void 0}}function Te(a){return a instanceof Ie?null:a}var Ne=T(54656),We=T(41403);class ce extends M.jG{constructor(e){super(),this.textModel=e,this.colorProvider=new R,this.onDidChangeEmitter=new x.vl,this.onDidChange=this.onDidChangeEmitter.event,this.colorizationOptions=e.getOptions().bracketPairColorizationOptions,this._register(e.bracketPairs.onDidChange(t=>{this.onDidChangeEmitter.fire()}))}handleDidChangeOptions(e){this.colorizationOptions=this.textModel.getOptions().bracketPairColorizationOptions}getDecorationsInRange(e,t,n,i){return i?[]:t===void 0?[]:this.colorizationOptions.enabled?this.textModel.bracketPairs.getBracketsInRange(e,!0).map(r=>({id:`bracket${r.range.toString()}-${r.nestingLevel}`,options:{description:"BracketPairColorization",inlineClassName:this.colorProvider.getInlineClassName(r,this.colorizationOptions.independentColorPoolPerBracketType)},ownerId:0,range:r.range})).toArray():[]}getAllDecorations(e,t){return e===void 0?[]:this.colorizationOptions.enabled?this.getDecorationsInRange(new p.Q(1,1,this.textModel.getLineCount(),1),e,t):[]}}class R{constructor(){this.unexpectedClosingBracketClassName="unexpected-closing-bracket"}getInlineClassName(e,t){return e.isInvalid?this.unexpectedClosingBracketClassName:this.getInlineClassNameOfLevel(t?e.nestingLevelOfEqualBracketType:e.nestingLevel)}getInlineClassNameOfLevel(e){return`bracket-highlighting-${e%30}`}}(0,We.zy)((a,e)=>{const t=[Ne.sN,Ne.lQ,Ne.ss,Ne.l5,Ne.sH,Ne.zp],n=new R;e.addRule(`.monaco-editor .${n.unexpectedClosingBracketClassName} { color: ${a.getColor(Ne.s7)}; }`);const i=t.map(s=>a.getColor(s)).filter(s=>!!s).filter(s=>!s.isTransparent());for(let s=0;s<30;s++){const r=i[s%i.length];e.addRule(`.monaco-editor .${n.getInlineClassNameOfLevel(s)} { color: ${r}; }`)}});var H=T(95981),te=T(8731);class ie{constructor(){this.spacesDiff=0,this.looksLikeAlignment=!1}}function ge(a,e,t,n,i){i.spacesDiff=0,i.looksLikeAlignment=!1;let s;for(s=0;s<e&&s<n;s++){const k=a.charCodeAt(s),O=t.charCodeAt(s);if(k!==O)break}let r=0,o=0;for(let k=s;k<e;k++)a.charCodeAt(k)===32?r++:o++;let l=0,g=0;for(let k=s;k<n;k++)t.charCodeAt(k)===32?l++:g++;if(r>0&&o>0||l>0&&g>0)return;const m=Math.abs(o-g),u=Math.abs(r-l);if(m===0){i.spacesDiff=u,u>0&&0<=l-1&&l-1<a.length&&l<t.length&&t.charCodeAt(l)!==32&&a.charCodeAt(l-1)===32&&a.charCodeAt(a.length-1)===44&&(i.looksLikeAlignment=!0);return}if(u%m===0){i.spacesDiff=u/m;return}}function Le(a,e,t){const n=Math.min(a.getLineCount(),1e4);let i=0,s=0,r="",o=0;const l=[2,4,6,8,3,5,7],g=8,m=[0,0,0,0,0,0,0,0,0],u=new ie;for(let N=1;N<=n;N++){const F=a.getLineLength(N),U=a.getLineContent(N),Q=F<=65536;let q=!1,re=0,pe=0,ke=0;for(let Ee=0,rt=F;Ee<rt;Ee++){const we=Q?U.charCodeAt(Ee):a.getLineCharCode(N,Ee);if(we===9)ke++;else if(we===32)pe++;else{q=!0,re=Ee;break}}if(!q||(ke>0?i++:pe>1&&s++,ge(r,o,U,re,u),u.looksLikeAlignment&&!(t&&e===u.spacesDiff)))continue;const be=u.spacesDiff;be<=g&&m[be]++,r=U,o=re}let k=t;i!==s&&(k=i<s);let O=e;if(k){let N=k?0:.1*n;l.forEach(F=>{const U=m[F];U>N&&(N=U,O=F)}),O===4&&m[4]>0&&m[2]>0&&m[2]>=m[4]/2&&(O=2)}return{insertSpaces:k,tabSize:O}}function J(a){return(a.metadata&1)>>>0}function se(a,e){a.metadata=a.metadata&254|e<<0}function de(a){return(a.metadata&2)>>>1===1}function le(a,e){a.metadata=a.metadata&253|(e?1:0)<<1}function Mt(a){return(a.metadata&4)>>>2===1}function Dt(a,e){a.metadata=a.metadata&251|(e?1:0)<<2}function Rt(a){return(a.metadata&64)>>>6===1}function Nt(a,e){a.metadata=a.metadata&191|(e?1:0)<<6}function sn(a){return(a.metadata&24)>>>3}function Pt(a,e){a.metadata=a.metadata&231|e<<3}function rn(a){return(a.metadata&32)>>>5===1}function At(a,e){a.metadata=a.metadata&223|(e?1:0)<<5}class zt{constructor(e,t,n){this.metadata=0,this.parent=this,this.left=this,this.right=this,se(this,1),this.start=t,this.end=n,this.delta=0,this.maxEnd=n,this.id=e,this.ownerId=0,this.options=null,Dt(this,!1),Nt(this,!1),Pt(this,1),At(this,!1),this.cachedVersionId=0,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=n,this.range=null,le(this,!1)}reset(e,t,n,i){this.start=t,this.end=n,this.maxEnd=n,this.cachedVersionId=e,this.cachedAbsoluteStart=t,this.cachedAbsoluteEnd=n,this.range=i}setOptions(e){this.options=e;const t=this.options.className;Dt(this,t==="squiggly-error"||t==="squiggly-warning"||t==="squiggly-info"),Nt(this,this.options.glyphMarginClassName!==null),Pt(this,this.options.stickiness),At(this,this.options.collapseOnReplaceEdit)}setCachedOffsets(e,t,n){this.cachedVersionId!==n&&(this.range=null),this.cachedVersionId=n,this.cachedAbsoluteStart=e,this.cachedAbsoluteEnd=t}detach(){this.parent=null,this.left=null,this.right=null}}const ee=new zt(null,0,0);ee.parent=ee,ee.left=ee,ee.right=ee,se(ee,0);class gt{constructor(){this.root=ee,this.requestNormalizeDelta=!1}intervalSearch(e,t,n,i,s,r){return this.root===ee?[]:fn(this,e,t,n,i,s,r)}search(e,t,n,i){return this.root===ee?[]:dn(this,e,t,n,i)}collectNodesFromOwner(e){return cn(this,e)}collectNodesPostOrder(){return un(this)}insert(e){yt(this,e),this._normalizeDeltaIfNecessary()}delete(e){Ft(this,e),this._normalizeDeltaIfNecessary()}resolveNode(e,t){const n=e;let i=0;for(;e!==this.root;)e===e.parent.right&&(i+=e.parent.delta),e=e.parent;const s=n.start+i,r=n.end+i;n.setCachedOffsets(s,r,t)}acceptReplace(e,t,n,i){const s=ln(this,e,e+t);for(let r=0,o=s.length;r<o;r++){const l=s[r];Ft(this,l)}this._normalizeDeltaIfNecessary(),hn(this,e,e+t,n),this._normalizeDeltaIfNecessary();for(let r=0,o=s.length;r<o;r++){const l=s[r];l.start=l.cachedAbsoluteStart,l.end=l.cachedAbsoluteEnd,an(l,e,e+t,n,i),l.maxEnd=l.end,yt(this,l)}this._normalizeDeltaIfNecessary()}_normalizeDeltaIfNecessary(){this.requestNormalizeDelta&&(this.requestNormalizeDelta=!1,on(this))}}function on(a){let e=a.root,t=0;for(;e!==ee;){if(e.left!==ee&&!de(e.left)){e=e.left;continue}if(e.right!==ee&&!de(e.right)){t+=e.delta,e=e.right;continue}e.start=t+e.start,e.end=t+e.end,e.delta=0,Ue(e),le(e,!0),le(e.left,!1),le(e.right,!1),e===e.parent.right&&(t-=e.parent.delta),e=e.parent}le(a.root,!1)}function Ke(a,e,t,n){return a<t?!0:a>t||n===1?!1:n===2?!0:e}function an(a,e,t,n,i){const s=sn(a),r=s===0||s===2,o=s===1||s===2,l=t-e,g=n,m=Math.min(l,g),u=a.start;let k=!1;const O=a.end;let N=!1;e<=u&&O<=t&&rn(a)&&(a.start=e,k=!0,a.end=e,N=!0);{const U=i?1:l>0?2:0;!k&&Ke(u,r,e,U)&&(k=!0),!N&&Ke(O,o,e,U)&&(N=!0)}if(m>0&&!i){const U=l>g?2:0;!k&&Ke(u,r,e+m,U)&&(k=!0),!N&&Ke(O,o,e+m,U)&&(N=!0)}{const U=i?1:0;!k&&Ke(u,r,t,U)&&(a.start=e+g,k=!0),!N&&Ke(O,o,t,U)&&(a.end=e+g,N=!0)}const F=g-l;k||(a.start=Math.max(0,u+F)),N||(a.end=Math.max(0,O+F)),a.start>a.end&&(a.end=a.start)}function ln(a,e,t){let n=a.root,i=0,s=0,r=0,o=0;const l=[];let g=0;for(;n!==ee;){if(de(n)){le(n.left,!1),le(n.right,!1),n===n.parent.right&&(i-=n.parent.delta),n=n.parent;continue}if(!de(n.left)){if(s=i+n.maxEnd,s<e){le(n,!0);continue}if(n.left!==ee){n=n.left;continue}}if(r=i+n.start,r>t){le(n,!0);continue}if(o=i+n.end,o>=e&&(n.setCachedOffsets(r,o,0),l[g++]=n),le(n,!0),n.right!==ee&&!de(n.right)){i+=n.delta,n=n.right;continue}}return le(a.root,!1),l}function hn(a,e,t,n){let i=a.root,s=0,r=0,o=0;const l=n-(t-e);for(;i!==ee;){if(de(i)){le(i.left,!1),le(i.right,!1),i===i.parent.right&&(s-=i.parent.delta),Ue(i),i=i.parent;continue}if(!de(i.left)){if(r=s+i.maxEnd,r<e){le(i,!0);continue}if(i.left!==ee){i=i.left;continue}}if(o=s+i.start,o>t){i.start+=l,i.end+=l,i.delta+=l,(i.delta<-1073741824||i.delta>1073741824)&&(a.requestNormalizeDelta=!0),le(i,!0);continue}if(le(i,!0),i.right!==ee&&!de(i.right)){s+=i.delta,i=i.right;continue}}le(a.root,!1)}function cn(a,e){let t=a.root;const n=[];let i=0;for(;t!==ee;){if(de(t)){le(t.left,!1),le(t.right,!1),t=t.parent;continue}if(t.left!==ee&&!de(t.left)){t=t.left;continue}if(t.ownerId===e&&(n[i++]=t),le(t,!0),t.right!==ee&&!de(t.right)){t=t.right;continue}}return le(a.root,!1),n}function un(a){let e=a.root;const t=[];let n=0;for(;e!==ee;){if(de(e)){le(e.left,!1),le(e.right,!1),e=e.parent;continue}if(e.left!==ee&&!de(e.left)){e=e.left;continue}if(e.right!==ee&&!de(e.right)){e=e.right;continue}t[n++]=e,le(e,!0)}return le(a.root,!1),t}function dn(a,e,t,n,i){let s=a.root,r=0,o=0,l=0;const g=[];let m=0;for(;s!==ee;){if(de(s)){le(s.left,!1),le(s.right,!1),s===s.parent.right&&(r-=s.parent.delta),s=s.parent;continue}if(s.left!==ee&&!de(s.left)){s=s.left;continue}o=r+s.start,l=r+s.end,s.setCachedOffsets(o,l,n);let u=!0;if(e&&s.ownerId&&s.ownerId!==e&&(u=!1),t&&Mt(s)&&(u=!1),i&&!Rt(s)&&(u=!1),u&&(g[m++]=s),le(s,!0),s.right!==ee&&!de(s.right)){r+=s.delta,s=s.right;continue}}return le(a.root,!1),g}function fn(a,e,t,n,i,s,r){let o=a.root,l=0,g=0,m=0,u=0;const k=[];let O=0;for(;o!==ee;){if(de(o)){le(o.left,!1),le(o.right,!1),o===o.parent.right&&(l-=o.parent.delta),o=o.parent;continue}if(!de(o.left)){if(g=l+o.maxEnd,g<e){le(o,!0);continue}if(o.left!==ee){o=o.left;continue}}if(m=l+o.start,m>t){le(o,!0);continue}if(u=l+o.end,u>=e){o.setCachedOffsets(m,u,s);let N=!0;n&&o.ownerId&&o.ownerId!==n&&(N=!1),i&&Mt(o)&&(N=!1),r&&!Rt(o)&&(N=!1),N&&(k[O++]=o)}if(le(o,!0),o.right!==ee&&!de(o.right)){l+=o.delta,o=o.right;continue}}return le(a.root,!1),k}function yt(a,e){if(a.root===ee)return e.parent=ee,e.left=ee,e.right=ee,se(e,0),a.root=e,a.root;gn(a,e),Ve(e.parent);let t=e;for(;t!==a.root&&J(t.parent)===1;)if(t.parent===t.parent.parent.left){const n=t.parent.parent.right;J(n)===1?(se(t.parent,0),se(n,0),se(t.parent.parent,1),t=t.parent.parent):(t===t.parent.right&&(t=t.parent,Ye(a,t)),se(t.parent,0),se(t.parent.parent,1),Ze(a,t.parent.parent))}else{const n=t.parent.parent.left;J(n)===1?(se(t.parent,0),se(n,0),se(t.parent.parent,1),t=t.parent.parent):(t===t.parent.left&&(t=t.parent,Ze(a,t)),se(t.parent,0),se(t.parent.parent,1),Ye(a,t.parent.parent))}return se(a.root,0),e}function gn(a,e){let t=0,n=a.root;const i=e.start,s=e.end;for(;;)if(pn(i,s,n.start+t,n.end+t)<0)if(n.left===ee){e.start-=t,e.end-=t,e.maxEnd-=t,n.left=e;break}else n=n.left;else if(n.right===ee){e.start-=t+n.delta,e.end-=t+n.delta,e.maxEnd-=t+n.delta,n.right=e;break}else t+=n.delta,n=n.right;e.parent=n,e.left=ee,e.right=ee,se(e,1)}function Ft(a,e){let t,n;if(e.left===ee?(t=e.right,n=e,t.delta+=e.delta,(t.delta<-1073741824||t.delta>1073741824)&&(a.requestNormalizeDelta=!0),t.start+=e.delta,t.end+=e.delta):e.right===ee?(t=e.left,n=e):(n=_n(e.right),t=n.right,t.start+=n.delta,t.end+=n.delta,t.delta+=n.delta,(t.delta<-1073741824||t.delta>1073741824)&&(a.requestNormalizeDelta=!0),n.start+=e.delta,n.end+=e.delta,n.delta=e.delta,(n.delta<-1073741824||n.delta>1073741824)&&(a.requestNormalizeDelta=!0)),n===a.root){a.root=t,se(t,0),e.detach(),_t(),Ue(t),a.root.parent=ee;return}const i=J(n)===1;if(n===n.parent.left?n.parent.left=t:n.parent.right=t,n===e?t.parent=n.parent:(n.parent===e?t.parent=n:t.parent=n.parent,n.left=e.left,n.right=e.right,n.parent=e.parent,se(n,J(e)),e===a.root?a.root=n:e===e.parent.left?e.parent.left=n:e.parent.right=n,n.left!==ee&&(n.left.parent=n),n.right!==ee&&(n.right.parent=n)),e.detach(),i){Ve(t.parent),n!==e&&(Ve(n),Ve(n.parent)),_t();return}Ve(t),Ve(t.parent),n!==e&&(Ve(n),Ve(n.parent));let s;for(;t!==a.root&&J(t)===0;)t===t.parent.left?(s=t.parent.right,J(s)===1&&(se(s,0),se(t.parent,1),Ye(a,t.parent),s=t.parent.right),J(s.left)===0&&J(s.right)===0?(se(s,1),t=t.parent):(J(s.right)===0&&(se(s.left,0),se(s,1),Ze(a,s),s=t.parent.right),se(s,J(t.parent)),se(t.parent,0),se(s.right,0),Ye(a,t.parent),t=a.root)):(s=t.parent.left,J(s)===1&&(se(s,0),se(t.parent,1),Ze(a,t.parent),s=t.parent.left),J(s.left)===0&&J(s.right)===0?(se(s,1),t=t.parent):(J(s.left)===0&&(se(s.right,0),se(s,1),Ye(a,s),s=t.parent.left),se(s,J(t.parent)),se(t.parent,0),se(s.left,0),Ze(a,t.parent),t=a.root));se(t,0),_t()}function _n(a){for(;a.left!==ee;)a=a.left;return a}function _t(){ee.parent=ee,ee.delta=0,ee.start=0,ee.end=0}function Ye(a,e){const t=e.right;t.delta+=e.delta,(t.delta<-1073741824||t.delta>1073741824)&&(a.requestNormalizeDelta=!0),t.start+=e.delta,t.end+=e.delta,e.right=t.left,t.left!==ee&&(t.left.parent=e),t.parent=e.parent,e.parent===ee?a.root=t:e===e.parent.left?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t,Ue(e),Ue(t)}function Ze(a,e){const t=e.left;e.delta-=t.delta,(e.delta<-1073741824||e.delta>1073741824)&&(a.requestNormalizeDelta=!0),e.start-=t.delta,e.end-=t.delta,e.left=t.right,t.right!==ee&&(t.right.parent=e),t.parent=e.parent,e.parent===ee?a.root=t:e===e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t,Ue(e),Ue(t)}function Wt(a){let e=a.end;if(a.left!==ee){const t=a.left.maxEnd;t>e&&(e=t)}if(a.right!==ee){const t=a.right.maxEnd+a.delta;t>e&&(e=t)}return e}function Ue(a){a.maxEnd=Wt(a)}function Ve(a){for(;a!==ee;){const e=Wt(a);if(a.maxEnd===e)return;a.maxEnd=e,a=a.parent}}function pn(a,e,t,n){return a===t?e-n:a-t}class pt{constructor(e,t){this.piece=e,this.color=t,this.size_left=0,this.lf_left=0,this.parent=this,this.left=this,this.right=this}next(){if(this.right!==Z)return mt(this.right);let e=this;for(;e.parent!==Z&&e.parent.left!==e;)e=e.parent;return e.parent===Z?Z:e.parent}prev(){if(this.left!==Z)return Ut(this.left);let e=this;for(;e.parent!==Z&&e.parent.right!==e;)e=e.parent;return e.parent===Z?Z:e.parent}detach(){this.parent=null,this.left=null,this.right=null}}const Z=new pt(null,0);Z.parent=Z,Z.left=Z,Z.right=Z,Z.color=0;function mt(a){for(;a.left!==Z;)a=a.left;return a}function Ut(a){for(;a.right!==Z;)a=a.right;return a}function Ct(a){return a===Z?0:a.size_left+a.piece.length+Ct(a.right)}function Lt(a){return a===Z?0:a.lf_left+a.piece.lineFeedCnt+Lt(a.right)}function kt(){Z.parent=Z}function Je(a,e){const t=e.right;t.size_left+=e.size_left+(e.piece?e.piece.length:0),t.lf_left+=e.lf_left+(e.piece?e.piece.lineFeedCnt:0),e.right=t.left,t.left!==Z&&(t.left.parent=e),t.parent=e.parent,e.parent===Z?a.root=t:e.parent.left===e?e.parent.left=t:e.parent.right=t,t.left=e,e.parent=t}function qe(a,e){const t=e.left;e.left=t.right,t.right!==Z&&(t.right.parent=e),t.parent=e.parent,e.size_left-=t.size_left+(t.piece?t.piece.length:0),e.lf_left-=t.lf_left+(t.piece?t.piece.lineFeedCnt:0),e.parent===Z?a.root=t:e===e.parent.right?e.parent.right=t:e.parent.left=t,t.right=e,e.parent=t}function at(a,e){let t,n;if(e.left===Z?(n=e,t=n.right):e.right===Z?(n=e,t=n.left):(n=mt(e.right),t=n.right),n===a.root){a.root=t,t.color=0,e.detach(),kt(),a.root.parent=Z;return}const i=n.color===1;if(n===n.parent.left?n.parent.left=t:n.parent.right=t,n===e?(t.parent=n.parent,et(a,t)):(n.parent===e?t.parent=n:t.parent=n.parent,et(a,t),n.left=e.left,n.right=e.right,n.parent=e.parent,n.color=e.color,e===a.root?a.root=n:e===e.parent.left?e.parent.left=n:e.parent.right=n,n.left!==Z&&(n.left.parent=n),n.right!==Z&&(n.right.parent=n),n.size_left=e.size_left,n.lf_left=e.lf_left,et(a,n)),e.detach(),t.parent.left===t){const r=Ct(t),o=Lt(t);if(r!==t.parent.size_left||o!==t.parent.lf_left){const l=r-t.parent.size_left,g=o-t.parent.lf_left;t.parent.size_left=r,t.parent.lf_left=o,Pe(a,t.parent,l,g)}}if(et(a,t.parent),i){kt();return}let s;for(;t!==a.root&&t.color===0;)t===t.parent.left?(s=t.parent.right,s.color===1&&(s.color=0,t.parent.color=1,Je(a,t.parent),s=t.parent.right),s.left.color===0&&s.right.color===0?(s.color=1,t=t.parent):(s.right.color===0&&(s.left.color=0,s.color=1,qe(a,s),s=t.parent.right),s.color=t.parent.color,t.parent.color=0,s.right.color=0,Je(a,t.parent),t=a.root)):(s=t.parent.left,s.color===1&&(s.color=0,t.parent.color=1,qe(a,t.parent),s=t.parent.left),s.left.color===0&&s.right.color===0?(s.color=1,t=t.parent):(s.left.color===0&&(s.right.color=0,s.color=1,Je(a,s),s=t.parent.left),s.color=t.parent.color,t.parent.color=0,s.left.color=0,qe(a,t.parent),t=a.root));t.color=0,kt()}function Vt(a,e){for(et(a,e);e!==a.root&&e.parent.color===1;)if(e.parent===e.parent.parent.left){const t=e.parent.parent.right;t.color===1?(e.parent.color=0,t.color=0,e.parent.parent.color=1,e=e.parent.parent):(e===e.parent.right&&(e=e.parent,Je(a,e)),e.parent.color=0,e.parent.parent.color=1,qe(a,e.parent.parent))}else{const t=e.parent.parent.left;t.color===1?(e.parent.color=0,t.color=0,e.parent.parent.color=1,e=e.parent.parent):(e===e.parent.left&&(e=e.parent,qe(a,e)),e.parent.color=0,e.parent.parent.color=1,Je(a,e.parent.parent))}a.root.color=0}function Pe(a,e,t,n){for(;e!==a.root&&e!==Z;)e.parent.left===e&&(e.parent.size_left+=t,e.parent.lf_left+=n),e=e.parent}function et(a,e){let t=0,n=0;if(e!==a.root){for(;e!==a.root&&e===e.parent.right;)e=e.parent;if(e!==a.root)for(e=e.parent,t=Ct(e.left)-e.size_left,n=Lt(e.left)-e.lf_left,e.size_left+=t,e.lf_left+=n;e!==a.root&&(t!==0||n!==0);)e.parent.left===e&&(e.parent.size_left+=t,e.parent.lf_left+=n),e=e.parent}}var ve=T(8909);const Ae=65535;function jt(a){let e;return a[a.length-1]<65536?e=new Uint16Array(a.length):e=new Uint32Array(a.length),e.set(a,0),e}class mn{constructor(e,t,n,i,s){this.lineStarts=e,this.cr=t,this.lf=n,this.crlf=i,this.isBasicASCII=s}}function ze(a,e=!0){const t=[0];let n=1;for(let i=0,s=a.length;i<s;i++){const r=a.charCodeAt(i);r===13?i+1<s&&a.charCodeAt(i+1)===10?(t[n++]=i+2,i++):t[n++]=i+1:r===10&&(t[n++]=i+1)}return e?jt(t):t}function Cn(a,e){a.length=0,a[0]=0;let t=1,n=0,i=0,s=0,r=!0;for(let l=0,g=e.length;l<g;l++){const m=e.charCodeAt(l);m===13?l+1<g&&e.charCodeAt(l+1)===10?(s++,a[t++]=l+2,l++):(n++,a[t++]=l+1):m===10?(i++,a[t++]=l+1):r&&m!==9&&(m<32||m>126)&&(r=!1)}const o=new mn(jt(a),n,i,s,r);return a.length=0,o}class Se{constructor(e,t,n,i,s){this.bufferIndex=e,this.start=t,this.end=n,this.lineFeedCnt=i,this.length=s}}class je{constructor(e,t){this.buffer=e,this.lineStarts=t}}class Ln{constructor(e,t){this._pieces=[],this._tree=e,this._BOM=t,this._index=0,e.root!==Z&&e.iterate(e.root,n=>(n!==Z&&this._pieces.push(n.piece),!0))}read(){return this._pieces.length===0?this._index===0?(this._index++,this._BOM):null:this._index>this._pieces.length-1?null:this._index===0?this._BOM+this._tree.getPieceContent(this._pieces[this._index++]):this._tree.getPieceContent(this._pieces[this._index++])}}class kn{constructor(e){this._limit=e,this._cache=[]}get(e){for(let t=this._cache.length-1;t>=0;t--){const n=this._cache[t];if(n.nodeStartOffset<=e&&n.nodeStartOffset+n.node.piece.length>=e)return n}return null}get2(e){for(let t=this._cache.length-1;t>=0;t--){const n=this._cache[t];if(n.nodeStartLineNumber&&n.nodeStartLineNumber<e&&n.nodeStartLineNumber+n.node.piece.lineFeedCnt>=e)return n}return null}set(e){this._cache.length>=this._limit&&this._cache.shift(),this._cache.push(e)}validate(e){let t=!1;const n=this._cache;for(let i=0;i<n.length;i++){const s=n[i];if(s.node.parent===null||s.nodeStartOffset>=e){n[i]=null,t=!0;continue}}if(t){const i=[];for(const s of n)s!==null&&i.push(s);this._cache=i}}}class In{constructor(e,t,n){this.create(e,t,n)}create(e,t,n){this._buffers=[new je("",[0])],this._lastChangeBufferPos={line:0,column:0},this.root=Z,this._lineCnt=1,this._length=0,this._EOL=t,this._EOLLength=t.length,this._EOLNormalized=n;let i=null;for(let s=0,r=e.length;s<r;s++)if(e[s].buffer.length>0){e[s].lineStarts||(e[s].lineStarts=ze(e[s].buffer));const o=new Se(s+1,{line:0,column:0},{line:e[s].lineStarts.length-1,column:e[s].buffer.length-e[s].lineStarts[e[s].lineStarts.length-1]},e[s].lineStarts.length-1,e[s].buffer.length);this._buffers.push(e[s]),i=this.rbInsertRight(i,o)}this._searchCache=new kn(1),this._lastVisitedLine={lineNumber:0,value:""},this.computeBufferMetadata()}normalizeEOL(e){const t=Ae,n=t-Math.floor(t/3),i=n*2;let s="",r=0;const o=[];if(this.iterate(this.root,l=>{const g=this.getNodeContent(l),m=g.length;if(r<=n||r+m<i)return s+=g,r+=m,!0;const u=s.replace(/\r\n|\r|\n/g,e);return o.push(new je(u,ze(u))),s=g,r=m,!0}),r>0){const l=s.replace(/\r\n|\r|\n/g,e);o.push(new je(l,ze(l)))}this.create(o,e,!0)}getEOL(){return this._EOL}setEOL(e){this._EOL=e,this._EOLLength=this._EOL.length,this.normalizeEOL(e)}createSnapshot(e){return new Ln(this,e)}getOffsetAt(e,t){let n=0,i=this.root;for(;i!==Z;)if(i.left!==Z&&i.lf_left+1>=e)i=i.left;else if(i.lf_left+i.piece.lineFeedCnt+1>=e){n+=i.size_left;const s=this.getAccumulatedValue(i,e-i.lf_left-2);return n+=s+t-1}else e-=i.lf_left+i.piece.lineFeedCnt,n+=i.size_left+i.piece.length,i=i.right;return n}getPositionAt(e){e=Math.floor(e),e=Math.max(0,e);let t=this.root,n=0;const i=e;for(;t!==Z;)if(t.size_left!==0&&t.size_left>=e)t=t.left;else if(t.size_left+t.piece.length>=e){const s=this.getIndexOf(t,e-t.size_left);if(n+=t.lf_left+s.index,s.index===0){const r=this.getOffsetAt(n+1,1),o=i-r;return new b.y(n+1,o+1)}return new b.y(n+1,s.remainder+1)}else if(e-=t.size_left+t.piece.length,n+=t.lf_left+t.piece.lineFeedCnt,t.right===Z){const s=this.getOffsetAt(n+1,1),r=i-e-s;return new b.y(n+1,r+1)}else t=t.right;return new b.y(1,1)}getValueInRange(e,t){if(e.startLineNumber===e.endLineNumber&&e.startColumn===e.endColumn)return"";const n=this.nodeAt2(e.startLineNumber,e.startColumn),i=this.nodeAt2(e.endLineNumber,e.endColumn),s=this.getValueInRange2(n,i);return t?t!==this._EOL||!this._EOLNormalized?s.replace(/\r\n|\r|\n/g,t):t===this.getEOL()&&this._EOLNormalized?s:s.replace(/\r\n|\r|\n/g,t):s}getValueInRange2(e,t){if(e.node===t.node){const o=e.node,l=this._buffers[o.piece.bufferIndex].buffer,g=this.offsetInBuffer(o.piece.bufferIndex,o.piece.start);return l.substring(g+e.remainder,g+t.remainder)}let n=e.node;const i=this._buffers[n.piece.bufferIndex].buffer,s=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);let r=i.substring(s+e.remainder,s+n.piece.length);for(n=n.next();n!==Z;){const o=this._buffers[n.piece.bufferIndex].buffer,l=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(n===t.node){r+=o.substring(l,l+t.remainder);break}else r+=o.substr(l,n.piece.length);n=n.next()}return r}getLinesContent(){const e=[];let t=0,n="",i=!1;return this.iterate(this.root,s=>{if(s===Z)return!0;const r=s.piece;let o=r.length;if(o===0)return!0;const l=this._buffers[r.bufferIndex].buffer,g=this._buffers[r.bufferIndex].lineStarts,m=r.start.line,u=r.end.line;let k=g[m]+r.start.column;if(i&&(l.charCodeAt(k)===10&&(k++,o--),e[t++]=n,n="",i=!1,o===0))return!0;if(m===u)return!this._EOLNormalized&&l.charCodeAt(k+o-1)===13?(i=!0,n+=l.substr(k,o-1)):n+=l.substr(k,o),!0;n+=this._EOLNormalized?l.substring(k,Math.max(k,g[m+1]-this._EOLLength)):l.substring(k,g[m+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=n;for(let O=m+1;O<u;O++)n=this._EOLNormalized?l.substring(g[O],g[O+1]-this._EOLLength):l.substring(g[O],g[O+1]).replace(/(\r\n|\r|\n)$/,""),e[t++]=n;return!this._EOLNormalized&&l.charCodeAt(g[u]+r.end.column-1)===13?(i=!0,r.end.column===0?t--:n=l.substr(g[u],r.end.column-1)):n=l.substr(g[u],r.end.column),!0}),i&&(e[t++]=n,n=""),e[t++]=n,e}getLength(){return this._length}getLineCount(){return this._lineCnt}getLineContent(e){return this._lastVisitedLine.lineNumber===e?this._lastVisitedLine.value:(this._lastVisitedLine.lineNumber=e,e===this._lineCnt?this._lastVisitedLine.value=this.getLineRawContent(e):this._EOLNormalized?this._lastVisitedLine.value=this.getLineRawContent(e,this._EOLLength):this._lastVisitedLine.value=this.getLineRawContent(e).replace(/(\r\n|\r|\n)$/,""),this._lastVisitedLine.value)}_getCharCode(e){if(e.remainder===e.node.piece.length){const t=e.node.next();if(!t)return 0;const n=this._buffers[t.piece.bufferIndex],i=this.offsetInBuffer(t.piece.bufferIndex,t.piece.start);return n.buffer.charCodeAt(i)}else{const t=this._buffers[e.node.piece.bufferIndex],i=this.offsetInBuffer(e.node.piece.bufferIndex,e.node.piece.start)+e.remainder;return t.buffer.charCodeAt(i)}}getLineCharCode(e,t){const n=this.nodeAt2(e,t+1);return this._getCharCode(n)}getLineLength(e){if(e===this.getLineCount()){const t=this.getOffsetAt(e,1);return this.getLength()-t}return this.getOffsetAt(e+1,1)-this.getOffsetAt(e,1)-this._EOLLength}findMatchesInNode(e,t,n,i,s,r,o,l,g,m,u){const k=this._buffers[e.piece.bufferIndex],O=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start),N=this.offsetInBuffer(e.piece.bufferIndex,s),F=this.offsetInBuffer(e.piece.bufferIndex,r);let U;const Q={line:0,column:0};let q,re;t._wordSeparators?(q=k.buffer.substring(N,F),re=pe=>pe+N,t.reset(0)):(q=k.buffer,re=pe=>pe,t.reset(N));do if(U=t.next(q),U){if(re(U.index)>=F)return m;this.positionInBuffer(e,re(U.index)-O,Q);const pe=this.getLineFeedCnt(e.piece.bufferIndex,s,Q),ke=Q.line===s.line?Q.column-s.column+i:Q.column+1,be=ke+U[0].length;if(u[m++]=(0,ve.dr)(new p.Q(n+pe,ke,n+pe,be),U,l),re(U.index)+U[0].length>=F||m>=g)return m}while(U);return m}findMatchesLineByLine(e,t,n,i){const s=[];let r=0;const o=new ve.W5(t.wordSeparators,t.regex);let l=this.nodeAt2(e.startLineNumber,e.startColumn);if(l===null)return[];const g=this.nodeAt2(e.endLineNumber,e.endColumn);if(g===null)return[];let m=this.positionInBuffer(l.node,l.remainder);const u=this.positionInBuffer(g.node,g.remainder);if(l.node===g.node)return this.findMatchesInNode(l.node,o,e.startLineNumber,e.startColumn,m,u,t,n,i,r,s),s;let k=e.startLineNumber,O=l.node;for(;O!==g.node;){const F=this.getLineFeedCnt(O.piece.bufferIndex,m,O.piece.end);if(F>=1){const Q=this._buffers[O.piece.bufferIndex].lineStarts,q=this.offsetInBuffer(O.piece.bufferIndex,O.piece.start),re=Q[m.line+F],pe=k===e.startLineNumber?e.startColumn:1;if(r=this.findMatchesInNode(O,o,k,pe,m,this.positionInBuffer(O,re-q),t,n,i,r,s),r>=i)return s;k+=F}const U=k===e.startLineNumber?e.startColumn-1:0;if(k===e.endLineNumber){const Q=this.getLineContent(k).substring(U,e.endColumn-1);return r=this._findMatchesInLine(t,o,Q,e.endLineNumber,U,r,s,n,i),s}if(r=this._findMatchesInLine(t,o,this.getLineContent(k).substr(U),k,U,r,s,n,i),r>=i)return s;k++,l=this.nodeAt2(k,1),O=l.node,m=this.positionInBuffer(l.node,l.remainder)}if(k===e.endLineNumber){const F=k===e.startLineNumber?e.startColumn-1:0,U=this.getLineContent(k).substring(F,e.endColumn-1);return r=this._findMatchesInLine(t,o,U,e.endLineNumber,F,r,s,n,i),s}const N=k===e.startLineNumber?e.startColumn:1;return r=this.findMatchesInNode(g.node,o,k,N,m,u,t,n,i,r,s),s}_findMatchesInLine(e,t,n,i,s,r,o,l,g){const m=e.wordSeparators;if(!l&&e.simpleSearch){const k=e.simpleSearch,O=k.length,N=n.length;let F=-O;for(;(F=n.indexOf(k,F+O))!==-1;)if((!m||(0,ve.wC)(m,n,N,F,O))&&(o[r++]=new _.Dg(new p.Q(i,F+1+s,i,F+1+O+s),null),r>=g))return r;return r}let u;t.reset(0);do if(u=t.next(n),u&&(o[r++]=(0,ve.dr)(new p.Q(i,u.index+1+s,i,u.index+1+u[0].length+s),u,l),r>=g))return r;while(u);return r}insert(e,t,n=!1){if(this._EOLNormalized=this._EOLNormalized&&n,this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",this.root!==Z){const{node:i,remainder:s,nodeStartOffset:r}=this.nodeAt(e),o=i.piece,l=o.bufferIndex,g=this.positionInBuffer(i,s);if(i.piece.bufferIndex===0&&o.end.line===this._lastChangeBufferPos.line&&o.end.column===this._lastChangeBufferPos.column&&r+o.length===e&&t.length<Ae){this.appendToNode(i,t),this.computeBufferMetadata();return}if(r===e)this.insertContentToNodeLeft(t,i),this._searchCache.validate(e);else if(r+i.piece.length>e){const m=[];let u=new Se(o.bufferIndex,g,o.end,this.getLineFeedCnt(o.bufferIndex,g,o.end),this.offsetInBuffer(l,o.end)-this.offsetInBuffer(l,g));if(this.shouldCheckCRLF()&&this.endWithCR(t)&&this.nodeCharCodeAt(i,s)===10){const F={line:u.start.line+1,column:0};u=new Se(u.bufferIndex,F,u.end,this.getLineFeedCnt(u.bufferIndex,F,u.end),u.length-1),t+=`
`}if(this.shouldCheckCRLF()&&this.startWithLF(t))if(this.nodeCharCodeAt(i,s-1)===13){const F=this.positionInBuffer(i,s-1);this.deleteNodeTail(i,F),t="\r"+t,i.piece.length===0&&m.push(i)}else this.deleteNodeTail(i,g);else this.deleteNodeTail(i,g);const k=this.createNewPieces(t);u.length>0&&this.rbInsertRight(i,u);let O=i;for(let N=0;N<k.length;N++)O=this.rbInsertRight(O,k[N]);this.deleteNodes(m)}else this.insertContentToNodeRight(t,i)}else{const i=this.createNewPieces(t);let s=this.rbInsertLeft(null,i[0]);for(let r=1;r<i.length;r++)s=this.rbInsertRight(s,i[r])}this.computeBufferMetadata()}delete(e,t){if(this._lastVisitedLine.lineNumber=0,this._lastVisitedLine.value="",t<=0||this.root===Z)return;const n=this.nodeAt(e),i=this.nodeAt(e+t),s=n.node,r=i.node;if(s===r){const k=this.positionInBuffer(s,n.remainder),O=this.positionInBuffer(s,i.remainder);if(n.nodeStartOffset===e){if(t===s.piece.length){const N=s.next();at(this,s),this.validateCRLFWithPrevNode(N),this.computeBufferMetadata();return}this.deleteNodeHead(s,O),this._searchCache.validate(e),this.validateCRLFWithPrevNode(s),this.computeBufferMetadata();return}if(n.nodeStartOffset+s.piece.length===e+t){this.deleteNodeTail(s,k),this.validateCRLFWithNextNode(s),this.computeBufferMetadata();return}this.shrinkNode(s,k,O),this.computeBufferMetadata();return}const o=[],l=this.positionInBuffer(s,n.remainder);this.deleteNodeTail(s,l),this._searchCache.validate(e),s.piece.length===0&&o.push(s);const g=this.positionInBuffer(r,i.remainder);this.deleteNodeHead(r,g),r.piece.length===0&&o.push(r);const m=s.next();for(let k=m;k!==Z&&k!==r;k=k.next())o.push(k);const u=s.piece.length===0?s.prev():s;this.deleteNodes(o),this.validateCRLFWithNextNode(u),this.computeBufferMetadata()}insertContentToNodeLeft(e,t){const n=[];if(this.shouldCheckCRLF()&&this.endWithCR(e)&&this.startWithLF(t)){const r=t.piece,o={line:r.start.line+1,column:0},l=new Se(r.bufferIndex,o,r.end,this.getLineFeedCnt(r.bufferIndex,o,r.end),r.length-1);t.piece=l,e+=`
`,Pe(this,t,-1,-1),t.piece.length===0&&n.push(t)}const i=this.createNewPieces(e);let s=this.rbInsertLeft(t,i[i.length-1]);for(let r=i.length-2;r>=0;r--)s=this.rbInsertLeft(s,i[r]);this.validateCRLFWithPrevNode(s),this.deleteNodes(n)}insertContentToNodeRight(e,t){this.adjustCarriageReturnFromNext(e,t)&&(e+=`
`);const n=this.createNewPieces(e),i=this.rbInsertRight(t,n[0]);let s=i;for(let r=1;r<n.length;r++)s=this.rbInsertRight(s,n[r]);this.validateCRLFWithPrevNode(i)}positionInBuffer(e,t,n){const i=e.piece,s=e.piece.bufferIndex,r=this._buffers[s].lineStarts,l=r[i.start.line]+i.start.column+t;let g=i.start.line,m=i.end.line,u=0,k=0,O=0;for(;g<=m&&(u=g+(m-g)/2|0,O=r[u],u!==m);)if(k=r[u+1],l<O)m=u-1;else if(l>=k)g=u+1;else break;return n?(n.line=u,n.column=l-O,null):{line:u,column:l-O}}getLineFeedCnt(e,t,n){if(n.column===0)return n.line-t.line;const i=this._buffers[e].lineStarts;if(n.line===i.length-1)return n.line-t.line;const s=i[n.line+1],r=i[n.line]+n.column;if(s>r+1)return n.line-t.line;const o=r-1;return this._buffers[e].buffer.charCodeAt(o)===13?n.line-t.line+1:n.line-t.line}offsetInBuffer(e,t){return this._buffers[e].lineStarts[t.line]+t.column}deleteNodes(e){for(let t=0;t<e.length;t++)at(this,e[t])}createNewPieces(e){if(e.length>Ae){const m=[];for(;e.length>Ae;){const k=e.charCodeAt(Ae-1);let O;k===13||k>=55296&&k<=56319?(O=e.substring(0,Ae-1),e=e.substring(Ae-1)):(O=e.substring(0,Ae),e=e.substring(Ae));const N=ze(O);m.push(new Se(this._buffers.length,{line:0,column:0},{line:N.length-1,column:O.length-N[N.length-1]},N.length-1,O.length)),this._buffers.push(new je(O,N))}const u=ze(e);return m.push(new Se(this._buffers.length,{line:0,column:0},{line:u.length-1,column:e.length-u[u.length-1]},u.length-1,e.length)),this._buffers.push(new je(e,u)),m}let t=this._buffers[0].buffer.length;const n=ze(e,!1);let i=this._lastChangeBufferPos;if(this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-1]===t&&t!==0&&this.startWithLF(e)&&this.endWithCR(this._buffers[0].buffer)){this._lastChangeBufferPos={line:this._lastChangeBufferPos.line,column:this._lastChangeBufferPos.column+1},i=this._lastChangeBufferPos;for(let m=0;m<n.length;m++)n[m]+=t+1;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+="_"+e,t+=1}else{if(t!==0)for(let m=0;m<n.length;m++)n[m]+=t;this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(n.slice(1)),this._buffers[0].buffer+=e}const s=this._buffers[0].buffer.length,r=this._buffers[0].lineStarts.length-1,o=s-this._buffers[0].lineStarts[r],l={line:r,column:o},g=new Se(0,i,l,this.getLineFeedCnt(0,i,l),s-t);return this._lastChangeBufferPos=l,[g]}getLineRawContent(e,t=0){let n=this.root,i="";const s=this._searchCache.get2(e);if(s){n=s.node;const r=this.getAccumulatedValue(n,e-s.nodeStartLineNumber-1),o=this._buffers[n.piece.bufferIndex].buffer,l=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);if(s.nodeStartLineNumber+n.piece.lineFeedCnt===e)i=o.substring(l+r,l+n.piece.length);else{const g=this.getAccumulatedValue(n,e-s.nodeStartLineNumber);return o.substring(l+r,l+g-t)}}else{let r=0;const o=e;for(;n!==Z;)if(n.left!==Z&&n.lf_left>=e-1)n=n.left;else if(n.lf_left+n.piece.lineFeedCnt>e-1){const l=this.getAccumulatedValue(n,e-n.lf_left-2),g=this.getAccumulatedValue(n,e-n.lf_left-1),m=this._buffers[n.piece.bufferIndex].buffer,u=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return r+=n.size_left,this._searchCache.set({node:n,nodeStartOffset:r,nodeStartLineNumber:o-(e-1-n.lf_left)}),m.substring(u+l,u+g-t)}else if(n.lf_left+n.piece.lineFeedCnt===e-1){const l=this.getAccumulatedValue(n,e-n.lf_left-2),g=this._buffers[n.piece.bufferIndex].buffer,m=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i=g.substring(m+l,m+n.piece.length);break}else e-=n.lf_left+n.piece.lineFeedCnt,r+=n.size_left+n.piece.length,n=n.right}for(n=n.next();n!==Z;){const r=this._buffers[n.piece.bufferIndex].buffer;if(n.piece.lineFeedCnt>0){const o=this.getAccumulatedValue(n,0),l=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);return i+=r.substring(l,l+o-t),i}else{const o=this.offsetInBuffer(n.piece.bufferIndex,n.piece.start);i+=r.substr(o,n.piece.length)}n=n.next()}return i}computeBufferMetadata(){let e=this.root,t=1,n=0;for(;e!==Z;)t+=e.lf_left+e.piece.lineFeedCnt,n+=e.size_left+e.piece.length,e=e.right;this._lineCnt=t,this._length=n,this._searchCache.validate(this._length)}getIndexOf(e,t){const n=e.piece,i=this.positionInBuffer(e,t),s=i.line-n.start.line;if(this.offsetInBuffer(n.bufferIndex,n.end)-this.offsetInBuffer(n.bufferIndex,n.start)===t){const r=this.getLineFeedCnt(e.piece.bufferIndex,n.start,i);if(r!==s)return{index:r,remainder:0}}return{index:s,remainder:i.column}}getAccumulatedValue(e,t){if(t<0)return 0;const n=e.piece,i=this._buffers[n.bufferIndex].lineStarts,s=n.start.line+t+1;return s>n.end.line?i[n.end.line]+n.end.column-i[n.start.line]-n.start.column:i[s]-i[n.start.line]-n.start.column}deleteNodeTail(e,t){const n=e.piece,i=n.lineFeedCnt,s=this.offsetInBuffer(n.bufferIndex,n.end),r=t,o=this.offsetInBuffer(n.bufferIndex,r),l=this.getLineFeedCnt(n.bufferIndex,n.start,r),g=l-i,m=o-s,u=n.length+m;e.piece=new Se(n.bufferIndex,n.start,r,l,u),Pe(this,e,m,g)}deleteNodeHead(e,t){const n=e.piece,i=n.lineFeedCnt,s=this.offsetInBuffer(n.bufferIndex,n.start),r=t,o=this.getLineFeedCnt(n.bufferIndex,r,n.end),l=this.offsetInBuffer(n.bufferIndex,r),g=o-i,m=s-l,u=n.length+m;e.piece=new Se(n.bufferIndex,r,n.end,o,u),Pe(this,e,m,g)}shrinkNode(e,t,n){const i=e.piece,s=i.start,r=i.end,o=i.length,l=i.lineFeedCnt,g=t,m=this.getLineFeedCnt(i.bufferIndex,i.start,g),u=this.offsetInBuffer(i.bufferIndex,t)-this.offsetInBuffer(i.bufferIndex,s);e.piece=new Se(i.bufferIndex,i.start,g,m,u),Pe(this,e,u-o,m-l);const k=new Se(i.bufferIndex,n,r,this.getLineFeedCnt(i.bufferIndex,n,r),this.offsetInBuffer(i.bufferIndex,r)-this.offsetInBuffer(i.bufferIndex,n)),O=this.rbInsertRight(e,k);this.validateCRLFWithPrevNode(O)}appendToNode(e,t){this.adjustCarriageReturnFromNext(t,e)&&(t+=`
`);const n=this.shouldCheckCRLF()&&this.startWithLF(t)&&this.endWithCR(e),i=this._buffers[0].buffer.length;this._buffers[0].buffer+=t;const s=ze(t,!1);for(let O=0;O<s.length;O++)s[O]+=i;if(n){const O=this._buffers[0].lineStarts[this._buffers[0].lineStarts.length-2];this._buffers[0].lineStarts.pop(),this._lastChangeBufferPos={line:this._lastChangeBufferPos.line-1,column:i-O}}this._buffers[0].lineStarts=this._buffers[0].lineStarts.concat(s.slice(1));const r=this._buffers[0].lineStarts.length-1,o=this._buffers[0].buffer.length-this._buffers[0].lineStarts[r],l={line:r,column:o},g=e.piece.length+t.length,m=e.piece.lineFeedCnt,u=this.getLineFeedCnt(0,e.piece.start,l),k=u-m;e.piece=new Se(e.piece.bufferIndex,e.piece.start,l,u,g),this._lastChangeBufferPos=l,Pe(this,e,t.length,k)}nodeAt(e){let t=this.root;const n=this._searchCache.get(e);if(n)return{node:n.node,nodeStartOffset:n.nodeStartOffset,remainder:e-n.nodeStartOffset};let i=0;for(;t!==Z;)if(t.size_left>e)t=t.left;else if(t.size_left+t.piece.length>=e){i+=t.size_left;const s={node:t,remainder:e-t.size_left,nodeStartOffset:i};return this._searchCache.set(s),s}else e-=t.size_left+t.piece.length,i+=t.size_left+t.piece.length,t=t.right;return null}nodeAt2(e,t){let n=this.root,i=0;for(;n!==Z;)if(n.left!==Z&&n.lf_left>=e-1)n=n.left;else if(n.lf_left+n.piece.lineFeedCnt>e-1){const s=this.getAccumulatedValue(n,e-n.lf_left-2),r=this.getAccumulatedValue(n,e-n.lf_left-1);return i+=n.size_left,{node:n,remainder:Math.min(s+t-1,r),nodeStartOffset:i}}else if(n.lf_left+n.piece.lineFeedCnt===e-1){const s=this.getAccumulatedValue(n,e-n.lf_left-2);if(s+t-1<=n.piece.length)return{node:n,remainder:s+t-1,nodeStartOffset:i};t-=n.piece.length-s;break}else e-=n.lf_left+n.piece.lineFeedCnt,i+=n.size_left+n.piece.length,n=n.right;for(n=n.next();n!==Z;){if(n.piece.lineFeedCnt>0){const s=this.getAccumulatedValue(n,0),r=this.offsetOfNode(n);return{node:n,remainder:Math.min(t-1,s),nodeStartOffset:r}}else if(n.piece.length>=t-1){const s=this.offsetOfNode(n);return{node:n,remainder:t-1,nodeStartOffset:s}}else t-=n.piece.length;n=n.next()}return null}nodeCharCodeAt(e,t){if(e.piece.lineFeedCnt<1)return-1;const n=this._buffers[e.piece.bufferIndex],i=this.offsetInBuffer(e.piece.bufferIndex,e.piece.start)+t;return n.buffer.charCodeAt(i)}offsetOfNode(e){if(!e)return 0;let t=e.size_left;for(;e!==this.root;)e.parent.right===e&&(t+=e.parent.size_left+e.parent.piece.length),e=e.parent;return t}shouldCheckCRLF(){return!(this._EOLNormalized&&this._EOL===`
`)}startWithLF(e){if(typeof e=="string")return e.charCodeAt(0)===10;if(e===Z||e.piece.lineFeedCnt===0)return!1;const t=e.piece,n=this._buffers[t.bufferIndex].lineStarts,i=t.start.line,s=n[i]+t.start.column;return i===n.length-1||n[i+1]>s+1?!1:this._buffers[t.bufferIndex].buffer.charCodeAt(s)===10}endWithCR(e){return typeof e=="string"?e.charCodeAt(e.length-1)===13:e===Z||e.piece.lineFeedCnt===0?!1:this.nodeCharCodeAt(e,e.piece.length-1)===13}validateCRLFWithPrevNode(e){if(this.shouldCheckCRLF()&&this.startWithLF(e)){const t=e.prev();this.endWithCR(t)&&this.fixCRLF(t,e)}}validateCRLFWithNextNode(e){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const t=e.next();this.startWithLF(t)&&this.fixCRLF(e,t)}}fixCRLF(e,t){const n=[],i=this._buffers[e.piece.bufferIndex].lineStarts;let s;e.piece.end.column===0?s={line:e.piece.end.line-1,column:i[e.piece.end.line]-i[e.piece.end.line-1]-1}:s={line:e.piece.end.line,column:e.piece.end.column-1};const r=e.piece.length-1,o=e.piece.lineFeedCnt-1;e.piece=new Se(e.piece.bufferIndex,e.piece.start,s,o,r),Pe(this,e,-1,-1),e.piece.length===0&&n.push(e);const l={line:t.piece.start.line+1,column:0},g=t.piece.length-1,m=this.getLineFeedCnt(t.piece.bufferIndex,l,t.piece.end);t.piece=new Se(t.piece.bufferIndex,l,t.piece.end,m,g),Pe(this,t,-1,-1),t.piece.length===0&&n.push(t);const u=this.createNewPieces(`\r
`);this.rbInsertRight(e,u[0]);for(let k=0;k<n.length;k++)at(this,n[k])}adjustCarriageReturnFromNext(e,t){if(this.shouldCheckCRLF()&&this.endWithCR(e)){const n=t.next();if(this.startWithLF(n)){if(e+=`
`,n.piece.length===1)at(this,n);else{const i=n.piece,s={line:i.start.line+1,column:0},r=i.length-1,o=this.getLineFeedCnt(i.bufferIndex,s,i.end);n.piece=new Se(i.bufferIndex,s,i.end,o,r),Pe(this,n,-1,-1)}return!0}}return!1}iterate(e,t){if(e===Z)return t(Z);const n=this.iterate(e.left,t);return n&&t(e)&&this.iterate(e.right,t)}getNodeContent(e){if(e===Z)return"";const t=this._buffers[e.piece.bufferIndex],n=e.piece,i=this.offsetInBuffer(n.bufferIndex,n.start),s=this.offsetInBuffer(n.bufferIndex,n.end);return t.buffer.substring(i,s)}getPieceContent(e){const t=this._buffers[e.bufferIndex],n=this.offsetInBuffer(e.bufferIndex,e.start),i=this.offsetInBuffer(e.bufferIndex,e.end);return t.buffer.substring(n,i)}rbInsertRight(e,t){const n=new pt(t,1);if(n.left=Z,n.right=Z,n.parent=Z,n.size_left=0,n.lf_left=0,this.root===Z)this.root=n,n.color=0;else if(e.right===Z)e.right=n,n.parent=e;else{const s=mt(e.right);s.left=n,n.parent=s}return Vt(this,n),n}rbInsertLeft(e,t){const n=new pt(t,1);if(n.left=Z,n.right=Z,n.parent=Z,n.size_left=0,n.lf_left=0,this.root===Z)this.root=n,n.color=0;else if(e.left===Z)e.left=n,n.parent=e;else{const i=Ut(e.left);i.right=n,n.parent=i}return Vt(this,n),n}}var bn=T(16416);class Ge extends M.jG{constructor(e,t,n,i,s,r,o){super(),this._onDidChangeContent=this._register(new x.vl),this._BOM=t,this._mightContainNonBasicASCII=!r,this._mightContainRTL=i,this._mightContainUnusualLineTerminators=s,this._pieceTree=new In(e,n,o)}mightContainRTL(){return this._mightContainRTL}mightContainUnusualLineTerminators(){return this._mightContainUnusualLineTerminators}resetMightContainUnusualLineTerminators(){this._mightContainUnusualLineTerminators=!1}mightContainNonBasicASCII(){return this._mightContainNonBasicASCII}getBOM(){return this._BOM}getEOL(){return this._pieceTree.getEOL()}createSnapshot(e){return this._pieceTree.createSnapshot(e?this._BOM:"")}getOffsetAt(e,t){return this._pieceTree.getOffsetAt(e,t)}getPositionAt(e){return this._pieceTree.getPositionAt(e)}getRangeAt(e,t){const n=e+t,i=this.getPositionAt(e),s=this.getPositionAt(n);return new p.Q(i.lineNumber,i.column,s.lineNumber,s.column)}getValueInRange(e,t=0){if(e.isEmpty())return"";const n=this._getEndOfLine(t);return this._pieceTree.getValueInRange(e,n)}getValueLengthInRange(e,t=0){if(e.isEmpty())return 0;if(e.startLineNumber===e.endLineNumber)return e.endColumn-e.startColumn;const n=this.getOffsetAt(e.startLineNumber,e.startColumn),i=this.getOffsetAt(e.endLineNumber,e.endColumn);let s=0;const r=this._getEndOfLine(t),o=this.getEOL();if(r.length!==o.length){const l=r.length-o.length,g=e.endLineNumber-e.startLineNumber;s=l*g}return i-n+s}getCharacterCountInRange(e,t=0){if(this._mightContainNonBasicASCII){let n=0;const i=e.startLineNumber,s=e.endLineNumber;for(let r=i;r<=s;r++){const o=this.getLineContent(r),l=r===i?e.startColumn-1:0,g=r===s?e.endColumn-1:o.length;for(let m=l;m<g;m++)c.pc(o.charCodeAt(m))?(n=n+1,m=m+1):n=n+1}return n+=this._getEndOfLine(t).length*(s-i),n}return this.getValueLengthInRange(e,t)}getLength(){return this._pieceTree.getLength()}getLineCount(){return this._pieceTree.getLineCount()}getLinesContent(){return this._pieceTree.getLinesContent()}getLineContent(e){return this._pieceTree.getLineContent(e)}getLineCharCode(e,t){return this._pieceTree.getLineCharCode(e,t)}getLineLength(e){return this._pieceTree.getLineLength(e)}getLineFirstNonWhitespaceColumn(e){const t=c.HG(this.getLineContent(e));return t===-1?0:t+1}getLineLastNonWhitespaceColumn(e){const t=c.lT(this.getLineContent(e));return t===-1?0:t+2}_getEndOfLine(e){switch(e){case 1:return`
`;case 2:return`\r
`;case 0:return this.getEOL();default:throw new Error("Unknown EOL preference")}}setEOL(e){this._pieceTree.setEOL(e)}applyEdits(e,t,n){let i=this._mightContainRTL,s=this._mightContainUnusualLineTerminators,r=this._mightContainNonBasicASCII,o=!0,l=[];for(let F=0;F<e.length;F++){const U=e[F];o&&U._isTracked&&(o=!1);const Q=U.range;if(U.text){let be=!0;r||(be=!c.aC(U.text),r=be),!i&&be&&(i=c.E_(U.text)),!s&&be&&(s=c.$X(U.text))}let q="",re=0,pe=0,ke=0;if(U.text){let be;[re,pe,ke,be]=(0,d.W)(U.text);const Ee=this.getEOL();be===0||be===(Ee===`\r
`?2:1)?q=U.text:q=U.text.replace(/\r\n|\r|\n/g,Ee)}l[F]={sortIndex:F,identifier:U.identifier||null,range:Q,rangeOffset:this.getOffsetAt(Q.startLineNumber,Q.startColumn),rangeLength:this.getValueLengthInRange(Q),text:q,eolCount:re,firstLineLength:pe,lastLineLength:ke,forceMoveMarkers:!!U.forceMoveMarkers,isAutoWhitespaceEdit:U.isAutoWhitespaceEdit||!1}}l.sort(Ge._sortOpsAscending);let g=!1;for(let F=0,U=l.length-1;F<U;F++){const Q=l[F].range.getEndPosition(),q=l[F+1].range.getStartPosition();if(q.isBeforeOrEqual(Q)){if(q.isBefore(Q))throw new Error("Overlapping ranges are not allowed!");g=!0}}o&&(l=this._reduceOperations(l));const m=n||t?Ge._getInverseEditRanges(l):[],u=[];if(t)for(let F=0;F<l.length;F++){const U=l[F],Q=m[F];if(U.isAutoWhitespaceEdit&&U.range.isEmpty())for(let q=Q.startLineNumber;q<=Q.endLineNumber;q++){let re="";q===Q.startLineNumber&&(re=this.getLineContent(U.range.startLineNumber),c.HG(re)!==-1)||u.push({lineNumber:q,oldContent:re})}}let k=null;if(n){let F=0;k=[];for(let U=0;U<l.length;U++){const Q=l[U],q=m[U],re=this.getValueInRange(Q.range),pe=Q.rangeOffset+F;F+=Q.text.length-re.length,k[U]={sortIndex:Q.sortIndex,identifier:Q.identifier,range:q,text:re,textChange:new bn.k(Q.rangeOffset,re,pe,Q.text)}}g||k.sort((U,Q)=>U.sortIndex-Q.sortIndex)}this._mightContainRTL=i,this._mightContainUnusualLineTerminators=s,this._mightContainNonBasicASCII=r;const O=this._doApplyEdits(l);let N=null;if(t&&u.length>0){u.sort((F,U)=>U.lineNumber-F.lineNumber),N=[];for(let F=0,U=u.length;F<U;F++){const Q=u[F].lineNumber;if(F>0&&u[F-1].lineNumber===Q)continue;const q=u[F].oldContent,re=this.getLineContent(Q);re.length===0||re===q||c.HG(re)!==-1||N.push(Q)}}return this._onDidChangeContent.fire(),new _.F4(k,O,N)}_reduceOperations(e){return e.length<1e3?e:[this._toSingleEditOperation(e)]}_toSingleEditOperation(e){let t=!1;const n=e[0].range,i=e[e.length-1].range,s=new p.Q(n.startLineNumber,n.startColumn,i.endLineNumber,i.endColumn);let r=n.startLineNumber,o=n.startColumn;const l=[];for(let O=0,N=e.length;O<N;O++){const F=e[O],U=F.range;t=t||F.forceMoveMarkers,l.push(this.getValueInRange(new p.Q(r,o,U.startLineNumber,U.startColumn))),F.text.length>0&&l.push(F.text),r=U.endLineNumber,o=U.endColumn}const g=l.join(""),[m,u,k]=(0,d.W)(g);return{sortIndex:0,identifier:e[0].identifier,range:s,rangeOffset:this.getOffsetAt(s.startLineNumber,s.startColumn),rangeLength:this.getValueLengthInRange(s,0),text:g,eolCount:m,firstLineLength:u,lastLineLength:k,forceMoveMarkers:t,isAutoWhitespaceEdit:!1}}_doApplyEdits(e){e.sort(Ge._sortOpsDescending);const t=[];for(let n=0;n<e.length;n++){const i=e[n],s=i.range.startLineNumber,r=i.range.startColumn,o=i.range.endLineNumber,l=i.range.endColumn;if(s===o&&r===l&&i.text.length===0)continue;i.text?(this._pieceTree.delete(i.rangeOffset,i.rangeLength),this._pieceTree.insert(i.rangeOffset,i.text,!0)):this._pieceTree.delete(i.rangeOffset,i.rangeLength);const g=new p.Q(s,r,o,l);t.push({range:g,rangeLength:i.rangeLength,text:i.text,rangeOffset:i.rangeOffset,forceMoveMarkers:i.forceMoveMarkers})}return t}findMatchesLineByLine(e,t,n,i){return this._pieceTree.findMatchesLineByLine(e,t,n,i)}static _getInverseEditRanges(e){const t=[];let n=0,i=0,s=null;for(let r=0,o=e.length;r<o;r++){const l=e[r];let g,m;s?s.range.endLineNumber===l.range.startLineNumber?(g=n,m=i+(l.range.startColumn-s.range.endColumn)):(g=n+(l.range.startLineNumber-s.range.endLineNumber),m=l.range.startColumn):(g=l.range.startLineNumber,m=l.range.startColumn);let u;if(l.text.length>0){const k=l.eolCount+1;k===1?u=new p.Q(g,m,g,m+l.firstLineLength):u=new p.Q(g,m,g+k-1,l.lastLineLength+1)}else u=new p.Q(g,m,g,m);n=u.endLineNumber,i=u.endColumn,t.push(u),s=l}return t}static _sortOpsAscending(e,t){const n=p.Q.compareRangesUsingEnds(e.range,t.range);return n===0?e.sortIndex-t.sortIndex:n}static _sortOpsDescending(e,t){const n=p.Q.compareRangesUsingEnds(e.range,t.range);return n===0?t.sortIndex-e.sortIndex:-n}}class En{constructor(e,t,n,i,s,r,o,l,g){this._chunks=e,this._bom=t,this._cr=n,this._lf=i,this._crlf=s,this._containsRTL=r,this._containsUnusualLineTerminators=o,this._isBasicASCII=l,this._normalizeEOL=g}_getEOL(e){const t=this._cr+this._lf+this._crlf,n=this._cr+this._crlf;return t===0?e===1?`
`:`\r
`:n>t/2?`\r
`:`
`}create(e){const t=this._getEOL(e),n=this._chunks;if(this._normalizeEOL&&(t===`\r
`&&(this._cr>0||this._lf>0)||t===`
`&&(this._cr>0||this._crlf>0)))for(let s=0,r=n.length;s<r;s++){const o=n[s].buffer.replace(/\r\n|\r|\n/g,t),l=ze(o);n[s]=new je(o,l)}const i=new Ge(n,this._bom,t,this._containsRTL,this._containsUnusualLineTerminators,this._isBasicASCII,this._normalizeEOL);return{textBuffer:i,disposable:i}}}class Ht{constructor(){this.chunks=[],this.BOM="",this._hasPreviousChar=!1,this._previousChar=0,this._tmpLineStarts=[],this.cr=0,this.lf=0,this.crlf=0,this.containsRTL=!1,this.containsUnusualLineTerminators=!1,this.isBasicASCII=!0}acceptChunk(e){if(e.length===0)return;this.chunks.length===0&&c.LU(e)&&(this.BOM=c.r_,e=e.substr(1));const t=e.charCodeAt(e.length-1);t===13||t>=55296&&t<=56319?(this._acceptChunk1(e.substr(0,e.length-1),!1),this._hasPreviousChar=!0,this._previousChar=t):(this._acceptChunk1(e,!1),this._hasPreviousChar=!1,this._previousChar=t)}_acceptChunk1(e,t){!t&&e.length===0||(this._hasPreviousChar?this._acceptChunk2(String.fromCharCode(this._previousChar)+e):this._acceptChunk2(e))}_acceptChunk2(e){const t=Cn(this._tmpLineStarts,e);this.chunks.push(new je(e,t.lineStarts)),this.cr+=t.cr,this.lf+=t.lf,this.crlf+=t.crlf,t.isBasicASCII||(this.isBasicASCII=!1,this.containsRTL||(this.containsRTL=c.E_(e)),this.containsUnusualLineTerminators||(this.containsUnusualLineTerminators=c.$X(e)))}finish(e=!0){return this._finish(),new En(this.chunks,this.BOM,this.cr,this.lf,this.crlf,this.containsRTL,this.containsUnusualLineTerminators,this.isBasicASCII,e)}_finish(){if(this.chunks.length===0&&this._acceptChunk1("",!0),this._hasPreviousChar){this._hasPreviousChar=!1;const e=this.chunks[this.chunks.length-1];e.buffer+=String.fromCharCode(this._previousChar);const t=ze(e.buffer);e.lineStarts=t,this._previousChar===13&&this.cr++}}}var lt=T(33924),Kt=T(5751),tt=T(9709),Tn=T(52216),Gt=T(37519),Sn=T(90692),vn=T(4156),Be=T(88935),xn=T(32287);class On{constructor(e){this._default=e,this._store=[]}get(e){return e<this._store.length?this._store[e]:this._default}set(e,t){for(;e>=this._store.length;)this._store[this._store.length]=this._default;this._store[e]=t}replace(e,t,n){if(e>=this._store.length)return;if(t===0){this.insert(e,n);return}else if(n===0){this.delete(e,t);return}const i=this._store.slice(0,e),s=this._store.slice(e+t),r=wn(n,this._default);this._store=i.concat(r,s)}delete(e,t){t===0||e>=this._store.length||this._store.splice(e,t)}insert(e,t){if(t===0||e>=this._store.length)return;const n=[];for(let i=0;i<t;i++)n[i]=this._default;this._store=(0,V.nK)(this._store,e,n)}}function wn(a,e){const t=[];for(let n=0;n<a;n++)t[n]=e;return t}class Bn{get startLineNumber(){return this._startLineNumber}get endLineNumber(){return this._startLineNumber+this._tokens.length-1}constructor(e,t){this._startLineNumber=e,this._tokens=t}getLineTokens(e){return this._tokens[e-this._startLineNumber]}appendLineTokens(e){this._tokens.push(e)}}class It{constructor(){this._tokens=[]}add(e,t){if(this._tokens.length>0){const n=this._tokens[this._tokens.length-1];if(n.endLineNumber+1===e){n.appendLineTokens(t);return}}this._tokens.push(new Bn(e,[t]))}finalize(){return this._tokens}}var Me=T(14216);class Mn{constructor(e,t){this.tokenizationSupport=t,this.initialState=this.tokenizationSupport.getInitialState(),this.store=new bt(e)}getStartState(e){return this.store.getStartState(e,this.initialState)}getFirstInvalidLine(){return this.store.getFirstInvalidLine(this.initialState)}}class Dn extends Mn{constructor(e,t,n,i){super(e,t),this._textModel=n,this._languageIdCodec=i}updateTokensUntilLine(e,t){const n=this._textModel.getLanguageId();for(;;){const i=this.getFirstInvalidLine();if(!i||i.lineNumber>t)break;const s=this._textModel.getLineContent(i.lineNumber),r=nt(this._languageIdCodec,n,this.tokenizationSupport,s,!0,i.startState);e.add(i.lineNumber,r.tokens),this.store.setEndState(i.lineNumber,r.endState)}}getTokenTypeIfInsertingCharacter(e,t){const n=this.getStartState(e.lineNumber);if(!n)return 0;const i=this._textModel.getLanguageId(),s=this._textModel.getLineContent(e.lineNumber),r=s.substring(0,e.column-1)+t+s.substring(e.column-1),o=nt(this._languageIdCodec,i,this.tokenizationSupport,r,!0,n),l=new Me.f(o.tokens,r,this._languageIdCodec);if(l.getCount()===0)return 0;const g=l.findTokenIndexAtOffset(e.column-1);return l.getStandardTokenType(g)}tokenizeLineWithEdit(e,t,n){const i=e.lineNumber,s=e.column,r=this.getStartState(i);if(!r)return null;const o=this._textModel.getLineContent(i),l=o.substring(0,s-1)+n+o.substring(s-1+t),g=this._textModel.getLanguageIdAtPosition(i,0),m=nt(this._languageIdCodec,g,this.tokenizationSupport,l,!0,r);return new Me.f(m.tokens,l,this._languageIdCodec)}hasAccurateTokensForLine(e){const t=this.store.getFirstInvalidEndStateLineNumberOrMax();return e<t}isCheapToTokenize(e){const t=this.store.getFirstInvalidEndStateLineNumberOrMax();return e<t||e===t&&this._textModel.getLineLength(e)<2048}tokenizeHeuristically(e,t,n){if(n<=this.store.getFirstInvalidEndStateLineNumberOrMax())return{heuristicTokens:!1};if(t<=this.store.getFirstInvalidEndStateLineNumberOrMax())return this.updateTokensUntilLine(e,n),{heuristicTokens:!1};let i=this.guessStartState(t);const s=this._textModel.getLanguageId();for(let r=t;r<=n;r++){const o=this._textModel.getLineContent(r),l=nt(this._languageIdCodec,s,this.tokenizationSupport,o,!0,i);e.add(r,l.tokens),i=l.endState}return{heuristicTokens:!0}}guessStartState(e){let t=this._textModel.getLineFirstNonWhitespaceColumn(e);const n=[];let i=null;for(let o=e-1;t>1&&o>=1;o--){const l=this._textModel.getLineFirstNonWhitespaceColumn(o);if(l!==0&&l<t&&(n.push(this._textModel.getLineContent(o)),t=l,i=this.getStartState(o),i))break}i||(i=this.tokenizationSupport.getInitialState()),n.reverse();const s=this._textModel.getLanguageId();let r=i;for(const o of n)r=nt(this._languageIdCodec,s,this.tokenizationSupport,o,!1,r).endState;return r}}class bt{constructor(e){this.lineCount=e,this._tokenizationStateStore=new Rn,this._invalidEndStatesLineNumbers=new Nn,this._invalidEndStatesLineNumbers.addRange(new Be.L(1,e+1))}getEndState(e){return this._tokenizationStateStore.getEndState(e)}setEndState(e,t){if(!t)throw new j.D7("Cannot set null/undefined state");this._invalidEndStatesLineNumbers.delete(e);const n=this._tokenizationStateStore.setEndState(e,t);return n&&e<this.lineCount&&this._invalidEndStatesLineNumbers.addRange(new Be.L(e+1,e+2)),n}acceptChange(e,t){this.lineCount+=t-e.length,this._tokenizationStateStore.acceptChange(e,t),this._invalidEndStatesLineNumbers.addRangeAndResize(new Be.L(e.startLineNumber,e.endLineNumberExclusive),t)}acceptChanges(e){for(const t of e){const[n]=(0,d.W)(t.text);this.acceptChange(new lt.M(t.range.startLineNumber,t.range.endLineNumber+1),n+1)}}invalidateEndStateRange(e){this._invalidEndStatesLineNumbers.addRange(new Be.L(e.startLineNumber,e.endLineNumberExclusive))}getFirstInvalidEndStateLineNumber(){return this._invalidEndStatesLineNumbers.min}getFirstInvalidEndStateLineNumberOrMax(){return this.getFirstInvalidEndStateLineNumber()||Number.MAX_SAFE_INTEGER}allStatesValid(){return this._invalidEndStatesLineNumbers.min===null}getStartState(e,t){return e===1?t:this.getEndState(e-1)}getFirstInvalidLine(e){const t=this.getFirstInvalidEndStateLineNumber();if(t===null)return null;const n=this.getStartState(t,e);if(!n)throw new j.D7("Start state must be defined");return{lineNumber:t,startState:n}}}class Rn{constructor(){this._lineEndStates=new On(null)}getEndState(e){return this._lineEndStates.get(e)}setEndState(e,t){const n=this._lineEndStates.get(e);return n&&n.equals(t)?!1:(this._lineEndStates.set(e,t),!0)}acceptChange(e,t){let n=e.length;t>0&&n>0&&(n--,t--),this._lineEndStates.replace(e.startLineNumber,n,t)}}class Nn{constructor(){this._ranges=[]}get min(){return this._ranges.length===0?null:this._ranges[0].start}delete(e){const t=this._ranges.findIndex(n=>n.contains(e));if(t!==-1){const n=this._ranges[t];n.start===e?n.endExclusive===e+1?this._ranges.splice(t,1):this._ranges[t]=new Be.L(e+1,n.endExclusive):n.endExclusive===e+1?this._ranges[t]=new Be.L(n.start,e):this._ranges.splice(t,1,new Be.L(n.start,e),new Be.L(e+1,n.endExclusive))}}addRange(e){Be.L.addRange(e,this._ranges)}addRangeAndResize(e,t){let n=0;for(;!(n>=this._ranges.length||e.start<=this._ranges[n].endExclusive);)n++;let i=n;for(;!(i>=this._ranges.length||e.endExclusive<this._ranges[i].start);)i++;const s=t-e.length;for(let r=i;r<this._ranges.length;r++)this._ranges[r]=this._ranges[r].delta(s);if(n===i){const r=new Be.L(e.start,e.start+t);r.isEmpty||this._ranges.splice(n,0,r)}else{const r=Math.min(e.start,this._ranges[n].start),o=Math.max(e.endExclusive,this._ranges[i-1].endExclusive),l=new Be.L(r,o+s);l.isEmpty?this._ranges.splice(n,i-n):this._ranges.splice(n,i-n,l)}}toString(){return this._ranges.map(e=>e.toString()).join(" + ")}}function nt(a,e,t,n,i,s){let r=null;if(t)try{r=t.tokenizeEncoded(n,i,s.clone())}catch(o){(0,j.dz)(o)}return r||(r=(0,xn.Lh)(a.encodeLanguageId(e),s)),Me.f.convertToEndOffset(r.tokens,n.length),r}class Pn{constructor(e,t){this._tokenizerWithStateStore=e,this._backgroundTokenStore=t,this._isDisposed=!1,this._isScheduled=!1}dispose(){this._isDisposed=!0}handleChanges(){this._beginBackgroundTokenization()}_beginBackgroundTokenization(){this._isScheduled||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._isScheduled=!0,(0,Gt.$6)(e=>{this._isScheduled=!1,this._backgroundTokenizeWithDeadline(e)}))}_backgroundTokenizeWithDeadline(e){const t=Date.now()+e.timeRemaining(),n=()=>{this._isDisposed||!this._tokenizerWithStateStore._textModel.isAttachedToEditor()||!this._hasLinesToTokenize()||(this._backgroundTokenizeForAtLeast1ms(),Date.now()<t?(0,Sn._p)(n):this._beginBackgroundTokenization())};n()}_backgroundTokenizeForAtLeast1ms(){const e=this._tokenizerWithStateStore._textModel.getLineCount(),t=new It,n=vn.W.create(!1);do if(n.elapsed()>1||this._tokenizeOneInvalidLine(t)>=e)break;while(this._hasLinesToTokenize());this._backgroundTokenStore.setTokens(t.finalize()),this.checkFinished()}_hasLinesToTokenize(){return this._tokenizerWithStateStore?!this._tokenizerWithStateStore.store.allStatesValid():!1}_tokenizeOneInvalidLine(e){const t=this._tokenizerWithStateStore?.getFirstInvalidLine();return t?(this._tokenizerWithStateStore.updateTokensUntilLine(e,t.lineNumber),t.lineNumber):this._tokenizerWithStateStore._textModel.getLineCount()+1}checkFinished(){this._isDisposed||this._tokenizerWithStateStore.store.allStatesValid()&&this._backgroundTokenStore.backgroundTokenizationFinished()}requestTokens(e,t){this._tokenizerWithStateStore.store.invalidateEndStateRange(new lt.M(e,t))}}class An{constructor(){this._onDidChangeVisibleRanges=new x.vl,this.onDidChangeVisibleRanges=this._onDidChangeVisibleRanges.event,this._views=new Set}attachView(){const e=new zn(t=>{this._onDidChangeVisibleRanges.fire({view:e,state:t})});return this._views.add(e),e}detachView(e){this._views.delete(e),this._onDidChangeVisibleRanges.fire({view:e,state:void 0})}}class zn{constructor(e){this.handleStateChange=e}setVisibleLines(e,t){const n=e.map(i=>new lt.M(i.startLineNumber,i.endLineNumber+1));this.handleStateChange({visibleLineRanges:n,stabilized:t})}}class yn extends M.jG{get lineRanges(){return this._lineRanges}constructor(e){super(),this._refreshTokens=e,this.runner=this._register(new Gt.uC(()=>this.update(),50)),this._computedLineRanges=[],this._lineRanges=[]}update(){(0,V.aI)(this._computedLineRanges,this._lineRanges,(e,t)=>e.equals(t))||(this._computedLineRanges=this._lineRanges,this._refreshTokens())}handleStateChange(e){this._lineRanges=e.visibleLineRanges,e.stabilized?(this.runner.cancel(),this.update()):this.runner.schedule()}}class Qt extends M.jG{get backgroundTokenizationState(){return this._backgroundTokenizationState}constructor(e,t,n){super(),this._languageIdCodec=e,this._textModel=t,this.getLanguageId=n,this._backgroundTokenizationState=1,this._onDidChangeBackgroundTokenizationState=this._register(new x.vl),this.onDidChangeBackgroundTokenizationState=this._onDidChangeBackgroundTokenizationState.event,this._onDidChangeTokens=this._register(new x.vl),this.onDidChangeTokens=this._onDidChangeTokens.event}tokenizeIfCheap(e){this.isCheapToTokenize(e)&&this.forceTokenization(e)}}class $t extends Qt{constructor(e,t,n,i){super(t,n,i),this._treeSitterService=e,this._tokenizationSupport=null,this._initialize()}_initialize(){const e=this.getLanguageId();(!this._tokenizationSupport||this._lastLanguageId!==e)&&(this._lastLanguageId=e,this._tokenizationSupport=tt.OB.get(e))}getLineTokens(e){const t=this._textModel.getLineContent(e);if(this._tokenizationSupport){const n=this._tokenizationSupport.tokenizeEncoded(e,this._textModel);if(n)return new Me.f(n,t,this._languageIdCodec)}return Me.f.createEmpty(t,this._languageIdCodec)}resetTokenization(e=!0){e&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]}),this._initialize()}handleDidChangeAttached(){}handleDidChangeContent(e){e.isFlush&&this.resetTokenization(!1)}forceTokenization(e){}hasAccurateTokensForLine(e){return!0}isCheapToTokenize(e){return!0}getTokenTypeIfInsertingCharacter(e,t,n){return 0}tokenizeLineWithEdit(e,t,n){return null}get hasTokens(){return this._treeSitterService.getParseResult(this._textModel)!==void 0}}var Fn=T(99523);const ye=new Uint32Array(0).buffer;class De{static deleteBeginning(e,t){return e===null||e===ye?e:De.delete(e,0,t)}static deleteEnding(e,t){if(e===null||e===ye)return e;const n=Fe(e),i=n[n.length-2];return De.delete(e,t,i)}static delete(e,t,n){if(e===null||e===ye||t===n)return e;const i=Fe(e),s=i.length>>>1;if(t===0&&i[i.length-2]===n)return ye;const r=Me.f.findIndexInTokensArray(i,t),o=r>0?i[r-1<<1]:0,l=i[r<<1];if(n<l){const O=n-t;for(let N=r;N<s;N++)i[N<<1]-=O;return e}let g,m;o!==t?(i[r<<1]=t,g=r+1<<1,m=t):(g=r<<1,m=o);const u=n-t;for(let O=r+1;O<s;O++){const N=i[O<<1]-u;N>m&&(i[g++]=N,i[g++]=i[(O<<1)+1],m=N)}if(g===i.length)return e;const k=new Uint32Array(g);return k.set(i.subarray(0,g),0),k.buffer}static append(e,t){if(t===ye)return e;if(e===ye)return t;if(e===null)return e;if(t===null)return null;const n=Fe(e),i=Fe(t),s=i.length>>>1,r=new Uint32Array(n.length+i.length);r.set(n,0);let o=n.length;const l=n[n.length-2];for(let g=0;g<s;g++)r[o++]=i[g<<1]+l,r[o++]=i[(g<<1)+1];return r.buffer}static insert(e,t,n){if(e===null||e===ye)return e;const i=Fe(e),s=i.length>>>1;let r=Me.f.findIndexInTokensArray(i,t);r>0&&i[r-1<<1]===t&&r--;for(let o=r;o<s;o++)i[o<<1]+=n;return e}}function Fe(a){return a instanceof Uint32Array?a:new Uint32Array(a)}var Wn=T(71269);class it{constructor(e){this._lineTokens=[],this._len=0,this._languageIdCodec=e}flush(){this._lineTokens=[],this._len=0}get hasTokens(){return this._lineTokens.length>0}getTokens(e,t,n){let i=null;if(t<this._len&&(i=this._lineTokens[t]),i!==null&&i!==ye)return new Me.f(Fe(i),n,this._languageIdCodec);const s=new Uint32Array(2);return s[0]=n.length,s[1]=Xt(this._languageIdCodec.encodeLanguageId(e)),new Me.f(s,n,this._languageIdCodec)}static _massageTokens(e,t,n){const i=n?Fe(n):null;if(t===0){let s=!1;if(i&&i.length>1&&(s=Wn.x.getLanguageId(i[1])!==e),!s)return ye}if(!i||i.length===0){const s=new Uint32Array(2);return s[0]=t,s[1]=Xt(e),s.buffer}return i[i.length-2]=t,i.byteOffset===0&&i.byteLength===i.buffer.byteLength?i.buffer:i}_ensureLine(e){for(;e>=this._len;)this._lineTokens[this._len]=null,this._len++}_deleteLines(e,t){t!==0&&(e+t>this._len&&(t=this._len-e),this._lineTokens.splice(e,t),this._len-=t)}_insertLines(e,t){if(t===0)return;const n=[];for(let i=0;i<t;i++)n[i]=null;this._lineTokens=V.nK(this._lineTokens,e,n),this._len+=t}setTokens(e,t,n,i,s){const r=it._massageTokens(this._languageIdCodec.encodeLanguageId(e),n,i);this._ensureLine(t);const o=this._lineTokens[t];return this._lineTokens[t]=r,s?!it._equals(o,r):!1}static _equals(e,t){if(!e||!t)return!e&&!t;const n=Fe(e),i=Fe(t);if(n.length!==i.length)return!1;for(let s=0,r=n.length;s<r;s++)if(n[s]!==i[s])return!1;return!0}acceptEdit(e,t,n){this._acceptDeleteRange(e),this._acceptInsertText(new b.y(e.startLineNumber,e.startColumn),t,n)}_acceptDeleteRange(e){const t=e.startLineNumber-1;if(t>=this._len)return;if(e.startLineNumber===e.endLineNumber){if(e.startColumn===e.endColumn)return;this._lineTokens[t]=De.delete(this._lineTokens[t],e.startColumn-1,e.endColumn-1);return}this._lineTokens[t]=De.deleteEnding(this._lineTokens[t],e.startColumn-1);const n=e.endLineNumber-1;let i=null;n<this._len&&(i=De.deleteBeginning(this._lineTokens[n],e.endColumn-1)),this._lineTokens[t]=De.append(this._lineTokens[t],i),this._deleteLines(e.startLineNumber,e.endLineNumber-e.startLineNumber)}_acceptInsertText(e,t,n){if(t===0&&n===0)return;const i=e.lineNumber-1;if(!(i>=this._len)){if(t===0){this._lineTokens[i]=De.insert(this._lineTokens[i],e.column-1,n);return}this._lineTokens[i]=De.deleteEnding(this._lineTokens[i],e.column-1),this._lineTokens[i]=De.insert(this._lineTokens[i],e.column-1,n),this._insertLines(e.lineNumber,t)}}setMultilineTokens(e,t){if(e.length===0)return{changes:[]};const n=[];for(let i=0,s=e.length;i<s;i++){const r=e[i];let o=0,l=0,g=!1;for(let m=r.startLineNumber;m<=r.endLineNumber;m++)g?(this.setTokens(t.getLanguageId(),m-1,t.getLineLength(m),r.getLineTokens(m),!1),l=m):this.setTokens(t.getLanguageId(),m-1,t.getLineLength(m),r.getLineTokens(m),!0)&&(g=!0,o=m,l=m);g&&n.push({fromLineNumber:o,toLineNumber:l})}return{changes:n}}}function Xt(a){return(a<<0|0|0|32768|2<<24|1024)>>>0}class Et{constructor(e){this._pieces=[],this._isComplete=!1,this._languageIdCodec=e}flush(){this._pieces=[],this._isComplete=!1}isEmpty(){return this._pieces.length===0}set(e,t){this._pieces=e||[],this._isComplete=t}setPartial(e,t){let n=e;if(t.length>0){const s=t[0].getRange(),r=t[t.length-1].getRange();if(!s||!r)return e;n=e.plusRange(s).plusRange(r)}let i=null;for(let s=0,r=this._pieces.length;s<r;s++){const o=this._pieces[s];if(o.endLineNumber<n.startLineNumber)continue;if(o.startLineNumber>n.endLineNumber){i=i||{index:s};break}if(o.removeTokens(n),o.isEmpty()){this._pieces.splice(s,1),s--,r--;continue}if(o.endLineNumber<n.startLineNumber)continue;if(o.startLineNumber>n.endLineNumber){i=i||{index:s};continue}const[l,g]=o.split(n);if(l.isEmpty()){i=i||{index:s};continue}g.isEmpty()||(this._pieces.splice(s,1,l,g),s++,r++,i=i||{index:s})}return i=i||{index:this._pieces.length},t.length>0&&(this._pieces=V.nK(this._pieces,i.index,t)),n}isComplete(){return this._isComplete}addSparseTokens(e,t){if(t.getLineContent().length===0)return t;const n=this._pieces;if(n.length===0)return t;const i=Et._findFirstPieceWithLine(n,e),s=n[i].getLineTokens(e);if(!s)return t;const r=t.getCount(),o=s.getCount();let l=0;const g=[];let m=0,u=0;const k=(O,N)=>{O!==u&&(u=O,g[m++]=O,g[m++]=N)};for(let O=0;O<o;O++){const N=s.getStartCharacter(O),F=s.getEndCharacter(O),U=s.getMetadata(O),Q=((U&1?2048:0)|(U&2?4096:0)|(U&4?8192:0)|(U&8?16384:0)|(U&16?16744448:0)|(U&32?4278190080:0))>>>0,q=~Q>>>0;for(;l<r&&t.getEndOffset(l)<=N;)k(t.getEndOffset(l),t.getMetadata(l)),l++;for(l<r&&t.getStartOffset(l)<N&&k(N,t.getMetadata(l));l<r&&t.getEndOffset(l)<F;)k(t.getEndOffset(l),t.getMetadata(l)&q|U&Q),l++;if(l<r)k(F,t.getMetadata(l)&q|U&Q),t.getEndOffset(l)===F&&l++;else{const re=Math.min(Math.max(0,l-1),r-1);k(F,t.getMetadata(re)&q|U&Q)}}for(;l<r;)k(t.getEndOffset(l),t.getMetadata(l)),l++;return new Me.f(new Uint32Array(g),t.getLineContent(),this._languageIdCodec)}static _findFirstPieceWithLine(e,t){let n=0,i=e.length-1;for(;n<i;){let s=n+Math.floor((i-n)/2);if(e[s].endLineNumber<t)n=s+1;else if(e[s].startLineNumber>t)i=s-1;else{for(;s>n&&e[s-1].startLineNumber<=t&&t<=e[s-1].endLineNumber;)s--;return s}}return n}acceptEdit(e,t,n,i,s){for(const r of this._pieces)r.acceptEdit(e,t,n,i,s)}}var Un=function(a,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,n);else for(var o=a.length-1;o>=0;o--)(r=a[o])&&(s=(i<3?r(s):i>3?r(e,t,s):r(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},Tt=function(a,e){return function(t,n){e(t,n,a)}},ht;let St=ht=class extends Tn._{constructor(e,t,n,i,s,r,o){super(),this._textModel=e,this._bracketPairsTextModelPart=t,this._languageId=n,this._attachedViews=i,this._languageService=s,this._languageConfigurationService=r,this._treeSitterService=o,this._semanticTokens=new Et(this._languageService.languageIdCodec),this._onDidChangeLanguage=this._register(new x.vl),this.onDidChangeLanguage=this._onDidChangeLanguage.event,this._onDidChangeLanguageConfiguration=this._register(new x.vl),this.onDidChangeLanguageConfiguration=this._onDidChangeLanguageConfiguration.event,this._onDidChangeTokens=this._register(new x.vl),this.onDidChangeTokens=this._onDidChangeTokens.event,this._tokensDisposables=this._register(new M.Cm),this._register(this._languageConfigurationService.onDidChange(l=>{l.affects(this._languageId)&&this._onDidChangeLanguageConfiguration.fire({})})),this._register(x.Jh.filter(tt.OB.onDidChange,l=>l.changedLanguages.includes(this._languageId))(()=>{this.createPreferredTokenProvider()})),this.createPreferredTokenProvider()}createGrammarTokens(){return this._register(new Yt(this._languageService.languageIdCodec,this._textModel,()=>this._languageId,this._attachedViews))}createTreeSitterTokens(){return this._register(new $t(this._treeSitterService,this._languageService.languageIdCodec,this._textModel,()=>this._languageId))}createTokens(e){const t=this._tokens!==void 0;this._tokens?.dispose(),this._tokens=e?this.createTreeSitterTokens():this.createGrammarTokens(),this._tokensDisposables.clear(),this._tokensDisposables.add(this._tokens.onDidChangeTokens(n=>{this._emitModelTokensChangedEvent(n)})),this._tokensDisposables.add(this._tokens.onDidChangeBackgroundTokenizationState(n=>{this._bracketPairsTextModelPart.handleDidChangeBackgroundTokenizationState()})),t&&this._tokens.resetTokenization()}createPreferredTokenProvider(){tt.OB.get(this._languageId)?this._tokens instanceof $t||this.createTokens(!0):this._tokens instanceof Yt||this.createTokens(!1)}handleLanguageConfigurationServiceChange(e){e.affects(this._languageId)&&this._onDidChangeLanguageConfiguration.fire({})}handleDidChangeContent(e){if(e.isFlush)this._semanticTokens.flush();else if(!e.isEolChange)for(const t of e.changes){const[n,i,s]=(0,d.W)(t.text);this._semanticTokens.acceptEdit(t.range,n,i,s,t.text.length>0?t.text.charCodeAt(0):0)}this._tokens.handleDidChangeContent(e)}handleDidChangeAttached(){this._tokens.handleDidChangeAttached()}getLineTokens(e){this.validateLineNumber(e);const t=this._tokens.getLineTokens(e);return this._semanticTokens.addSparseTokens(e,t)}_emitModelTokensChangedEvent(e){this._textModel._isDisposing()||(this._bracketPairsTextModelPart.handleDidChangeTokens(e),this._onDidChangeTokens.fire(e))}validateLineNumber(e){if(e<1||e>this._textModel.getLineCount())throw new j.D7("Illegal value for lineNumber")}get hasTokens(){return this._tokens.hasTokens}resetTokenization(){this._tokens.resetTokenization()}get backgroundTokenizationState(){return this._tokens.backgroundTokenizationState}forceTokenization(e){this.validateLineNumber(e),this._tokens.forceTokenization(e)}hasAccurateTokensForLine(e){return this.validateLineNumber(e),this._tokens.hasAccurateTokensForLine(e)}isCheapToTokenize(e){return this.validateLineNumber(e),this._tokens.isCheapToTokenize(e)}tokenizeIfCheap(e){this.validateLineNumber(e),this._tokens.tokenizeIfCheap(e)}getTokenTypeIfInsertingCharacter(e,t,n){return this._tokens.getTokenTypeIfInsertingCharacter(e,t,n)}tokenizeLineWithEdit(e,t,n){return this._tokens.tokenizeLineWithEdit(e,t,n)}setSemanticTokens(e,t){this._semanticTokens.set(e,t),this._emitModelTokensChangedEvent({semanticTokensApplied:e!==null,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]})}hasCompleteSemanticTokens(){return this._semanticTokens.isComplete()}hasSomeSemanticTokens(){return!this._semanticTokens.isEmpty()}setPartialSemanticTokens(e,t){if(this.hasCompleteSemanticTokens())return;const n=this._textModel.validateRange(this._semanticTokens.setPartial(e,t));this._emitModelTokensChangedEvent({semanticTokensApplied:!0,ranges:[{fromLineNumber:n.startLineNumber,toLineNumber:n.endLineNumber}]})}getWordAtPosition(e){this.assertNotDisposed();const t=this._textModel.validatePosition(e),n=this._textModel.getLineContent(t.lineNumber),i=this.getLineTokens(t.lineNumber),s=i.findTokenIndexAtOffset(t.column-1),[r,o]=ht._findLanguageBoundaries(i,s),l=(0,Kt.Th)(t.column,this.getLanguageConfiguration(i.getLanguageId(s)).getWordDefinition(),n.substring(r,o),r);if(l&&l.startColumn<=e.column&&e.column<=l.endColumn)return l;if(s>0&&r===t.column-1){const[g,m]=ht._findLanguageBoundaries(i,s-1),u=(0,Kt.Th)(t.column,this.getLanguageConfiguration(i.getLanguageId(s-1)).getWordDefinition(),n.substring(g,m),g);if(u&&u.startColumn<=e.column&&e.column<=u.endColumn)return u}return null}getLanguageConfiguration(e){return this._languageConfigurationService.getLanguageConfiguration(e)}static _findLanguageBoundaries(e,t){const n=e.getLanguageId(t);let i=0;for(let r=t;r>=0&&e.getLanguageId(r)===n;r--)i=e.getStartOffset(r);let s=e.getLineContent().length;for(let r=t,o=e.getCount();r<o&&e.getLanguageId(r)===n;r++)s=e.getEndOffset(r);return[i,s]}getWordUntilPosition(e){const t=this.getWordAtPosition(e);return t?{word:t.word.substr(0,e.column-t.startColumn),startColumn:t.startColumn,endColumn:e.column}:{word:"",startColumn:e.column,endColumn:e.column}}getLanguageId(){return this._languageId}getLanguageIdAtPosition(e,t){const n=this._textModel.validatePosition(new b.y(e,t)),i=this.getLineTokens(n.lineNumber);return i.getLanguageId(i.findTokenIndexAtOffset(n.column-1))}setLanguageId(e,t="api"){if(this._languageId===e)return;const n={oldLanguage:this._languageId,newLanguage:e,source:t};this._languageId=e,this._bracketPairsTextModelPart.handleDidChangeLanguage(n),this._tokens.resetTokenization(),this.createPreferredTokenProvider(),this._onDidChangeLanguage.fire(n),this._onDidChangeLanguageConfiguration.fire({})}};St=ht=Un([Tt(4,A.L),Tt(5,G.JZ),Tt(6,Fn.ITreeSitterParserService)],St);class Yt extends Qt{constructor(e,t,n,i){super(e,t,n),this._tokenizer=null,this._defaultBackgroundTokenizer=null,this._backgroundTokenizer=this._register(new M.HE),this._tokens=new it(this._languageIdCodec),this._debugBackgroundTokenizer=this._register(new M.HE),this._attachedViewStates=this._register(new M.$w),this._register(tt.dG.onDidChange(s=>{const r=this.getLanguageId();s.changedLanguages.indexOf(r)!==-1&&this.resetTokenization()})),this.resetTokenization(),this._register(i.onDidChangeVisibleRanges(({view:s,state:r})=>{if(r){let o=this._attachedViewStates.get(s);o||(o=new yn(()=>this.refreshRanges(o.lineRanges)),this._attachedViewStates.set(s,o)),o.handleStateChange(r)}else this._attachedViewStates.deleteAndDispose(s)}))}resetTokenization(e=!0){this._tokens.flush(),this._debugBackgroundTokens?.flush(),this._debugBackgroundStates&&(this._debugBackgroundStates=new bt(this._textModel.getLineCount())),e&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:[{fromLineNumber:1,toLineNumber:this._textModel.getLineCount()}]});const t=()=>{if(this._textModel.isTooLargeForTokenization())return[null,null];const s=tt.dG.get(this.getLanguageId());if(!s)return[null,null];let r;try{r=s.getInitialState()}catch(o){return(0,j.dz)(o),[null,null]}return[s,r]},[n,i]=t();if(n&&i?this._tokenizer=new Dn(this._textModel.getLineCount(),n,this._textModel,this._languageIdCodec):this._tokenizer=null,this._backgroundTokenizer.clear(),this._defaultBackgroundTokenizer=null,this._tokenizer){const s={setTokens:r=>{this.setTokens(r)},backgroundTokenizationFinished:()=>{if(this._backgroundTokenizationState===2)return;const r=2;this._backgroundTokenizationState=r,this._onDidChangeBackgroundTokenizationState.fire()},setEndState:(r,o)=>{if(!this._tokenizer)return;const l=this._tokenizer.store.getFirstInvalidEndStateLineNumber();l!==null&&r>=l&&this._tokenizer?.store.setEndState(r,o)}};n&&n.createBackgroundTokenizer&&!n.backgroundTokenizerShouldOnlyVerifyTokens&&(this._backgroundTokenizer.value=n.createBackgroundTokenizer(this._textModel,s)),!this._backgroundTokenizer.value&&!this._textModel.isTooLargeForTokenization()&&(this._backgroundTokenizer.value=this._defaultBackgroundTokenizer=new Pn(this._tokenizer,s),this._defaultBackgroundTokenizer.handleChanges()),n?.backgroundTokenizerShouldOnlyVerifyTokens&&n.createBackgroundTokenizer?(this._debugBackgroundTokens=new it(this._languageIdCodec),this._debugBackgroundStates=new bt(this._textModel.getLineCount()),this._debugBackgroundTokenizer.clear(),this._debugBackgroundTokenizer.value=n.createBackgroundTokenizer(this._textModel,{setTokens:r=>{this._debugBackgroundTokens?.setMultilineTokens(r,this._textModel)},backgroundTokenizationFinished(){},setEndState:(r,o)=>{this._debugBackgroundStates?.setEndState(r,o)}})):(this._debugBackgroundTokens=void 0,this._debugBackgroundStates=void 0,this._debugBackgroundTokenizer.value=void 0)}this.refreshAllVisibleLineTokens()}handleDidChangeAttached(){this._defaultBackgroundTokenizer?.handleChanges()}handleDidChangeContent(e){if(e.isFlush)this.resetTokenization(!1);else if(!e.isEolChange){for(const t of e.changes){const[n,i]=(0,d.W)(t.text);this._tokens.acceptEdit(t.range,n,i),this._debugBackgroundTokens?.acceptEdit(t.range,n,i)}this._debugBackgroundStates?.acceptChanges(e.changes),this._tokenizer&&this._tokenizer.store.acceptChanges(e.changes),this._defaultBackgroundTokenizer?.handleChanges()}}setTokens(e){const{changes:t}=this._tokens.setMultilineTokens(e,this._textModel);return t.length>0&&this._onDidChangeTokens.fire({semanticTokensApplied:!1,ranges:t}),{changes:t}}refreshAllVisibleLineTokens(){const e=lt.M.joinMany([...this._attachedViewStates].map(([t,n])=>n.lineRanges));this.refreshRanges(e)}refreshRanges(e){for(const t of e)this.refreshRange(t.startLineNumber,t.endLineNumberExclusive-1)}refreshRange(e,t){if(!this._tokenizer)return;e=Math.max(1,Math.min(this._textModel.getLineCount(),e)),t=Math.min(this._textModel.getLineCount(),t);const n=new It,{heuristicTokens:i}=this._tokenizer.tokenizeHeuristically(n,e,t),s=this.setTokens(n.finalize());if(i)for(const r of s.changes)this._backgroundTokenizer.value?.requestTokens(r.fromLineNumber,r.toLineNumber+1);this._defaultBackgroundTokenizer?.checkFinished()}forceTokenization(e){const t=new It;this._tokenizer?.updateTokensUntilLine(t,e),this.setTokens(t.finalize()),this._defaultBackgroundTokenizer?.checkFinished()}hasAccurateTokensForLine(e){return this._tokenizer?this._tokenizer.hasAccurateTokensForLine(e):!0}isCheapToTokenize(e){return this._tokenizer?this._tokenizer.isCheapToTokenize(e):!0}getLineTokens(e){const t=this._textModel.getLineContent(e),n=this._tokens.getTokens(this._textModel.getLanguageId(),e-1,t);if(this._debugBackgroundTokens&&this._debugBackgroundStates&&this._tokenizer&&this._debugBackgroundStates.getFirstInvalidEndStateLineNumberOrMax()>e&&this._tokenizer.store.getFirstInvalidEndStateLineNumberOrMax()>e){const i=this._debugBackgroundTokens.getTokens(this._textModel.getLanguageId(),e-1,t);!n.equals(i)&&this._debugBackgroundTokenizer.value?.reportMismatchingTokens&&this._debugBackgroundTokenizer.value.reportMismatchingTokens(e)}return n}getTokenTypeIfInsertingCharacter(e,t,n){if(!this._tokenizer)return 0;const i=this._textModel.validatePosition(new b.y(e,t));return this.forceTokenization(i.lineNumber),this._tokenizer.getTokenTypeIfInsertingCharacter(i,n)}tokenizeLineWithEdit(e,t,n){if(!this._tokenizer)return null;const i=this._textModel.validatePosition(e);return this.forceTokenization(i.lineNumber),this._tokenizer.tokenizeLineWithEdit(i,t,n)}get hasTokens(){return this._tokens.hasTokens}}var xe=T(24934),Vn=T(81545),jn=T(30894),Hn=function(a,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,r;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(a,e,t,n);else for(var o=a.length-1;o>=0;o--)(r=a[o])&&(s=(i<3?r(s):i>3?r(e,t,s):r(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s},ct=function(a,e){return function(t,n){e(t,n,a)}},He;function Kn(a){const e=new Ht;return e.acceptChunk(a),e.finish()}function Gn(a){const e=new Ht;let t;for(;typeof(t=a.read())=="string";)e.acceptChunk(t);return e.finish()}function Zt(a,e){let t;return typeof a=="string"?t=Kn(a):_.nk(a)?t=Gn(a):t=a,t.create(e)}let ut=0;const Qn=999,$n=1e4;class Xn{constructor(e){this._source=e,this._eos=!1}read(){if(this._eos)return null;const e=[];let t=0,n=0;do{const i=this._source.read();if(i===null)return this._eos=!0,t===0?null:e.join("");if(i.length>0&&(e[t++]=i,n+=i.length),n>=64*1024)return e.join("")}while(!0)}}const st=()=>{throw new Error("Invalid change accessor")};let vt=class extends M.jG{static{He=this}static{this._MODEL_SYNC_LIMIT=50*1024*1024}static{this.LARGE_FILE_SIZE_THRESHOLD=20*1024*1024}static{this.LARGE_FILE_LINE_COUNT_THRESHOLD=300*1e3}static{this.LARGE_FILE_HEAP_OPERATION_THRESHOLD=256*1024*1024}static{this.DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:B.R.tabSize,indentSize:B.R.indentSize,insertSpaces:B.R.insertSpaces,detectIndentation:!1,defaultEOL:1,trimAutoWhitespace:B.R.trimAutoWhitespace,largeFileOptimizations:B.R.largeFileOptimizations,bracketPairColorizationOptions:B.R.bracketPairColorizationOptions}}static resolveOptions(e,t){if(t.detectIndentation){const n=Le(e,t.tabSize,t.insertSpaces);return new _.X2({tabSize:n.tabSize,indentSize:"tabSize",insertSpaces:n.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}return new _.X2(t)}get onDidChangeLanguage(){return this._tokenizationTextModelPart.onDidChangeLanguage}get onDidChangeLanguageConfiguration(){return this._tokenizationTextModelPart.onDidChangeLanguageConfiguration}get onDidChangeTokens(){return this._tokenizationTextModelPart.onDidChangeTokens}onDidChangeContent(e){return this._eventEmitter.slowEvent(t=>e(t.contentChangedEvent))}onDidChangeContentOrInjectedText(e){return(0,M.qE)(this._eventEmitter.fastEvent(t=>e(t)),this._onDidChangeInjectedText.event(t=>e(t)))}_isDisposing(){return this.__isDisposing}get tokenization(){return this._tokenizationTextModelPart}get bracketPairs(){return this._bracketPairs}get guides(){return this._guidesTextModelPart}constructor(e,t,n,i=null,s,r,o,l){super(),this._undoRedoService=s,this._languageService=r,this._languageConfigurationService=o,this.instantiationService=l,this._onWillDispose=this._register(new x.vl),this.onWillDispose=this._onWillDispose.event,this._onDidChangeDecorations=this._register(new ti(N=>this.handleBeforeFireDecorationsChangedEvent(N))),this.onDidChangeDecorations=this._onDidChangeDecorations.event,this._onDidChangeOptions=this._register(new x.vl),this.onDidChangeOptions=this._onDidChangeOptions.event,this._onDidChangeAttached=this._register(new x.vl),this.onDidChangeAttached=this._onDidChangeAttached.event,this._onDidChangeInjectedText=this._register(new x.vl),this._eventEmitter=this._register(new ni),this._languageSelectionListener=this._register(new M.HE),this._deltaDecorationCallCnt=0,this._attachedViews=new An,ut++,this.id="$model"+ut,this.isForSimpleWidget=n.isForSimpleWidget,typeof i>"u"||i===null?this._associatedResource=C.r.parse("inmemory://model/"+ut):this._associatedResource=i,this._attachedEditorCount=0;const{textBuffer:g,disposable:m}=Zt(e,n.defaultEOL);this._buffer=g,this._bufferDisposable=m,this._options=He.resolveOptions(this._buffer,n);const u=typeof t=="string"?t:t.languageId;typeof t!="string"&&(this._languageSelectionListener.value=t.onDidChange(()=>this._setLanguage(t.languageId))),this._bracketPairs=this._register(new ae(this,this._languageConfigurationService)),this._guidesTextModelPart=this._register(new te.P(this,this._languageConfigurationService)),this._decorationProvider=this._register(new ce(this)),this._tokenizationTextModelPart=this.instantiationService.createInstance(St,this,this._bracketPairs,u,this._attachedViews);const k=this._buffer.getLineCount(),O=this._buffer.getValueLengthInRange(new p.Q(1,1,k,this._buffer.getLineLength(k)+1),0);n.largeFileOptimizations?(this._isTooLargeForTokenization=O>He.LARGE_FILE_SIZE_THRESHOLD||k>He.LARGE_FILE_LINE_COUNT_THRESHOLD,this._isTooLargeForHeapOperation=O>He.LARGE_FILE_HEAP_OPERATION_THRESHOLD):(this._isTooLargeForTokenization=!1,this._isTooLargeForHeapOperation=!1),this._isTooLargeForSyncing=O>He._MODEL_SYNC_LIMIT,this._versionId=1,this._alternativeVersionId=1,this._initialUndoRedoSnapshot=null,this._isDisposed=!1,this.__isDisposing=!1,this._instanceId=c.tk(ut),this._lastDecorationId=0,this._decorations=Object.create(null),this._decorationsTree=new Jt,this._commandManager=new H.z8(this,this._undoRedoService),this._isUndoing=!1,this._isRedoing=!1,this._trimAutoWhitespaceLines=null,this._register(this._decorationProvider.onDidChange(()=>{this._onDidChangeDecorations.beginDeferredEmit(),this._onDidChangeDecorations.fire(),this._onDidChangeDecorations.endDeferredEmit()})),this._languageService.requestRichLanguageFeatures(u),this._register(this._languageConfigurationService.onDidChange(N=>{this._bracketPairs.handleLanguageConfigurationServiceChange(N),this._tokenizationTextModelPart.handleLanguageConfigurationServiceChange(N)}))}dispose(){this.__isDisposing=!0,this._onWillDispose.fire(),this._tokenizationTextModelPart.dispose(),this._isDisposed=!0,super.dispose(),this._bufferDisposable.dispose(),this.__isDisposing=!1;const e=new Ge([],"",`
`,!1,!1,!0,!0);e.dispose(),this._buffer=e,this._bufferDisposable=M.jG.None}_assertNotDisposed(){if(this._isDisposed)throw new j.D7("Model is disposed!")}_emitContentChangedEvent(e,t){this.__isDisposing||(this._tokenizationTextModelPart.handleDidChangeContent(t),this._bracketPairs.handleDidChangeContent(t),this._eventEmitter.fire(new xe.Ic(e,t)))}setValue(e){if(this._assertNotDisposed(),e==null)throw(0,j.Qg)();const{textBuffer:t,disposable:n}=Zt(e,this._options.defaultEOL);this._setValueFromTextBuffer(t,n)}_createContentChanged2(e,t,n,i,s,r,o,l){return{changes:[{range:e,rangeOffset:t,rangeLength:n,text:i}],eol:this._buffer.getEOL(),isEolChange:l,versionId:this.getVersionId(),isUndoing:s,isRedoing:r,isFlush:o}}_setValueFromTextBuffer(e,t){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueLengthInRange(n),s=this.getLineCount(),r=this.getLineMaxColumn(s);this._buffer=e,this._bufferDisposable.dispose(),this._bufferDisposable=t,this._increaseVersionId(),this._decorations=Object.create(null),this._decorationsTree=new Jt,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new xe.HP([new xe.Wn],this._versionId,!1,!1),this._createContentChanged2(new p.Q(1,1,s,r),0,i,this.getValue(),!1,!1,!0,!1))}setEOL(e){this._assertNotDisposed();const t=e===1?`\r
`:`
`;if(this._buffer.getEOL()===t)return;const n=this.getFullModelRange(),i=this.getValueLengthInRange(n),s=this.getLineCount(),r=this.getLineMaxColumn(s);this._onBeforeEOLChange(),this._buffer.setEOL(t),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new xe.HP([new xe.mS],this._versionId,!1,!1),this._createContentChanged2(new p.Q(1,1,s,r),0,i,this.getValue(),!1,!1,!1,!0))}_onBeforeEOLChange(){this._decorationsTree.ensureAllNodesHaveRanges(this)}_onAfterEOLChange(){const e=this.getVersionId(),t=this._decorationsTree.collectNodesPostOrder();for(let n=0,i=t.length;n<i;n++){const s=t[n],r=s.range,o=s.cachedAbsoluteStart-s.start,l=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),g=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);s.cachedAbsoluteStart=l,s.cachedAbsoluteEnd=g,s.cachedVersionId=e,s.start=l-o,s.end=g-o,Ue(s)}}onBeforeAttached(){return this._attachedEditorCount++,this._attachedEditorCount===1&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.attachView()}onBeforeDetached(e){this._attachedEditorCount--,this._attachedEditorCount===0&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.detachView(e)}isAttachedToEditor(){return this._attachedEditorCount>0}getAttachedEditorCount(){return this._attachedEditorCount}isTooLargeForSyncing(){return this._isTooLargeForSyncing}isTooLargeForTokenization(){return this._isTooLargeForTokenization}isTooLargeForHeapOperation(){return this._isTooLargeForHeapOperation}isDisposed(){return this._isDisposed}isDominatedByLongLines(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;let e=0,t=0;const n=this._buffer.getLineCount();for(let i=1;i<=n;i++){const s=this._buffer.getLineLength(i);s>=$n?t+=s:e+=s}return t>e}get uri(){return this._associatedResource}getOptions(){return this._assertNotDisposed(),this._options}getFormattingOptions(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}updateOptions(e){this._assertNotDisposed();const t=typeof e.tabSize<"u"?e.tabSize:this._options.tabSize,n=typeof e.indentSize<"u"?e.indentSize:this._options.originalIndentSize,i=typeof e.insertSpaces<"u"?e.insertSpaces:this._options.insertSpaces,s=typeof e.trimAutoWhitespace<"u"?e.trimAutoWhitespace:this._options.trimAutoWhitespace,r=typeof e.bracketColorizationOptions<"u"?e.bracketColorizationOptions:this._options.bracketPairColorizationOptions,o=new _.X2({tabSize:t,indentSize:n,insertSpaces:i,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:s,bracketPairColorizationOptions:r});if(this._options.equals(o))return;const l=this._options.createChangeEvent(o);this._options=o,this._bracketPairs.handleDidChangeOptions(l),this._decorationProvider.handleDidChangeOptions(l),this._onDidChangeOptions.fire(l)}detectIndentation(e,t){this._assertNotDisposed();const n=Le(this._buffer,t,e);this.updateOptions({insertSpaces:n.insertSpaces,tabSize:n.tabSize,indentSize:n.tabSize})}normalizeIndentation(e){return this._assertNotDisposed(),(0,L.P)(e,this._options.indentSize,this._options.insertSpaces)}getVersionId(){return this._assertNotDisposed(),this._versionId}mightContainRTL(){return this._buffer.mightContainRTL()}mightContainUnusualLineTerminators(){return this._buffer.mightContainUnusualLineTerminators()}removeUnusualLineTerminators(e=null){const t=this.findMatches(c._J.source,!1,!0,!1,null,!1,1073741824);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(e,t.map(n=>({range:n.range,text:null})),()=>null)}mightContainNonBasicASCII(){return this._buffer.mightContainNonBasicASCII()}getAlternativeVersionId(){return this._assertNotDisposed(),this._alternativeVersionId}getInitialUndoRedoSnapshot(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}getOffsetAt(e){this._assertNotDisposed();const t=this._validatePosition(e.lineNumber,e.column,0);return this._buffer.getOffsetAt(t.lineNumber,t.column)}getPositionAt(e){this._assertNotDisposed();const t=Math.min(this._buffer.getLength(),Math.max(0,e));return this._buffer.getPositionAt(t)}_increaseVersionId(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}_overwriteVersionId(e){this._versionId=e}_overwriteAlternativeVersionId(e){this._alternativeVersionId=e}_overwriteInitialUndoRedoSnapshot(e){this._initialUndoRedoSnapshot=e}getValue(e,t=!1){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new j.D7("Operation would exceed heap memory limits");const n=this.getFullModelRange(),i=this.getValueInRange(n,e);return t?this._buffer.getBOM()+i:i}createSnapshot(e=!1){return new Xn(this._buffer.createSnapshot(e))}getValueLength(e,t=!1){this._assertNotDisposed();const n=this.getFullModelRange(),i=this.getValueLengthInRange(n,e);return t?this._buffer.getBOM().length+i:i}getValueInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(e),t)}getValueLengthInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(e),t)}getCharacterCountInRange(e,t=0){return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(e),t)}getLineCount(){return this._assertNotDisposed(),this._buffer.getLineCount()}getLineContent(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new j.D7("Illegal value for lineNumber");return this._buffer.getLineContent(e)}getLineLength(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new j.D7("Illegal value for lineNumber");return this._buffer.getLineLength(e)}getLinesContent(){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new j.D7("Operation would exceed heap memory limits");return this._buffer.getLinesContent()}getEOL(){return this._assertNotDisposed(),this._buffer.getEOL()}getEndOfLineSequence(){return this._assertNotDisposed(),this._buffer.getEOL()===`
`?0:1}getLineMinColumn(e){return this._assertNotDisposed(),1}getLineMaxColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new j.D7("Illegal value for lineNumber");return this._buffer.getLineLength(e)+1}getLineFirstNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new j.D7("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(e)}getLineLastNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new j.D7("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(e)}_validateRangeRelaxedNoAllocations(e){const t=this._buffer.getLineCount(),n=e.startLineNumber,i=e.startColumn;let s=Math.floor(typeof n=="number"&&!isNaN(n)?n:1),r=Math.floor(typeof i=="number"&&!isNaN(i)?i:1);if(s<1)s=1,r=1;else if(s>t)s=t,r=this.getLineMaxColumn(s);else if(r<=1)r=1;else{const u=this.getLineMaxColumn(s);r>=u&&(r=u)}const o=e.endLineNumber,l=e.endColumn;let g=Math.floor(typeof o=="number"&&!isNaN(o)?o:1),m=Math.floor(typeof l=="number"&&!isNaN(l)?l:1);if(g<1)g=1,m=1;else if(g>t)g=t,m=this.getLineMaxColumn(g);else if(m<=1)m=1;else{const u=this.getLineMaxColumn(g);m>=u&&(m=u)}return n===s&&i===r&&o===g&&l===m&&e instanceof p.Q&&!(e instanceof w.L)?e:new p.Q(s,r,g,m)}_isValidPosition(e,t,n){if(typeof e!="number"||typeof t!="number"||isNaN(e)||isNaN(t)||e<1||t<1||(e|0)!==e||(t|0)!==t)return!1;const i=this._buffer.getLineCount();if(e>i)return!1;if(t===1)return!0;const s=this.getLineMaxColumn(e);if(t>s)return!1;if(n===1){const r=this._buffer.getLineCharCode(e,t-2);if(c.pc(r))return!1}return!0}_validatePosition(e,t,n){const i=Math.floor(typeof e=="number"&&!isNaN(e)?e:1),s=Math.floor(typeof t=="number"&&!isNaN(t)?t:1),r=this._buffer.getLineCount();if(i<1)return new b.y(1,1);if(i>r)return new b.y(r,this.getLineMaxColumn(r));if(s<=1)return new b.y(i,1);const o=this.getLineMaxColumn(i);if(s>=o)return new b.y(i,o);if(n===1){const l=this._buffer.getLineCharCode(i,s-2);if(c.pc(l))return new b.y(i,s-1)}return new b.y(i,s)}validatePosition(e){return this._assertNotDisposed(),e instanceof b.y&&this._isValidPosition(e.lineNumber,e.column,1)?e:this._validatePosition(e.lineNumber,e.column,1)}_isValidRange(e,t){const n=e.startLineNumber,i=e.startColumn,s=e.endLineNumber,r=e.endColumn;if(!this._isValidPosition(n,i,0)||!this._isValidPosition(s,r,0))return!1;if(t===1){const o=i>1?this._buffer.getLineCharCode(n,i-2):0,l=r>1&&r<=this._buffer.getLineLength(s)?this._buffer.getLineCharCode(s,r-2):0,g=c.pc(o),m=c.pc(l);return!g&&!m}return!0}validateRange(e){if(this._assertNotDisposed(),e instanceof p.Q&&!(e instanceof w.L)&&this._isValidRange(e,1))return e;const n=this._validatePosition(e.startLineNumber,e.startColumn,0),i=this._validatePosition(e.endLineNumber,e.endColumn,0),s=n.lineNumber,r=n.column,o=i.lineNumber,l=i.column;{const g=r>1?this._buffer.getLineCharCode(s,r-2):0,m=l>1&&l<=this._buffer.getLineLength(o)?this._buffer.getLineCharCode(o,l-2):0,u=c.pc(g),k=c.pc(m);return!u&&!k?new p.Q(s,r,o,l):s===o&&r===l?new p.Q(s,r-1,o,l-1):u&&k?new p.Q(s,r-1,o,l+1):u?new p.Q(s,r-1,o,l):new p.Q(s,r,o,l+1)}return new p.Q(s,r,o,l)}modifyPosition(e,t){this._assertNotDisposed();const n=this.getOffsetAt(e)+t;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,n)))}getFullModelRange(){this._assertNotDisposed();const e=this.getLineCount();return new p.Q(1,1,e,this.getLineMaxColumn(e))}findMatchesLineByLine(e,t,n,i){return this._buffer.findMatchesLineByLine(e,t,n,i)}findMatches(e,t,n,i,s,r,o=Qn){this._assertNotDisposed();let l=null;t!==null&&(Array.isArray(t)||(t=[t]),t.every(u=>p.Q.isIRange(u))&&(l=t.map(u=>this.validateRange(u)))),l===null&&(l=[this.getFullModelRange()]),l=l.sort((u,k)=>u.startLineNumber-k.startLineNumber||u.startColumn-k.startColumn);const g=[];g.push(l.reduce((u,k)=>p.Q.areIntersecting(u,k)?u.plusRange(k):(g.push(u),k)));let m;if(!n&&e.indexOf(`
`)<0){const k=new ve.lt(e,n,i,s).parseSearchRequest();if(!k)return[];m=O=>this.findMatchesLineByLine(O,k,r,o)}else m=u=>ve.hB.findMatches(this,new ve.lt(e,n,i,s),u,r,o);return g.map(m).reduce((u,k)=>u.concat(k),[])}findNextMatch(e,t,n,i,s,r){this._assertNotDisposed();const o=this.validatePosition(t);if(!n&&e.indexOf(`
`)<0){const g=new ve.lt(e,n,i,s).parseSearchRequest();if(!g)return null;const m=this.getLineCount();let u=new p.Q(o.lineNumber,o.column,m,this.getLineMaxColumn(m)),k=this.findMatchesLineByLine(u,g,r,1);return ve.hB.findNextMatch(this,new ve.lt(e,n,i,s),o,r),k.length>0||(u=new p.Q(1,1,o.lineNumber,this.getLineMaxColumn(o.lineNumber)),k=this.findMatchesLineByLine(u,g,r,1),k.length>0)?k[0]:null}return ve.hB.findNextMatch(this,new ve.lt(e,n,i,s),o,r)}findPreviousMatch(e,t,n,i,s,r){this._assertNotDisposed();const o=this.validatePosition(t);return ve.hB.findPreviousMatch(this,new ve.lt(e,n,i,s),o,r)}pushStackElement(){this._commandManager.pushStackElement()}popStackElement(){this._commandManager.popStackElement()}pushEOL(e){if((this.getEOL()===`
`?0:1)!==e)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(e)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_validateEditOperation(e){return e instanceof _.Wo?e:new _.Wo(e.identifier||null,this.validateRange(e.range),e.text,e.forceMoveMarkers||!1,e.isAutoWhitespaceEdit||!1,e._isTracked||!1)}_validateEditOperations(e){const t=[];for(let n=0,i=e.length;n<i;n++)t[n]=this._validateEditOperation(e[n]);return t}pushEditOperations(e,t,n,i){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(e,this._validateEditOperations(t),n,i)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_pushEditOperations(e,t,n,i){if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){const s=t.map(o=>({range:this.validateRange(o.range),text:o.text}));let r=!0;if(e)for(let o=0,l=e.length;o<l;o++){const g=e[o];let m=!1;for(let u=0,k=s.length;u<k;u++){const O=s[u].range,N=O.startLineNumber>g.endLineNumber,F=g.startLineNumber>O.endLineNumber;if(!N&&!F){m=!0;break}}if(!m){r=!1;break}}if(r)for(let o=0,l=this._trimAutoWhitespaceLines.length;o<l;o++){const g=this._trimAutoWhitespaceLines[o],m=this.getLineMaxColumn(g);let u=!0;for(let k=0,O=s.length;k<O;k++){const N=s[k].range,F=s[k].text;if(!(g<N.startLineNumber||g>N.endLineNumber)&&!(g===N.startLineNumber&&N.startColumn===m&&N.isEmpty()&&F&&F.length>0&&F.charAt(0)===`
`)&&!(g===N.startLineNumber&&N.startColumn===1&&N.isEmpty()&&F&&F.length>0&&F.charAt(F.length-1)===`
`)){u=!1;break}}if(u){const k=new p.Q(g,1,g,m);t.push(new _.Wo(null,k,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(e,t,n,i)}_applyUndo(e,t,n,i){const s=e.map(r=>{const o=this.getPositionAt(r.newPosition),l=this.getPositionAt(r.newEnd);return{range:new p.Q(o.lineNumber,o.column,l.lineNumber,l.column),text:r.oldText}});this._applyUndoRedoEdits(s,t,!0,!1,n,i)}_applyRedo(e,t,n,i){const s=e.map(r=>{const o=this.getPositionAt(r.oldPosition),l=this.getPositionAt(r.oldEnd);return{range:new p.Q(o.lineNumber,o.column,l.lineNumber,l.column),text:r.newText}});this._applyUndoRedoEdits(s,t,!1,!0,n,i)}_applyUndoRedoEdits(e,t,n,i,s,r){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=n,this._isRedoing=i,this.applyEdits(e,!1),this.setEOL(t),this._overwriteAlternativeVersionId(s)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(r),this._onDidChangeDecorations.endDeferredEmit()}}applyEdits(e,t=!1){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();const n=this._validateEditOperations(e);return this._doApplyEdits(n,t)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_doApplyEdits(e,t){const n=this._buffer.getLineCount(),i=this._buffer.applyEdits(e,this._options.trimAutoWhitespace,t),s=this._buffer.getLineCount(),r=i.changes;if(this._trimAutoWhitespaceLines=i.trimAutoWhitespaceLineNumbers,r.length!==0){for(let g=0,m=r.length;g<m;g++){const u=r[g];this._decorationsTree.acceptReplace(u.rangeOffset,u.rangeLength,u.text.length,u.forceMoveMarkers)}const o=[];this._increaseVersionId();let l=n;for(let g=0,m=r.length;g<m;g++){const u=r[g],[k]=(0,d.W)(u.text);this._onDidChangeDecorations.fire();const O=u.range.startLineNumber,N=u.range.endLineNumber,F=N-O,U=k,Q=Math.min(F,U),q=U-F,re=s-l-q+O,pe=re,ke=re+U,be=this._decorationsTree.getInjectedTextInInterval(this,this.getOffsetAt(new b.y(pe,1)),this.getOffsetAt(new b.y(ke,this.getLineMaxColumn(ke))),0),Ee=xe.uK.fromDecorations(be),rt=new V.j3(Ee);for(let we=Q;we>=0;we--){const ft=O+we,$e=re+we;rt.takeFromEndWhile(Xe=>Xe.lineNumber>$e);const Ot=rt.takeFromEndWhile(Xe=>Xe.lineNumber===$e);o.push(new xe.U0(ft,this.getLineContent($e),Ot))}if(Q<F){const we=O+Q;o.push(new xe.E$(we+1,N))}if(Q<U){const we=new V.j3(Ee),ft=O+Q,$e=U-Q,Ot=s-l-$e+ft+1,Xe=[],nn=[];for(let ot=0;ot<$e;ot++){const wt=Ot+ot;nn[ot]=this.getLineContent(wt),we.takeWhile(Bt=>Bt.lineNumber<wt),Xe[ot]=we.takeWhile(Bt=>Bt.lineNumber===wt)}o.push(new xe.bg(ft+1,O+U,nn,Xe))}l+=q}this._emitContentChangedEvent(new xe.HP(o,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:r,eol:this._buffer.getEOL(),isEolChange:!1,versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1})}return i.reverseEdits===null?void 0:i.reverseEdits}undo(){return this._undoRedoService.undo(this.uri)}canUndo(){return this._undoRedoService.canUndo(this.uri)}redo(){return this._undoRedoService.redo(this.uri)}canRedo(){return this._undoRedoService.canRedo(this.uri)}handleBeforeFireDecorationsChangedEvent(e){if(e===null||e.size===0)return;const n=Array.from(e).map(i=>new xe.U0(i,this.getLineContent(i),this._getInjectedTextInLine(i)));this._onDidChangeInjectedText.fire(new xe.vn(n))}changeDecorations(e,t=0){this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(t,e)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_changeDecorations(e,t){const n={addDecoration:(s,r)=>this._deltaDecorationsImpl(e,[],[{range:s,options:r}])[0],changeDecoration:(s,r)=>{this._changeDecorationImpl(s,r)},changeDecorationOptions:(s,r)=>{this._changeDecorationOptionsImpl(s,tn(r))},removeDecoration:s=>{this._deltaDecorationsImpl(e,[s],[])},deltaDecorations:(s,r)=>s.length===0&&r.length===0?[]:this._deltaDecorationsImpl(e,s,r)};let i=null;try{i=t(n)}catch(s){(0,j.dz)(s)}return n.addDecoration=st,n.changeDecoration=st,n.changeDecorationOptions=st,n.removeDecoration=st,n.deltaDecorations=st,i}deltaDecorations(e,t,n=0){if(this._assertNotDisposed(),e||(e=[]),e.length===0&&t.length===0)return[];try{return this._deltaDecorationCallCnt++,this._deltaDecorationCallCnt>1&&(0,j.dz)(new Error("Invoking deltaDecorations recursively could lead to leaking decorations.")),this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(n,e,t)}finally{this._onDidChangeDecorations.endDeferredEmit(),this._deltaDecorationCallCnt--}}_getTrackedRange(e){return this.getDecorationRange(e)}_setTrackedRange(e,t,n){const i=e?this._decorations[e]:null;if(!i)return t?this._deltaDecorationsImpl(0,[],[{range:t,options:en[n]}],!0)[0]:null;if(!t)return this._decorationsTree.delete(i),delete this._decorations[i.id],null;const s=this._validateRangeRelaxedNoAllocations(t),r=this._buffer.getOffsetAt(s.startLineNumber,s.startColumn),o=this._buffer.getOffsetAt(s.endLineNumber,s.endColumn);return this._decorationsTree.delete(i),i.reset(this.getVersionId(),r,o,s),i.setOptions(en[n]),this._decorationsTree.insert(i),i.id}removeAllDecorationsWithOwnerId(e){if(this._isDisposed)return;const t=this._decorationsTree.collectNodesFromOwner(e);for(let n=0,i=t.length;n<i;n++){const s=t[n];this._decorationsTree.delete(s),delete this._decorations[s.id]}}getDecorationOptions(e){const t=this._decorations[e];return t?t.options:null}getDecorationRange(e){const t=this._decorations[e];return t?this._decorationsTree.getNodeRange(this,t):null}getLineDecorations(e,t=0,n=!1){return e<1||e>this.getLineCount()?[]:this.getLinesDecorations(e,e,t,n)}getLinesDecorations(e,t,n=0,i=!1,s=!1){const r=this.getLineCount(),o=Math.min(r,Math.max(1,e)),l=Math.min(r,Math.max(1,t)),g=this.getLineMaxColumn(l),m=new p.Q(o,1,l,g),u=this._getDecorationsInRange(m,n,i,s);return(0,V.E4)(u,this._decorationProvider.getDecorationsInRange(m,n,i)),u}getDecorationsInRange(e,t=0,n=!1,i=!1,s=!1){const r=this.validateRange(e),o=this._getDecorationsInRange(r,t,n,s);return(0,V.E4)(o,this._decorationProvider.getDecorationsInRange(r,t,n,i)),o}getOverviewRulerDecorations(e=0,t=!1){return this._decorationsTree.getAll(this,e,t,!0,!1)}getInjectedTextDecorations(e=0){return this._decorationsTree.getAllInjectedText(this,e)}_getInjectedTextInLine(e){const t=this._buffer.getOffsetAt(e,1),n=t+this._buffer.getLineLength(e),i=this._decorationsTree.getInjectedTextInInterval(this,t,n,0);return xe.uK.fromDecorations(i).filter(s=>s.lineNumber===e)}getAllDecorations(e=0,t=!1){let n=this._decorationsTree.getAll(this,e,t,!1,!1);return n=n.concat(this._decorationProvider.getAllDecorations(e,t)),n}getAllMarginDecorations(e=0){return this._decorationsTree.getAll(this,e,!1,!1,!0)}_getDecorationsInRange(e,t,n,i){const s=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),r=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getAllInInterval(this,s,r,t,n,i)}getRangeAt(e,t){return this._buffer.getRangeAt(e,t-e)}_changeDecorationImpl(e,t){const n=this._decorations[e];if(!n)return;if(n.options.after){const o=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(o.endLineNumber)}if(n.options.before){const o=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(o.startLineNumber)}const i=this._validateRangeRelaxedNoAllocations(t),s=this._buffer.getOffsetAt(i.startLineNumber,i.startColumn),r=this._buffer.getOffsetAt(i.endLineNumber,i.endColumn);this._decorationsTree.delete(n),n.reset(this.getVersionId(),s,r,i),this._decorationsTree.insert(n),this._onDidChangeDecorations.checkAffectedAndFire(n.options),n.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.endLineNumber),n.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(i.startLineNumber)}_changeDecorationOptionsImpl(e,t){const n=this._decorations[e];if(!n)return;const i=!!(n.options.overviewRuler&&n.options.overviewRuler.color),s=!!(t.overviewRuler&&t.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(n.options),this._onDidChangeDecorations.checkAffectedAndFire(t),n.options.after||t.after){const l=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(l.endLineNumber)}if(n.options.before||t.before){const l=this._decorationsTree.getNodeRange(this,n);this._onDidChangeDecorations.recordLineAffectedByInjectedText(l.startLineNumber)}const r=i!==s,o=Zn(t)!==dt(n);r||o?(this._decorationsTree.delete(n),n.setOptions(t),this._decorationsTree.insert(n)):n.setOptions(t)}_deltaDecorationsImpl(e,t,n,i=!1){const s=this.getVersionId(),r=t.length;let o=0;const l=n.length;let g=0;this._onDidChangeDecorations.beginDeferredEmit();try{const m=new Array(l);for(;o<r||g<l;){let u=null;if(o<r){do u=this._decorations[t[o++]];while(!u&&o<r);if(u){if(u.options.after){const k=this._decorationsTree.getNodeRange(this,u);this._onDidChangeDecorations.recordLineAffectedByInjectedText(k.endLineNumber)}if(u.options.before){const k=this._decorationsTree.getNodeRange(this,u);this._onDidChangeDecorations.recordLineAffectedByInjectedText(k.startLineNumber)}this._decorationsTree.delete(u),i||this._onDidChangeDecorations.checkAffectedAndFire(u.options)}}if(g<l){if(!u){const Q=++this._lastDecorationId,q=`${this._instanceId};${Q}`;u=new zt(q,0,0),this._decorations[q]=u}const k=n[g],O=this._validateRangeRelaxedNoAllocations(k.range),N=tn(k.options),F=this._buffer.getOffsetAt(O.startLineNumber,O.startColumn),U=this._buffer.getOffsetAt(O.endLineNumber,O.endColumn);u.ownerId=e,u.reset(s,F,U,O),u.setOptions(N),u.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(O.endLineNumber),u.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(O.startLineNumber),i||this._onDidChangeDecorations.checkAffectedAndFire(N),this._decorationsTree.insert(u),m[g]=u.id,g++}else u&&delete this._decorations[u.id]}return m}finally{this._onDidChangeDecorations.endDeferredEmit()}}getLanguageId(){return this.tokenization.getLanguageId()}setLanguage(e,t){typeof e=="string"?(this._languageSelectionListener.clear(),this._setLanguage(e,t)):(this._languageSelectionListener.value=e.onDidChange(()=>this._setLanguage(e.languageId,t)),this._setLanguage(e.languageId,t))}_setLanguage(e,t){this.tokenization.setLanguageId(e,t),this._languageService.requestRichLanguageFeatures(e)}getLanguageIdAtPosition(e,t){return this.tokenization.getLanguageIdAtPosition(e,t)}getWordAtPosition(e){return this._tokenizationTextModelPart.getWordAtPosition(e)}getWordUntilPosition(e){return this._tokenizationTextModelPart.getWordUntilPosition(e)}normalizePosition(e,t){return e}getLineIndentColumn(e){return Yn(this.getLineContent(e))+1}};vt=He=Hn([ct(4,jn.$D),ct(5,A.L),ct(6,G.JZ),ct(7,Vn._Y)],vt);function Yn(a){let e=0;for(const t of a)if(t===" "||t==="	")e++;else break;return e}function xt(a){return!!(a.options.overviewRuler&&a.options.overviewRuler.color)}function Zn(a){return!!a.after||!!a.before}function dt(a){return!!a.options.after||!!a.options.before}class Jt{constructor(){this._decorationsTree0=new gt,this._decorationsTree1=new gt,this._injectedTextDecorationsTree=new gt}ensureAllNodesHaveRanges(e){this.getAll(e,0,!1,!1,!1)}_ensureNodesHaveRanges(e,t){for(const n of t)n.range===null&&(n.range=e.getRangeAt(n.cachedAbsoluteStart,n.cachedAbsoluteEnd));return t}getAllInInterval(e,t,n,i,s,r){const o=e.getVersionId(),l=this._intervalSearch(t,n,i,s,o,r);return this._ensureNodesHaveRanges(e,l)}_intervalSearch(e,t,n,i,s,r){const o=this._decorationsTree0.intervalSearch(e,t,n,i,s,r),l=this._decorationsTree1.intervalSearch(e,t,n,i,s,r),g=this._injectedTextDecorationsTree.intervalSearch(e,t,n,i,s,r);return o.concat(l).concat(g)}getInjectedTextInInterval(e,t,n,i){const s=e.getVersionId(),r=this._injectedTextDecorationsTree.intervalSearch(t,n,i,!1,s,!1);return this._ensureNodesHaveRanges(e,r).filter(o=>o.options.showIfCollapsed||!o.range.isEmpty())}getAllInjectedText(e,t){const n=e.getVersionId(),i=this._injectedTextDecorationsTree.search(t,!1,n,!1);return this._ensureNodesHaveRanges(e,i).filter(s=>s.options.showIfCollapsed||!s.range.isEmpty())}getAll(e,t,n,i,s){const r=e.getVersionId(),o=this._search(t,n,i,r,s);return this._ensureNodesHaveRanges(e,o)}_search(e,t,n,i,s){if(n)return this._decorationsTree1.search(e,t,i,s);{const r=this._decorationsTree0.search(e,t,i,s),o=this._decorationsTree1.search(e,t,i,s),l=this._injectedTextDecorationsTree.search(e,t,i,s);return r.concat(o).concat(l)}}collectNodesFromOwner(e){const t=this._decorationsTree0.collectNodesFromOwner(e),n=this._decorationsTree1.collectNodesFromOwner(e),i=this._injectedTextDecorationsTree.collectNodesFromOwner(e);return t.concat(n).concat(i)}collectNodesPostOrder(){const e=this._decorationsTree0.collectNodesPostOrder(),t=this._decorationsTree1.collectNodesPostOrder(),n=this._injectedTextDecorationsTree.collectNodesPostOrder();return e.concat(t).concat(n)}insert(e){dt(e)?this._injectedTextDecorationsTree.insert(e):xt(e)?this._decorationsTree1.insert(e):this._decorationsTree0.insert(e)}delete(e){dt(e)?this._injectedTextDecorationsTree.delete(e):xt(e)?this._decorationsTree1.delete(e):this._decorationsTree0.delete(e)}getNodeRange(e,t){const n=e.getVersionId();return t.cachedVersionId!==n&&this._resolveNode(t,n),t.range===null&&(t.range=e.getRangeAt(t.cachedAbsoluteStart,t.cachedAbsoluteEnd)),t.range}_resolveNode(e,t){dt(e)?this._injectedTextDecorationsTree.resolveNode(e,t):xt(e)?this._decorationsTree1.resolveNode(e,t):this._decorationsTree0.resolveNode(e,t)}acceptReplace(e,t,n,i){this._decorationsTree0.acceptReplace(e,t,n,i),this._decorationsTree1.acceptReplace(e,t,n,i),this._injectedTextDecorationsTree.acceptReplace(e,t,n,i)}}function Re(a){return a.replace(/[^a-z0-9\-_]/gi," ")}class qt{constructor(e){this.color=e.color||"",this.darkColor=e.darkColor||""}}class Jn extends qt{constructor(e){super(e),this._resolvedColor=null,this.position=typeof e.position=="number"?e.position:_.A5.Center}getColor(e){return this._resolvedColor||(e.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=null}_resolveColor(e,t){if(typeof e=="string")return e;const n=e?t.getColor(e.id):null;return n?n.toString():""}}class qn{constructor(e){this.position=e?.position??_.ZS.Center,this.persistLane=e?.persistLane}}class ei extends qt{constructor(e){super(e),this.position=e.position,this.sectionHeaderStyle=e.sectionHeaderStyle??null,this.sectionHeaderText=e.sectionHeaderText??null}getColor(e){return this._resolvedColor||(e.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,e):this._resolvedColor=this._resolveColor(this.color,e)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=void 0}_resolveColor(e,t){return typeof e=="string"?K.Q1.fromHex(e):t.getColor(e.id)}}class Qe{static from(e){return e instanceof Qe?e:new Qe(e)}constructor(e){this.content=e.content||"",this.inlineClassName=e.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.attachedData=e.attachedData||null,this.cursorStops=e.cursorStops||null}}class Oe{static register(e){return new Oe(e)}static createDynamic(e){return new Oe(e)}constructor(e){this.description=e.description,this.blockClassName=e.blockClassName?Re(e.blockClassName):null,this.blockDoesNotCollapse=e.blockDoesNotCollapse??null,this.blockIsAfterEnd=e.blockIsAfterEnd??null,this.blockPadding=e.blockPadding??null,this.stickiness=e.stickiness||0,this.zIndex=e.zIndex||0,this.className=e.className?Re(e.className):null,this.shouldFillLineOnLineBreak=e.shouldFillLineOnLineBreak??null,this.hoverMessage=e.hoverMessage||null,this.glyphMarginHoverMessage=e.glyphMarginHoverMessage||null,this.lineNumberHoverMessage=e.lineNumberHoverMessage||null,this.isWholeLine=e.isWholeLine||!1,this.showIfCollapsed=e.showIfCollapsed||!1,this.collapseOnReplaceEdit=e.collapseOnReplaceEdit||!1,this.overviewRuler=e.overviewRuler?new Jn(e.overviewRuler):null,this.minimap=e.minimap?new ei(e.minimap):null,this.glyphMargin=e.glyphMarginClassName?new qn(e.glyphMargin):null,this.glyphMarginClassName=e.glyphMarginClassName?Re(e.glyphMarginClassName):null,this.linesDecorationsClassName=e.linesDecorationsClassName?Re(e.linesDecorationsClassName):null,this.lineNumberClassName=e.lineNumberClassName?Re(e.lineNumberClassName):null,this.linesDecorationsTooltip=e.linesDecorationsTooltip?c.jy(e.linesDecorationsTooltip):null,this.firstLineDecorationClassName=e.firstLineDecorationClassName?Re(e.firstLineDecorationClassName):null,this.marginClassName=e.marginClassName?Re(e.marginClassName):null,this.inlineClassName=e.inlineClassName?Re(e.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=e.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=e.beforeContentClassName?Re(e.beforeContentClassName):null,this.afterContentClassName=e.afterContentClassName?Re(e.afterContentClassName):null,this.after=e.after?Qe.from(e.after):null,this.before=e.before?Qe.from(e.before):null,this.hideInCommentTokens=e.hideInCommentTokens??!1,this.hideInStringTokens=e.hideInStringTokens??!1}}Oe.EMPTY=Oe.register({description:"empty"});const en=[Oe.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:0}),Oe.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:1}),Oe.register({description:"tracked-range-grows-only-when-typing-before",stickiness:2}),Oe.register({description:"tracked-range-grows-only-when-typing-after",stickiness:3})];function tn(a){return a instanceof Oe?a:Oe.createDynamic(a)}class ti extends M.jG{constructor(e){super(),this.handleBeforeFire=e,this._actual=this._register(new x.vl),this.event=this._actual.event,this._affectedInjectedTextLines=null,this._deferredCnt=0,this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._affectsLineNumber=!1}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(){this._deferredCnt--,this._deferredCnt===0&&(this._shouldFireDeferred&&this.doFire(),this._affectedInjectedTextLines?.clear(),this._affectedInjectedTextLines=null)}recordLineAffectedByInjectedText(e){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(e)}checkAffectedAndFire(e){this._affectsMinimap||=!!e.minimap?.position,this._affectsOverviewRuler||=!!e.overviewRuler?.color,this._affectsGlyphMargin||=!!e.glyphMarginClassName,this._affectsLineNumber||=!!e.lineNumberClassName,this.tryFire()}fire(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._affectsGlyphMargin=!0,this.tryFire()}tryFire(){this._deferredCnt===0?this.doFire():this._shouldFireDeferred=!0}doFire(){this.handleBeforeFire(this._affectedInjectedTextLines);const e={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler,affectsGlyphMargin:this._affectsGlyphMargin,affectsLineNumber:this._affectsLineNumber};this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._actual.fire(e)}}class ni extends M.jG{constructor(){super(),this._fastEmitter=this._register(new x.vl),this.fastEvent=this._fastEmitter.event,this._slowEmitter=this._register(new x.vl),this.slowEvent=this._slowEmitter.event,this._deferredCnt=0,this._deferredEvent=null}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(e=null){if(this._deferredCnt--,this._deferredCnt===0&&this._deferredEvent!==null){this._deferredEvent.rawContentChangedEvent.resultingSelection=e;const t=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(t),this._slowEmitter.fire(t)}}fire(e){if(this._deferredCnt>0){this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(e):this._deferredEvent=e;return}this._fastEmitter.fire(e),this._slowEmitter.fire(e)}}},90439:(me,X,T)=>{T.d(X,{BQ:()=>V,Yo:()=>j});function V(x,M){const c=x.getCount(),C=x.findTokenIndexAtOffset(M),d=x.getLanguageId(C);let L=C;for(;L+1<c&&x.getLanguageId(L+1)===d;)L++;let b=C;for(;b>0&&x.getLanguageId(b-1)===d;)b--;return new K(x,d,b,L+1,x.getStartOffset(b),x.getEndOffset(L))}class K{constructor(M,c,C,d,L,b){this._scopedLineTokensBrand=void 0,this._actual=M,this.languageId=c,this._firstTokenIndex=C,this._lastTokenIndex=d,this.firstCharOffset=L,this._lastCharOffset=b,this.languageIdCodec=M.languageIdCodec}getLineContent(){return this._actual.getLineContent().substring(this.firstCharOffset,this._lastCharOffset)}getLineLength(){return this._lastCharOffset-this.firstCharOffset}getActualLineContentBefore(M){return this._actual.getLineContent().substring(0,this.firstCharOffset+M)}getTokenCount(){return this._lastTokenIndex-this._firstTokenIndex}findTokenIndexAtOffset(M){return this._actual.findTokenIndexAtOffset(M+this.firstCharOffset)-this._firstTokenIndex}getStandardTokenType(M){return this._actual.getStandardTokenType(M+this._firstTokenIndex)}toIViewLineTokens(){return this._actual.sliceAndInflate(this.firstCharOffset,this._lastCharOffset,0)}}function j(x){return(x&3)!==0}},95312:(me,X,T)=>{T.d(X,{G:()=>V});function V(K,j){let x=0,M=0;const c=K.length;for(;M<c;){const C=K.charCodeAt(M);if(C===32)x++;else if(C===9)x=x-x%j+j;else break;M++}return M===c?-1:x}},95981:(me,X,T)=>{T.d(X,{Th:()=>B,z8:()=>A});var V=T(45573),K=T(87856),j=T(47545),x=T(37473),M=T(16416),c=T(55409),C=T(38266);function d(G){return G.toString()}class L{static create(_,I){const h=_.getAlternativeVersionId(),f=w(_);return new L(h,h,f,f,I,I,[])}constructor(_,I,h,f,v,P,S){this.beforeVersionId=_,this.afterVersionId=I,this.beforeEOL=h,this.afterEOL=f,this.beforeCursorState=v,this.afterCursorState=P,this.changes=S}append(_,I,h,f,v){I.length>0&&(this.changes=(0,M.x)(this.changes,I)),this.afterEOL=h,this.afterVersionId=f,this.afterCursorState=v}static _writeSelectionsSize(_){return 4+4*4*(_?_.length:0)}static _writeSelections(_,I,h){if(c.Sw(_,I?I.length:0,h),h+=4,I)for(const f of I)c.Sw(_,f.selectionStartLineNumber,h),h+=4,c.Sw(_,f.selectionStartColumn,h),h+=4,c.Sw(_,f.positionLineNumber,h),h+=4,c.Sw(_,f.positionColumn,h),h+=4;return h}static _readSelections(_,I,h){const f=c.bb(_,I);I+=4;for(let v=0;v<f;v++){const P=c.bb(_,I);I+=4;const S=c.bb(_,I);I+=4;const z=c.bb(_,I);I+=4;const D=c.bb(_,I);I+=4,h.push(new j.L(P,S,z,D))}return I}serialize(){let _=10+L._writeSelectionsSize(this.beforeCursorState)+L._writeSelectionsSize(this.afterCursorState)+4;for(const f of this.changes)_+=f.writeSize();const I=new Uint8Array(_);let h=0;c.Sw(I,this.beforeVersionId,h),h+=4,c.Sw(I,this.afterVersionId,h),h+=4,c.Gs(I,this.beforeEOL,h),h+=1,c.Gs(I,this.afterEOL,h),h+=1,h=L._writeSelections(I,this.beforeCursorState,h),h=L._writeSelections(I,this.afterCursorState,h),c.Sw(I,this.changes.length,h),h+=4;for(const f of this.changes)h=f.write(I,h);return I.buffer}static deserialize(_){const I=new Uint8Array(_);let h=0;const f=c.bb(I,h);h+=4;const v=c.bb(I,h);h+=4;const P=c.pJ(I,h);h+=1;const S=c.pJ(I,h);h+=1;const z=[];h=L._readSelections(I,h,z);const D=[];h=L._readSelections(I,h,D);const E=c.bb(I,h);h+=4;const y=[];for(let W=0;W<E;W++)h=M.k.read(I,h,y);return new L(f,v,P,S,z,D,y)}}class b{get type(){return 0}get resource(){return x.r.isUri(this.model)?this.model:this.model.uri}constructor(_,I,h,f){this.label=_,this.code=I,this.model=h,this._data=L.create(h,f)}toString(){return(this._data instanceof L?this._data:L.deserialize(this._data)).changes.map(I=>I.toString()).join(", ")}matchesResource(_){return(x.r.isUri(this.model)?this.model:this.model.uri).toString()===_.toString()}setModel(_){this.model=_}canAppend(_){return this.model===_&&this._data instanceof L}append(_,I,h,f,v){this._data instanceof L&&this._data.append(_,I,h,f,v)}close(){this._data instanceof L&&(this._data=this._data.serialize())}open(){this._data instanceof L||(this._data=L.deserialize(this._data))}undo(){if(x.r.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof L&&(this._data=this._data.serialize());const _=L.deserialize(this._data);this.model._applyUndo(_.changes,_.beforeEOL,_.beforeVersionId,_.beforeCursorState)}redo(){if(x.r.isUri(this.model))throw new Error("Invalid SingleModelEditStackElement");this._data instanceof L&&(this._data=this._data.serialize());const _=L.deserialize(this._data);this.model._applyRedo(_.changes,_.afterEOL,_.afterVersionId,_.afterCursorState)}heapSize(){return this._data instanceof L&&(this._data=this._data.serialize()),this._data.byteLength+168}}class p{get resources(){return this._editStackElementsArr.map(_=>_.resource)}constructor(_,I,h){this.label=_,this.code=I,this.type=1,this._isOpen=!0,this._editStackElementsArr=h.slice(0),this._editStackElementsMap=new Map;for(const f of this._editStackElementsArr){const v=d(f.resource);this._editStackElementsMap.set(v,f)}this._delegate=null}prepareUndoRedo(){if(this._delegate)return this._delegate.prepareUndoRedo(this)}matchesResource(_){const I=d(_);return this._editStackElementsMap.has(I)}setModel(_){const I=d(x.r.isUri(_)?_:_.uri);this._editStackElementsMap.has(I)&&this._editStackElementsMap.get(I).setModel(_)}canAppend(_){if(!this._isOpen)return!1;const I=d(_.uri);return this._editStackElementsMap.has(I)?this._editStackElementsMap.get(I).canAppend(_):!1}append(_,I,h,f,v){const P=d(_.uri);this._editStackElementsMap.get(P).append(_,I,h,f,v)}close(){this._isOpen=!1}open(){}undo(){this._isOpen=!1;for(const _ of this._editStackElementsArr)_.undo()}redo(){for(const _ of this._editStackElementsArr)_.redo()}heapSize(_){const I=d(_);return this._editStackElementsMap.has(I)?this._editStackElementsMap.get(I).heapSize():0}split(){return this._editStackElementsArr}toString(){const _=[];for(const I of this._editStackElementsArr)_.push(`${(0,C.P8)(I.resource)}: ${I}`);return`{${_.join(", ")}}`}}function w(G){return G.getEOL()===`
`?0:1}function B(G){return G?G instanceof b||G instanceof p:!1}class A{constructor(_,I){this._model=_,this._undoRedoService=I}pushStackElement(){const _=this._undoRedoService.getLastElement(this._model.uri);B(_)&&_.close()}popStackElement(){const _=this._undoRedoService.getLastElement(this._model.uri);B(_)&&_.open()}clear(){this._undoRedoService.removeElements(this._model.uri)}_getOrCreateEditStackElement(_,I){const h=this._undoRedoService.getLastElement(this._model.uri);if(B(h)&&h.canAppend(this._model))return h;const f=new b(V.kg("edit","Typing"),"undoredo.textBufferEdit",this._model,_);return this._undoRedoService.pushElement(f,I),f}pushEOL(_){const I=this._getOrCreateEditStackElement(null,void 0);this._model.setEOL(_),I.append(this._model,[],w(this._model),this._model.getAlternativeVersionId(),null)}pushEditOperation(_,I,h,f){const v=this._getOrCreateEditStackElement(_,f),P=this._model.applyEdits(I,!0),S=A._computeCursorState(h,P),z=P.map((D,E)=>({index:E,textChange:D.textChange}));return z.sort((D,E)=>D.textChange.oldPosition===E.textChange.oldPosition?D.index-E.index:D.textChange.oldPosition-E.textChange.oldPosition),v.append(this._model,z.map(D=>D.textChange),w(this._model),this._model.getAlternativeVersionId(),S),S}static _computeCursorState(_,I){try{return _?_(I):null}catch(h){return(0,K.dz)(h),null}}}},99523:(me,X,T)=>{T.r(X),T.d(X,{ITreeSitterParserService:()=>K});var V=T(81545);const K=(0,V.u1)("treeSitterParserService")}}]);
